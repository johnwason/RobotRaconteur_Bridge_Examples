//  Robot Raconteur(R) - A communication library for robotics and automation systems
//  Copyright (C) 2016 John Wason <wason@wasontech.com>
//                     Wason Technology, LLC
//
//  This program is released under the terms of the Robot Raconteur(R)
//  license.  Full text can be found at  http://robotraconteur.com/license2 .
//  Attribute to this library as "Robot Raconteur(R)" in documentation or
//  packaging.  This software is royalty free for commercial use under
//  the conditions of the license.
//
//  This program is distributed in the hope that it will be useful,
//  but WITHOUT ANY WARRANTY; without even the implied warranty of
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

(function(){"use strict";Bridge.define("RobotRaconteur.ArrayBinaryReader",{view:null,limits:null,m_Position:0,config:{init:function(){this.limits=new Bridge.List$1(Bridge.UInt32)()}},constructor:function(b,offset,length){this.view=new DataView(b,offset,length);this.limits.add(length>>>0)},getCurrentLimit:function(){return this.limits.getItem(0)},getPosition:function(){return this.m_Position},getDistanceFromLimit:function(){return(this.getCurrentLimit()|0)-(this.m_Position|0)|0},readArray:function(a){var a2,i,a21,i1,a22,i2,a23,i3,a24,i4,a25,i5,a26,i6,a27,i7;if(Bridge.is(a,Float64Array))for(a2=Bridge.as(a,Float64Array),i=0;i<a2.length;i=i+1|0)a2[i]=this.readDouble();else if(Bridge.is(a,Float32Array))for(a21=Bridge.as(a,Float32Array),i1=0;i1<a21.length;i1=i1+1|0)a21[i1]=this.readSingle();else if(Bridge.is(a,Uint8Array))for(a22=Bridge.as(a,Uint8Array),i2=0;i2<a22.length;i2=i2+1|0)a22[i2]=this.readByte();else if(Bridge.is(a,Int8Array))for(a23=Bridge.as(a,Int8Array),i3=0;i3<a23.length;i3=i3+1|0)a23[i3]=this.readSByte();else if(Bridge.is(a,Int16Array))for(a24=Bridge.as(a,Int16Array),i4=0;i4<a24.length;i4=i4+1|0)a24[i4]=this.readInt16();else if(Bridge.is(a,Uint16Array))for(a25=Bridge.as(a,Uint16Array),i5=0;i5<a25.length;i5=i5+1|0)a25[i5]=this.readUInt16();else if(Bridge.is(a,Int32Array))for(a26=Bridge.as(a,Int32Array),i6=0;i6<a26.length;i6=i6+1|0)a26[i6]=this.readInt32();else if(Bridge.is(a,Uint32Array))for(a27=Bridge.as(a,Uint32Array),i7=0;i7<a27.length;i7=i7+1|0)a27[i7]=this.readUInt32();else throw new RobotRaconteur.DataTypeException("Unknown array type");},readString8:function(l){var b=Bridge.Array.init(l,0),n,s;if(Bridge.Long(this.getPosition()).add(Bridge.Long(b.length)).gt(Bridge.Long(this.getCurrentLimit())))throw new RobotRaconteur.ProtocolException("Message read error");return n=this.read(b,0,b.length),s=Bridge.Linq.Enumerable.from(b).select($_.RobotRaconteur.ArrayBinaryReader.f1).toArray().join(""),s},readNumber:function(t){switch(t){case RobotRaconteur.DataTypes.double_t:return this.readDouble();case RobotRaconteur.DataTypes.single_t:return this.readSingle();case RobotRaconteur.DataTypes.int8_t:return this.readSByte();case RobotRaconteur.DataTypes.uint8_t:return this.readByte();case RobotRaconteur.DataTypes.int16_t:return this.readInt16();case RobotRaconteur.DataTypes.uint16_t:return this.readUInt16();case RobotRaconteur.DataTypes.int32_t:return this.readInt32();case RobotRaconteur.DataTypes.uint32_t:return this.readUInt32();case RobotRaconteur.DataTypes.int64_t:return this.readInt64();case RobotRaconteur.DataTypes.uint64_t:return this.readUInt64()}throw new RobotRaconteur.DataTypeException("Unknown data type to read");},read:function(buffer,index,count){for(var i=0;i<count;i=i+1|0)buffer[i+index|0]=this.readByte();return count},readDouble:function(){if(this.getPosition()+8>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message read error");var i=this.view.getFloat64(this.m_Position|0,!0);return this.m_Position=this.m_Position+8>>>0,i},readSingle:function(){if(this.getPosition()+4>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message read error");var i=this.view.getFloat32(this.m_Position|0,!0);return this.m_Position=this.m_Position+4>>>0,i},readSByte:function(){if(this.getPosition()+1>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message read error");var i=this.view.getInt8(this.m_Position|0);return this.m_Position=this.m_Position+1>>>0,i},readByte:function(){if(this.getPosition()+1>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message read error");var i=this.view.getUint8(this.m_Position|0);return this.m_Position=this.m_Position+1>>>0,i},readInt16:function(){if(this.getPosition()+2>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message read error");var i=this.view.getInt16(this.m_Position|0,!0);return this.m_Position=this.m_Position+2>>>0,i},readUInt16:function(){if(this.getPosition()+2>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message read error");var i=this.view.getUint16(this.m_Position|0,!0);return this.m_Position=this.m_Position+2>>>0,i},readInt32:function(){if(this.getPosition()+4>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message read error");var i=this.view.getInt32(this.m_Position|0,!0);return this.m_Position=this.m_Position+4>>>0,i},readUInt32:function(){if(this.getPosition()+4>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message read error");var i=this.view.getUint32(this.m_Position|0,!0);return this.m_Position=this.m_Position+4>>>0,i},readInt64:function(){if(this.getPosition()+8>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message read error");var i=this.view.getInt32(this.m_Position|0,!0);return this.m_Position=this.m_Position+8>>>0,Bridge.Long(i)},readUInt64:function(){if(this.getPosition()+8>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message read error");var i=this.view.getUint32(this.m_Position|0,!0);return this.m_Position=this.m_Position+8>>>0,Bridge.ULong(i)},pushRelativeLimit:function(limit){if(this.getPosition()+limit>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Error reading message");this.limits.insert(0,this.getPosition()+limit>>>0)},pushAbsoluteLimit:function(limit){if(limit>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Error reading message");this.limits.insert(0,limit)},popLimit:function(){this.limits.removeAt(0)},reset:function(length){this.limits.clear();this.limits.insert(0,length>>>0);this.m_Position=0}});var $_={};Bridge.ns("RobotRaconteur.ArrayBinaryReader",$_);Bridge.apply($_.RobotRaconteur.ArrayBinaryReader,{f1:function(x){return String.fromCharCode(x)}});Bridge.define("RobotRaconteur.ArrayBinaryWriter",{statics:{getStringByteCount8:function(s){return s.length}},view:null,limits:null,m_Position:0,config:{init:function(){this.limits=new Bridge.List$1(Bridge.UInt32)()}},constructor:function(b,offset,length){this.view=new DataView(b,offset,length);this.limits.add(length>>>0)},getCurrentLimit:function(){return this.limits.getItem(0)},getPosition:function(){return this.m_Position},getDistanceFromLimit:function(){return(this.getCurrentLimit()|0)-(this.m_Position|0)|0},writeArray:function(a){var a2,i,a21,i1,a22,i2,a23,i3,a24,i4,a25,i5,a26,i6,a27,i7;if(Bridge.is(a,Float64Array))for(a2=Bridge.as(a,Float64Array),i=0;i<a2.length;i=i+1|0)this.write$2(a2[i]);else if(Bridge.is(a,Float32Array))for(a21=Bridge.as(a,Float32Array),i1=0;i1<a21.length;i1=i1+1|0)this.write$7(a21[i1]);else if(Bridge.is(a,Int8Array))for(a22=Bridge.as(a,Int8Array),i2=0;i2<a22.length;i2=i2+1|0)this.write$6(a22[i2]);else if(Bridge.is(a,Uint8Array))for(a23=Bridge.as(a,Uint8Array),i3=0;i3<a23.length;i3=i3+1|0)this.write(a23[i3]);else if(Bridge.is(a,Int16Array))for(a24=Bridge.as(a,Int16Array),i4=0;i4<a24.length;i4=i4+1|0)this.write$3(a24[i4]);else if(Bridge.is(a,Uint16Array))for(a25=Bridge.as(a,Uint16Array),i5=0;i5<a25.length;i5=i5+1|0)this.write$8(a25[i5]);else if(Bridge.is(a,Int32Array))for(a26=Bridge.as(a,Int32Array),i6=0;i6<a26.length;i6=i6+1|0)this.write$4(a26[i6]);else if(Bridge.is(a,Uint32Array))for(a27=Bridge.as(a,Uint32Array),i7=0;i7<a27.length;i7=i7+1|0)this.write$9(a27[i7]);else throw new RobotRaconteur.DataTypeException("Unknown array type");},writeString8:function(s){for(var b=Bridge.Array.init(s.length,0),i=0;i<s.length;i=i+1|0)b[i]=s.charCodeAt(i)&255;if(Bridge.Long(b.length).add(Bridge.Long(this.getPosition())).gt(Bridge.Long(this.getCurrentLimit())))throw new RobotRaconteur.ProtocolException("Message write error");this.write$1(b,0,b.length)},writeNumber:function(n,t){switch(t){case RobotRaconteur.DataTypes.double_t:this.write$2(Bridge.cast(n,Bridge.Double));return;case RobotRaconteur.DataTypes.single_t:this.write$7(Bridge.cast(n,Bridge.Single));return;case RobotRaconteur.DataTypes.int8_t:this.write$6(Bridge.cast(n,Bridge.SByte));return;case RobotRaconteur.DataTypes.uint8_t:this.write(Bridge.cast(n,Bridge.Byte));return;case RobotRaconteur.DataTypes.int16_t:this.write$3(Bridge.cast(n,Bridge.Int16));return;case RobotRaconteur.DataTypes.uint16_t:this.write$8(Bridge.cast(n,Bridge.UInt16));return;case RobotRaconteur.DataTypes.int32_t:this.write$4(Bridge.cast(n,Bridge.Int32));return;case RobotRaconteur.DataTypes.uint32_t:this.write$9(Bridge.cast(n,Bridge.UInt32));return;case RobotRaconteur.DataTypes.int64_t:this.write$5(Bridge.cast(n,Bridge.Long));return;case RobotRaconteur.DataTypes.uint64_t:this.write$10(Bridge.cast(n,Bridge.ULong));return}throw new RobotRaconteur.DataTypeException("Unknown data type to write");},write$1:function(buffer,index,count){for(var i=0;i<count;i=i+1|0)this.write(buffer[i+index|0])},write$2:function(value){if(8+this.getPosition()>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message write error");this.view.setFloat64(this.m_Position|0,value,!0);this.m_Position=this.m_Position+8>>>0},write$7:function(value){if(4+this.getPosition()>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message write error");this.view.setFloat32(this.m_Position|0,value,!0);this.m_Position=this.m_Position+4>>>0},write:function(value){if(1+this.getPosition()>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message write error");this.view.setUint8(this.m_Position|0,value);this.m_Position=this.m_Position+1>>>0},write$6:function(value){if(1+this.getPosition()>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message write error");this.view.setInt8(this.m_Position|0,value);this.m_Position=this.m_Position+1>>>0},write$3:function(value){if(2+this.getPosition()>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message write error");this.view.setInt16(this.m_Position|0,value,!0);this.m_Position=this.m_Position+2>>>0},write$8:function(value){if(2+this.getPosition()>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message write error");this.view.setUint16(this.m_Position,value,!0);this.m_Position=this.m_Position+2>>>0},write$4:function(value){if(4+this.getPosition()>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message write error");this.view.setInt32(this.m_Position|0,value,!0);this.m_Position=this.m_Position+4>>>0},write$9:function(value){if(4+this.getPosition()>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message write error");this.view.setUint32(this.m_Position,value,!0);this.m_Position=this.m_Position+4>>>0},write$5:function(value){if(8+this.getPosition()>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message write error");this.view.setInt32(this.m_Position|0,Bridge.Long.clip32(value),!0);this.view.setInt32((this.m_Position|0)+4|0,0,!0);this.m_Position=this.m_Position+8>>>0},write$10:function(value){if(8+this.getPosition()>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Message write error");this.view.setUint32(this.m_Position,Bridge.Long.clipu32(value),!0);this.view.setUint32(this.m_Position+4>>>0,0,!0);this.m_Position=this.m_Position+8>>>0},pushRelativeLimit:function(limit){if(this.getPosition()+limit>>>0>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Error reading message");this.limits.insert(0,this.getPosition()+limit>>>0)},pushAbsoluteLimit:function(limit){if(limit>this.getCurrentLimit())throw new RobotRaconteur.ProtocolException("Error reading message");this.limits.insert(0,limit)},popLimit:function(){this.limits.removeAt(0)},reset:function(length){this.limits.clear();this.limits.insert(0,length>>>0);this.m_Position=0}});Bridge.define("RobotRaconteur.AsyncMutex",{waiting_tasks:null,current:null,config:{init:function(){this.waiting_tasks=new Bridge.List$1(Bridge.TaskCompletionSource)()}},lock:function(){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,t,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:t=this.enter();$task1=t;$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(new RobotRaconteur.AsyncMutex.LockHandle(this,t));return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},lockWithTimeout:function(timeout){var $step=0,$task1,$taskResult1,$task2,$tcs=new Bridge.TaskCompletionSource,t,noop,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4],$step);switch($step){case 0:t=null;t=this.enter();$task1=Bridge.Task.whenAny(t,Bridge.Task.delay(timeout));$step=1;$task1.continueWith($asyncBody);return;case 1:if($taskResult1=$task1.getAwaitedResult(),t.isCompleted()||t.isFaulted()||t.isCanceled()){$step=2;continue}$step=4;continue;case 2:$task2=t;$step=3;$task2.continueWith($asyncBody);return;case 3:$task2.getAwaitedResult();$tcs.setResult(new RobotRaconteur.AsyncMutex.LockHandle(this,t));return;case 4:noop=t.continueWith(Bridge.fn.bind(this,$_.RobotRaconteur.AsyncMutex.f1));throw new Bridge.Exception("Timeout wating for mutex lock");default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},enter:function(){var t=new Bridge.TaskCompletionSource;return this.current==null?(t.trySetResult(0),this.current=t.task,t.task):(this.waiting_tasks.add(t),t.task)},exit:function(t){var c=null;if(!Bridge.referenceEquals(t,this.current))throw new Bridge.InvalidOperationException("Invalid task to release mutex");this.waiting_tasks.getCount()>0?(c=this.waiting_tasks.getItem(0),this.waiting_tasks.removeAt(0),this.current=c.task):this.current=null;c!=null&&c.trySetResult(0)},cancelAll:function(){for(var $t1,c2=new Bridge.List$1(Bridge.TaskCompletionSource)(),i,i1,$t=Bridge.getEnumerator(this.waiting_tasks);$t.moveNext();)i=$t.getCurrent(),c2.add(i);for($t1=Bridge.getEnumerator(c2);$t1.moveNext();)i1=$t1.getCurrent(),i1.trySetCanceled()}});Bridge.ns("RobotRaconteur.AsyncMutex",$_);Bridge.apply($_.RobotRaconteur.AsyncMutex,{f1:function(x){var e=x.exception;try{this.exit(x)}catch($e1){$e1=Bridge.Exception.create($e1)}}});Bridge.define("RobotRaconteur.AsyncMutex.LockHandle",{inherits:[Bridge.IDisposable],task:null,owner:null,constructor:function(owner,task){this.task=task;this.owner=owner},dispose:function(){this.owner.exit(this.task)}});Bridge.define("RobotRaconteur.RobotRaconteurException",{inherits:[Bridge.Exception],errorCode:0,error:"",constructor:function(){Bridge.Exception.prototype.$constructor.call(this)},constructor$1:function(ErrorCode,error,message){Bridge.Exception.prototype.$constructor.call(this,message);this.error=error;this.errorCode=ErrorCode},constructor$2:function(message,innerexception){Bridge.Exception.prototype.$constructor.call(this,message,innerexception)},toString:function(){return"RobotRaconteurException: "+this.error+": "+this.getMessage()}});Bridge.define("RobotRaconteur.MemberDefinition",{name:null,serviceEntry:null,constructor:function(ServiceEntry){this.serviceEntry=ServiceEntry}});Bridge.define("RobotRaconteur.Endpoint",{m_LocalEndpoint:0,m_RemoteEndpoint:0,m_RemoteNodeName:"",m_RemoteNodeID:null,transportConnection:null,messageNumber:0,messageNumberLock:null,node:null,config:{init:function(){this.m_RemoteNodeID=RobotRaconteur.NodeID.getAny();this.lastMessageReceivedTime=Bridge.Date.utcNow()||new Date(-864e13);this.messageNumberLock={}}},constructor:function(node){this.node=node==null?RobotRaconteur.RobotRaconteurNode.gets():node},getLocalEndpoint:function(){return this.m_LocalEndpoint},getRemoteEndpoint:function(){return this.m_RemoteEndpoint},getRemoteNodeName:function(){return this.m_RemoteNodeName},getRemoteNodeID:function(){return this.m_RemoteNodeID},sendMessage:function(m){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:m.header==null&&(m.header=new RobotRaconteur.MessageHeader);m.entries.getCount()===1&&Bridge.cast(m.entries.getItem(0).entryType,Bridge.Int32)<=500&&(m.header.receiverNodeName=this.getRemoteNodeName(),m.header.senderNodeName=this.node.getNodeName());m.header.senderEndpoint=this.getLocalEndpoint();m.header.receiverEndpoint=this.getRemoteEndpoint();m.header.senderNodeID=this.node.getNodeID();m.header.receiverNodeID=this.getRemoteNodeID();m.header.messageID=this.messageNumber;this.messageNumber=(this.messageNumber===65535?0:this.messageNumber+1|0)&65535;$task1=this.node.sendMessage(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}});Bridge.define("RobotRaconteur.DataTypes",{statics:{void_t:0,double_t:1,single_t:2,int8_t:3,uint8_t:4,int16_t:5,uint16_t:6,int32_t:7,uint32_t:8,int64_t:9,uint64_t:10,string_t:11,structure_t:101,vector_t:102,dictionary_t:103,object_t:104,varvalue_t:105,varobject_t:106,multidimarray_t:107,list_t:108},$enum:!0});Bridge.define("RobotRaconteur.DataTypeUtil",{statics:{size:function(type){switch(type){case RobotRaconteur.DataTypes.double_t:return 8;case RobotRaconteur.DataTypes.single_t:return 4;case RobotRaconteur.DataTypes.int8_t:case RobotRaconteur.DataTypes.uint8_t:return 1;case RobotRaconteur.DataTypes.int16_t:case RobotRaconteur.DataTypes.uint16_t:return 2;case RobotRaconteur.DataTypes.int32_t:case RobotRaconteur.DataTypes.uint32_t:return 4;case RobotRaconteur.DataTypes.int64_t:case RobotRaconteur.DataTypes.uint64_t:return 8;case RobotRaconteur.DataTypes.string_t:return 1}throw new Bridge.InvalidOperationException;},typeIDFromObject:function(obj){if(obj==null)return RobotRaconteur.DataTypes.void_t;if(Bridge.is(obj,Float64Array))return RobotRaconteur.DataTypes.double_t;if(Bridge.is(obj,Float32Array))return RobotRaconteur.DataTypes.single_t;if(Bridge.is(obj,Int8Array))return RobotRaconteur.DataTypes.int8_t;if(Bridge.is(obj,Uint8Array))return RobotRaconteur.DataTypes.uint8_t;if(Bridge.is(obj,Int16Array))return RobotRaconteur.DataTypes.int16_t;if(Bridge.is(obj,Uint16Array))return RobotRaconteur.DataTypes.uint16_t;if(Bridge.is(obj,Int32Array))return RobotRaconteur.DataTypes.int32_t;if(Bridge.is(obj,Uint32Array))return RobotRaconteur.DataTypes.uint32_t;if(Bridge.is(obj,String))return RobotRaconteur.DataTypes.string_t;if(Bridge.is(obj,RobotRaconteur.MessageElementStructure))return RobotRaconteur.DataTypes.structure_t;if(Bridge.is(obj,RobotRaconteur.MessageElementMap$1(Bridge.Int32)))return RobotRaconteur.DataTypes.vector_t;if(Bridge.is(obj,RobotRaconteur.MessageElementMap$1(String)))return RobotRaconteur.DataTypes.dictionary_t;if(Bridge.is(obj,RobotRaconteur.MessageElementMultiDimArray))return RobotRaconteur.DataTypes.multidimarray_t;if(Bridge.is(obj,RobotRaconteur.MessageElementList))return RobotRaconteur.DataTypes.list_t;throw new RobotRaconteur.DataTypeException("Unknown data type");},typeIDFromObject_known:function(obj){return obj==null?!0:Bridge.is(obj,Float64Array)||Bridge.is(obj,Float32Array)||Bridge.is(obj,Int8Array)||Bridge.is(obj,Uint8Array)||Bridge.is(obj,Int16Array)||Bridge.is(obj,Uint16Array)||Bridge.is(obj,Int32Array)||Bridge.is(obj,Uint32Array)||!0||Bridge.is(obj,RobotRaconteur.MessageElementStructure)||Bridge.is(obj,RobotRaconteur.MessageElementMap$1(Bridge.Int32))||Bridge.is(obj,RobotRaconteur.MessageElementMap$1(String))||Bridge.is(obj,RobotRaconteur.MessageElementMultiDimArray)||Bridge.is(obj,RobotRaconteur.MessageElementList)?!0:!1},isNumber:function(t){return t>=RobotRaconteur.DataTypes.double_t&&RobotRaconteur.DataTypes.uint64_t>=t},arrayFromDataType:function(t,length){switch(t){case RobotRaconteur.DataTypes.double_t:return new Float64Array(length);case RobotRaconteur.DataTypes.single_t:return new Float32Array(length);case RobotRaconteur.DataTypes.int8_t:return new Int8Array(length);case RobotRaconteur.DataTypes.uint8_t:return new Uint8Array(length);case RobotRaconteur.DataTypes.int16_t:return new Int16Array(length);case RobotRaconteur.DataTypes.uint16_t:return new Uint16Array(length);case RobotRaconteur.DataTypes.int32_t:return new Int32Array(length);case RobotRaconteur.DataTypes.uint32_t:return new Uint32Array(length);case RobotRaconteur.DataTypes.int64_t:return new Int32Array(length);case RobotRaconteur.DataTypes.uint64_t:return new Uint32Array(length);case RobotRaconteur.DataTypes.string_t:return null;case RobotRaconteur.DataTypes.structure_t:return null}throw new RobotRaconteur.DataTypeException("Could not create array for data type");},arrayFromScalar:function(inv){if(Bridge.is(inv,Array))return inv;var stype=Bridge.getType(inv).toString();switch(stype){case"System.Double":return[Bridge.cast(inv,Bridge.Double)];case"System.Single":return[Bridge.cast(inv,Bridge.Single)];case"System.SByte":return[Bridge.cast(inv,Bridge.SByte)];case"System.Byte":return[Bridge.cast(inv,Bridge.Byte)];case"System.Int16":return[Bridge.cast(inv,Bridge.Int16)];case"System.UInt16":return[Bridge.cast(inv,Bridge.UInt16)];case"System.Int32":return[Bridge.cast(inv,Bridge.Int32)];case"System.UInt32":return[Bridge.cast(inv,Bridge.UInt32)];case"System.Int64":return[Bridge.Long(Bridge.cast(inv,Bridge.Long))];case"System.UInt64":return[Bridge.ULong(Bridge.cast(inv,Bridge.ULong))]}throw new RobotRaconteur.DataTypeException("Could not create array for data");}}});Bridge.define("RobotRaconteur.Evt",{listeners:null,stub:null,def:null,config:{init:function(){this.listeners=new Bridge.List$1(Function)()}},constructor:function(stub,def){this.stub=stub;this.def=def},addListener:function(listener){this.listeners.add(listener)},removeListener:function(listener){this.listeners.remove(listener)},fire:function(m){for(var $t1,param=new Bridge.List$1(Object)(),t,l,$t=Bridge.getEnumerator(this.def.parameters);$t.moveNext();)t=$t.getCurrent(),param.add(this.stub.getRR_Context().unpackMessageElement(m.findElement(t.name),t,this.stub));for(l=this.listeners.toArray(),$t1=Bridge.getEnumerator(l);$t1.moveNext();)(function(){var ll=$t1.getCurrent();Bridge.Task.run(function(){ll(param.toArray())})}).call(this)}});Bridge.define("RobotRaconteur.Extensions",{statics:{ignoreResult:function(t){return t.continueWith($_.RobotRaconteur.Extensions.f1)},awaitWithTimeout:function(task,timeout){var $step=0,$task1,$task2,$taskResult2,$task3,$tcs=new Bridge.TaskCompletionSource,timeout_task,r1,noop,noop1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4,5,6,7,8],$step);switch($step){case 0:if(timeout<0){$step=1;continue}$step=3;continue;case 1:$task1=task;$step=2;$task1.continueWith($asyncBody);return;case 2:$task1.getAwaitedResult();$tcs.setResult(null);return;case 3:timeout_task=Bridge.Task.delay(timeout);$task2=Bridge.Task.whenAny(task,timeout_task);$step=4;$task2.continueWith($asyncBody);return;case 4:if($taskResult2=$task2.getAwaitedResult(),r1=$taskResult2,task.isCompleted()||task.isFaulted()||task.isCanceled()){$step=5;continue}else{$step=7;continue}case 5:noop=RobotRaconteur.Extensions.ignoreResult(timeout_task);$task3=task;$step=6;$task3.continueWith($asyncBody);return;case 6:$task3.getAwaitedResult();$tcs.setResult(null);return;case 7:noop1=RobotRaconteur.Extensions.ignoreResult(task);throw new Bridge.Exception("Operation timed out");case 8:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},awaitWithTimeout$1:function(T,task,timeout){var $step=0,$task1,$taskResult1,$task2,$taskResult2,$task3,$taskResult3,$tcs=new Bridge.TaskCompletionSource,timeout_task,r1,noop,noop1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4,5,6,7,8],$step);switch($step){case 0:if(timeout<0){$step=1;continue}$step=3;continue;case 1:$task1=task;$step=2;$task1.continueWith($asyncBody);return;case 2:$taskResult1=$task1.getAwaitedResult();$tcs.setResult($taskResult1);return;case 3:timeout_task=Bridge.Task.delay(timeout);$task2=Bridge.Task.whenAny(task,timeout_task);$step=4;$task2.continueWith($asyncBody);return;case 4:if($taskResult2=$task2.getAwaitedResult(),r1=$taskResult2,task.isCompleted()||task.isFaulted()||task.isCanceled()){$step=5;continue}else{$step=7;continue}case 5:noop=RobotRaconteur.Extensions.ignoreResult(timeout_task);$task3=task;$step=6;$task3.continueWith($asyncBody);return;case 6:$taskResult3=$task3.getAwaitedResult();$tcs.setResult($taskResult3);return;case 7:noop1=RobotRaconteur.Extensions.ignoreResult(task);throw new Bridge.Exception("Operation timed out");case 8:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},splitEmpty:function(str){return Bridge.String.split(str,[32,9].map(function(i){return String.fromCharCode(i)}),null,1)},splitEmpty$1:function(str,count){return Bridge.String.split(str,[32,9].map(function(i){return String.fromCharCode(i)}),count,1)}}});Bridge.ns("RobotRaconteur.Extensions",$_);Bridge.apply($_.RobotRaconteur.Extensions,{f1:function(t2){try{var e=t2.exception}catch($e1){$e1=Bridge.Exception.create($e1)}}});Bridge.define("RobotRaconteur.ITransportConnection");Bridge.define("RobotRaconteur.Message",{header:null,entries:null,constructor:function(){this.entries=new Bridge.List$1(RobotRaconteur.MessageEntry)()},computeSize:function(){for(var s=this.header.computeSize(),e,$t=Bridge.getEnumerator(this.entries);$t.moveNext();)e=$t.getCurrent(),s=s+e.computeSize()>>>0;return s},write:function(w){var $t,e;for(w.pushRelativeLimit(this.computeSize()),this.header.updateHeader(this.computeSize(),this.entries.getCount()&65535),this.header.write(w),$t=Bridge.getEnumerator(this.entries);$t.moveNext();)e=$t.getCurrent(),e.write(w);if(w.getDistanceFromLimit()!==0)throw new RobotRaconteur.ProtocolException("Message write error");w.popLimit()},findEntry:function(name){var $t,m;if(this.entries==null)return null;for($t=Bridge.getEnumerator(this.entries);$t.moveNext();)if(m=$t.getCurrent(),Bridge.referenceEquals(m.memberName,name))return m;throw new RobotRaconteur.MessageEntryNotFoundException("Element "+name+" not found.");},addEntry:function(t,name){var m=new RobotRaconteur.MessageEntry("constructor");return m.memberName=name,m.entryType=t,this.entries==null&&(this.entries=new Bridge.List$1(RobotRaconteur.MessageEntry)()),this.entries.add(m),m},read:function(r){var s,i,e;for(this.header=new RobotRaconteur.MessageHeader,this.header.read(r),r.pushRelativeLimit(this.header.messageSize-this.header.headerLength>>>0),s=this.header.entryCount,this.entries=new Bridge.List$1(RobotRaconteur.MessageEntry)(s),i=0;i<s;i=i+1|0)e=new RobotRaconteur.MessageEntry("constructor"),e.read(r),this.entries.add(e);r.popLimit()}});Bridge.define("RobotRaconteur.MessageElement",{statics:{findElement:function(m,name){for(var e,$t=Bridge.getEnumerator(m);$t.moveNext();)if(e=$t.getCurrent(),Bridge.referenceEquals(e.elementName,name))return e;throw new RobotRaconteur.MessageElementNotFoundException("Could not find element "+name);},castData:function(T,Data){if(Data==null)return Bridge.getDefaultValue(T);if(Bridge.is(Data,T))return Bridge.cast(Data,T);throw new RobotRaconteur.DataTypeException("Could not cast data to type "+T.toString());}},elementSize:0,elementName:"",elementType:0,elementTypeName:"",metaData:"",dataCount:0,dat:null,constructor:function(){},constructor$1:function(name,datin){this.elementName=name;this.setData(datin)},getData:function(){return this.dat},setData:function(value){this.dat=value;this.updateData()},computeSize:function(){var $t,$t1,$t2,$t3,$t4,s=((16+(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.elementName)>>>0)>>>0)+(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.elementTypeName)>>>0)>>>0)+(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.metaData)>>>0)>>>0,d,e,d1,e1,d2,e2,d3,e3,d4,e4;if(this.elementType===RobotRaconteur.DataTypes.structure_t)for(d=Bridge.cast(this.getData(),RobotRaconteur.MessageElementStructure),$t=Bridge.getEnumerator(d.elements);$t.moveNext();)e=$t.getCurrent(),s=s+e.computeSize()>>>0;else if(this.elementType===RobotRaconteur.DataTypes.vector_t)for(d1=Bridge.cast(this.getData(),RobotRaconteur.MessageElementMap$1(Bridge.Int32)),$t1=Bridge.getEnumerator(d1.elements);$t1.moveNext();)e1=$t1.getCurrent(),s=s+e1.computeSize()>>>0;else if(this.elementType===RobotRaconteur.DataTypes.dictionary_t)for(d2=Bridge.cast(this.getData(),RobotRaconteur.MessageElementMap$1(String)),$t2=Bridge.getEnumerator(d2.elements);$t2.moveNext();)e2=$t2.getCurrent(),s=s+e2.computeSize()>>>0;else if(this.elementType===RobotRaconteur.DataTypes.list_t)for(d3=Bridge.cast(this.getData(),RobotRaconteur.MessageElementList),$t3=Bridge.getEnumerator(d3.elements);$t3.moveNext();)e3=$t3.getCurrent(),s=s+e3.computeSize()>>>0;else if(this.elementType===RobotRaconteur.DataTypes.multidimarray_t)for(d4=Bridge.cast(this.getData(),RobotRaconteur.MessageElementMultiDimArray),$t4=Bridge.getEnumerator(d4.elements);$t4.moveNext();)e4=$t4.getCurrent(),s=s+e4.computeSize()>>>0;else s=this.elementType===RobotRaconteur.DataTypes.void_t?s+0>>>0:s+(this.dataCount*RobotRaconteur.DataTypeUtil.size(this.elementType)>>>0)>>>0;return s},updateData:function(){if(this.dat!=null)if(Bridge.is(this.dat,Float64Array))this.dataCount=Bridge.cast(this.dat,Float64Array).length>>>0;else if(Bridge.is(this.dat,Float32Array))this.dataCount=Bridge.cast(this.dat,Float32Array).length>>>0;else if(Bridge.is(this.dat,Int8Array))this.dataCount=Bridge.cast(this.dat,Int8Array).length>>>0;else if(Bridge.is(this.dat,Uint8Array))this.dataCount=Bridge.cast(this.dat,Uint8Array).length>>>0;else if(Bridge.is(this.dat,Int16Array))this.dataCount=Bridge.cast(this.dat,Int16Array).length>>>0;else if(Bridge.is(this.dat,Uint16Array))this.dataCount=Bridge.cast(this.dat,Uint16Array).length>>>0;else if(Bridge.is(this.dat,Int32Array))this.dataCount=Bridge.cast(this.dat,Int32Array).length>>>0;else if(Bridge.is(this.dat,Uint32Array))this.dataCount=Bridge.cast(this.dat,Uint32Array).length>>>0;else if(Bridge.is(this.dat,RobotRaconteur.MessageElementStructure))this.dataCount=Bridge.cast(this.dat,RobotRaconteur.MessageElementStructure).elements.getCount()>>>0,this.elementTypeName=Bridge.cast(this.dat,RobotRaconteur.MessageElementStructure).type;else if(Bridge.is(this.dat,RobotRaconteur.MessageElementMap$1(Bridge.Int32)))this.dataCount=Bridge.cast(this.dat,RobotRaconteur.MessageElementMap$1(Bridge.Int32)).elements.getCount()>>>0;else if(Bridge.is(this.dat,RobotRaconteur.MessageElementMap$1(String)))this.dataCount=Bridge.cast(this.dat,RobotRaconteur.MessageElementMap$1(String)).elements.getCount()>>>0;else if(Bridge.is(this.dat,RobotRaconteur.MessageElementList))this.dataCount=Bridge.cast(this.dat,RobotRaconteur.MessageElementList).elements.getCount()>>>0;else if(Bridge.is(this.dat,RobotRaconteur.MessageElementMultiDimArray))this.dataCount=Bridge.cast(this.dat,RobotRaconteur.MessageElementMultiDimArray).elements.getCount()>>>0;else if(Bridge.is(this.dat,String))this.dataCount=RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(Bridge.cast(this.dat,String))>>>0;else throw new RobotRaconteur.DataTypeException("Invalid data type");this.elementType=RobotRaconteur.DataTypeUtil.typeIDFromObject(this.dat);this.elementSize=this.computeSize()},write:function(w){var $t,$t1,$t2,$t3,$t4,l,e,l1,e1,l2,e2,l3,e3,l4,e4;if(this.updateData(),w.pushRelativeLimit(this.elementSize),w.write$9(this.elementSize),w.write$8(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.elementName)&65535),w.writeString8(this.elementName),w.write$8(Bridge.cast(this.elementType,Bridge.UInt16)),w.write$8(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.elementTypeName)&65535),w.writeString8(this.elementTypeName),w.write$8(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.metaData)&65535),w.writeString8(this.metaData),w.write$9(this.dataCount),this.dat!=null)if(Bridge.is(this.dat,Float64Array)||Bridge.is(this.dat,Float32Array)||Bridge.is(this.dat,Int8Array)||Bridge.is(this.dat,Uint8Array)||Bridge.is(this.dat,Int16Array)||Bridge.is(this.dat,Uint16Array)||Bridge.is(this.dat,Int32Array)||Bridge.is(this.dat,Uint32Array))w.writeArray(this.dat);else if(Bridge.is(this.dat,RobotRaconteur.MessageElementStructure))for(l=Bridge.cast(this.dat,RobotRaconteur.MessageElementStructure).elements,$t=Bridge.getEnumerator(l);$t.moveNext();)e=$t.getCurrent(),e.write(w);else if(Bridge.is(this.dat,RobotRaconteur.MessageElementMap$1(Bridge.Int32)))for(l1=Bridge.cast(this.dat,RobotRaconteur.MessageElementMap$1(Bridge.Int32)).elements,$t1=Bridge.getEnumerator(l1);$t1.moveNext();)e1=$t1.getCurrent(),e1.write(w);else if(Bridge.is(this.dat,RobotRaconteur.MessageElementMap$1(String)))for(l2=Bridge.cast(this.dat,RobotRaconteur.MessageElementMap$1(String)).elements,$t2=Bridge.getEnumerator(l2);$t2.moveNext();)e2=$t2.getCurrent(),e2.write(w);else if(Bridge.is(this.dat,RobotRaconteur.MessageElementList))for(l3=Bridge.cast(this.dat,RobotRaconteur.MessageElementList).elements,$t3=Bridge.getEnumerator(l3);$t3.moveNext();)e3=$t3.getCurrent(),e3.write(w);else if(Bridge.is(this.dat,String))w.writeString8(Bridge.cast(this.dat,String));else if(Bridge.is(this.dat,RobotRaconteur.MessageElementMultiDimArray))for(l4=Bridge.cast(this.dat,RobotRaconteur.MessageElementMultiDimArray).elements,$t4=Bridge.getEnumerator(l4);$t4.moveNext();)e4=$t4.getCurrent(),e4.write(w);else w.writeNumber(this.dat,this.elementType);if(w.getDistanceFromLimit()!==0)throw new RobotRaconteur.ProtocolException("Message write error");w.popLimit()},read:function(r){var name_s,nametype_s,metadata_s,l,i,m,l1,i1,m1,l2,i2,m2,l3,i3,m3,l4,i4,m4,d;if(this.elementSize=r.readUInt32(),r.pushRelativeLimit(this.elementSize-4>>>0),name_s=r.readUInt16(),this.elementName=r.readString8(name_s),this.elementType=r.readUInt16(),nametype_s=r.readUInt16(),this.elementTypeName=r.readString8(nametype_s),metadata_s=r.readUInt16(),this.metaData=r.readString8(metadata_s),this.dataCount=r.readUInt32(),this.elementType!==RobotRaconteur.DataTypes.void_t)if(this.elementType===RobotRaconteur.DataTypes.structure_t){for(l=new Bridge.List$1(RobotRaconteur.MessageElement)(this.dataCount|0),i=0;Bridge.Long(i).lt(Bridge.Long(this.dataCount));i=i+1|0)m=new RobotRaconteur.MessageElement("constructor"),m.read(r),l.add(m);this.dat=new RobotRaconteur.MessageElementStructure(this.elementTypeName,l)}else if(this.elementType===RobotRaconteur.DataTypes.vector_t){for(l1=new Bridge.List$1(RobotRaconteur.MessageElement)(this.dataCount|0),i1=0;Bridge.Long(i1).lt(Bridge.Long(this.dataCount));i1=i1+1|0)m1=new RobotRaconteur.MessageElement("constructor"),m1.read(r),l1.add(m1);this.dat=new RobotRaconteur.MessageElementMap$1(Bridge.Int32)(l1)}else if(this.elementType===RobotRaconteur.DataTypes.dictionary_t){for(l2=new Bridge.List$1(RobotRaconteur.MessageElement)(this.dataCount|0),i2=0;Bridge.Long(i2).lt(Bridge.Long(this.dataCount));i2=i2+1|0)m2=new RobotRaconteur.MessageElement("constructor"),m2.read(r),l2.add(m2);this.dat=new RobotRaconteur.MessageElementMap$1(String)(l2)}else if(this.elementType===RobotRaconteur.DataTypes.list_t){for(l3=new Bridge.List$1(RobotRaconteur.MessageElement)(this.dataCount|0),i3=0;Bridge.Long(i3).lt(Bridge.Long(this.dataCount));i3=i3+1|0)m3=new RobotRaconteur.MessageElement("constructor"),m3.read(r),l3.add(m3);this.dat=new RobotRaconteur.MessageElementList(l3)}else if(this.elementType===RobotRaconteur.DataTypes.string_t){if(Bridge.Long(this.dataCount).gt(Bridge.Long(r.getDistanceFromLimit())))throw new RobotRaconteur.ProtocolException("Error reading message");this.dat=r.readString8(this.dataCount)}else if(this.elementType===RobotRaconteur.DataTypes.multidimarray_t){for(l4=new Bridge.List$1(RobotRaconteur.MessageElement)(this.dataCount|0),i4=0;Bridge.Long(i4).lt(Bridge.Long(this.dataCount));i4=i4+1|0)m4=new RobotRaconteur.MessageElement("constructor"),m4.read(r),l4.add(m4);this.dat=new RobotRaconteur.MessageElementMultiDimArray(l4)}else{if(Bridge.Long(this.dataCount*RobotRaconteur.DataTypeUtil.size(this.elementType)).gt(Bridge.Long(r.getDistanceFromLimit())))throw new RobotRaconteur.ProtocolException("Error reading message");d=RobotRaconteur.DataTypeUtil.arrayFromDataType(this.elementType,this.dataCount);r.readArray(d);this.dat=d}if(r.getDistanceFromLimit()!==0)throw new RobotRaconteur.ProtocolException("Error reading message");r.popLimit()},castData:function(T){if(this.getData()==null)return Bridge.getDefaultValue(T);if(Bridge.is(this.getData(),T))return Bridge.cast(this.getData(),T);throw new RobotRaconteur.DataTypeException("Could not cast data to type "+T.toString());}});Bridge.define("RobotRaconteur.MessageElementList",{elements:null,constructor:function(e){this.elements=e}});Bridge.define("RobotRaconteur.MessageElementMap$1",function(){return{elements:null,constructor:function(e){this.elements=e}}});Bridge.define("RobotRaconteur.MessageElementMultiDimArray",{elements:null,constructor:function(e){this.elements=e}});Bridge.define("RobotRaconteur.MessageElementStructure",{elements:null,type:null,constructor:function(type_,elements_){this.elements=elements_;this.type=type_}});Bridge.define("RobotRaconteur.MessageEntry",{entrySize:0,entryType:0,servicePath:"",memberName:"",transactionID:0,error:0,metaData:"",elements:null,constructor:function(){this.elements=new Bridge.List$1(RobotRaconteur.MessageElement)()},constructor$1:function(t,n){this.elements=new Bridge.List$1(RobotRaconteur.MessageElement)();this.entryType=t;this.memberName=n},computeSize:function(){for(var s=22,e,$t=Bridge.getEnumerator(this.elements);$t.moveNext();)e=$t.getCurrent(),s=s+e.computeSize()>>>0;return s=s+(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.servicePath)>>>0)>>>0,s=s+(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.memberName)>>>0)>>>0,s+(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.metaData)>>>0)>>>0},findElement:function(name){var $t,m;if(this.elements==null)return null;for($t=Bridge.getEnumerator(this.elements);$t.moveNext();)if(m=$t.getCurrent(),Bridge.referenceEquals(m.elementName,name))return m;throw new RobotRaconteur.MessageElementNotFoundException("Element "+name+" not found.");},addElement$1:function(name,data){var m=new RobotRaconteur.MessageElement("constructor");return m.elementName=name,m.setData(data),this.elements==null&&(this.elements=new Bridge.List$1(RobotRaconteur.MessageElement)()),this.elements.add(m),m},addElement:function(m){return this.elements==null&&(this.elements=new Bridge.List$1(RobotRaconteur.MessageElement)()),this.elements.add(m),m},write:function(w){var $t,e;for(this.entrySize=this.computeSize(),w.pushRelativeLimit(this.entrySize),w.write$9(this.entrySize),w.write$8(Bridge.cast(this.entryType,Bridge.UInt16)),w.write$8(0),w.write$8(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.servicePath)&65535),w.writeString8(this.servicePath),w.write$8(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.memberName)&65535),w.writeString8(this.memberName),w.write$9(this.transactionID),w.write$8(Bridge.cast(this.error,Bridge.UInt16)),w.write$8(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.metaData)&65535),w.writeString8(this.metaData),w.write$8(this.elements.getCount()&65535),$t=Bridge.getEnumerator(this.elements);$t.moveNext();)e=$t.getCurrent(),e.write(w);if(w.getDistanceFromLimit()!==0)throw new RobotRaconteur.ProtocolException("Message write error");w.popLimit()},read:function(r){var sname_s,mname_s,metadata_s,ecount,i,e;for(this.entrySize=r.readUInt32(),r.pushRelativeLimit(this.entrySize-4>>>0),this.entryType=r.readUInt16(),r.readUInt16(),sname_s=r.readUInt16(),this.servicePath=r.readString8(sname_s),mname_s=r.readUInt16(),this.memberName=r.readString8(mname_s),this.transactionID=r.readUInt32(),this.error=r.readUInt16(),metadata_s=r.readUInt16(),this.metaData=r.readString8(metadata_s),ecount=r.readUInt16(),this.elements=new Bridge.List$1(RobotRaconteur.MessageElement)(ecount),i=0;i<ecount;i=i+1|0)e=new RobotRaconteur.MessageElement("constructor"),e.read(r),this.elements.add(e);if(r.getDistanceFromLimit()!==0)throw new RobotRaconteur.ProtocolException("Error reading message");r.popLimit()}});Bridge.define("RobotRaconteur.MessageEntryType",{statics:{Null:0,StreamOp:1,StreamOpRet:2,StreamCheckCapability:3,StreamCheckCapabilityRet:4,GetServiceDesc:101,GetServiceDescRet:102,ObjectTypeName:103,ObjectTypeNameRet:104,ServiceClosed:105,ServiceClosedRet:106,ConnectClient:107,ConnectClientRet:108,DisconnectClient:109,DisconnectClientRet:110,ConnectionTest:111,ConnectionTestRet:112,GetNodeInfo:113,GetNodeInfoRet:114,ReconnectClient:115,ReconnectClientRet:116,NodeCheckCapability:117,NodeCheckCapabilityRet:118,GetServiceAttributes:119,GetServiceAttributesRet:120,EndpointCheckCapability:501,EndpointCheckCapabilityRet:502,ServiceCheckCapabilityReq:1101,ServiceCheckCapabilityRet:1102,ClientKeepAliveReq:1105,ClientKeepAliveRet:1106,ClientSessionOpReq:1107,ClientSessionOpRet:1108,ServicePathReleasedReq:1109,ServicePathReleasedRet:1110,PropertyGetReq:1111,PropertyGetRes:1112,PropertySetReq:1113,PropertySetRes:1114,FunctionCallReq:1121,FunctionCallRes:1122,EventReq:1131,EventRes:1132,PipePacket:1141,PipePacketRet:1142,PipeConnectReq:1143,PipeConnectRet:1144,PipeDisconnectReq:1145,PipeDisconnectRet:1146,PipeClosed:1147,PipeClosedRet:1148,CallbackCallReq:1151,CallbackCallRet:1152,WirePacket:1161,WirePacketRet:1162,WireConnectReq:1163,WireConnectRet:1164,WireDisconnectReq:1165,WireDisconnectRet:1166,WireClosed:1167,WireClosedRet:1168,MemoryRead:1171,MemoryReadRet:1172,MemoryWrite:1173,MemoryWriteRet:1174,MemoryGetParam:1175,MemoryGetParamRet:1176,WireTransportOpReq:11161,WireTransportOpRet:11162,WireTransportEvent:11163,WireTransportEventRet:11164},$enum:!0});Bridge.define("RobotRaconteur.MessageErrorType",{statics:{None:0,ConnectionError:1,ProtocolError:2,ServiceNotFound:3,ObjectNotFound:4,InvalidEndpoint:5,EndpointCommunicationFatalError:6,NodeNotFound:7,ServiceError:8,MemberNotFound:9,MemberFormatMismatch:10,DataTypeMismatch:11,DataTypeError:12,DataSerializationError:13,MessageEntryNotFound:14,MessageElementNotFound:15,UnknownError:16,RemoteError:100,TransactionTimeout:101,AuthenticationError:150,ObjectLockedError:151},$enum:!0});Bridge.define("RobotRaconteur.MessageHeader",{headerLength:0,senderEndpoint:0,receiverEndpoint:0,senderNodeName:"",receiverNodeName:"",senderNodeID:null,receiverNodeID:null,metaData:"",entryCount:0,messageID:0,messageResID:0,messageSize:0,config:{init:function(){this.senderNodeID=new RobotRaconteur.NodeID("constructor",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);this.receiverNodeID=new RobotRaconteur.NodeID("constructor",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}},computeSize:function(){return(((64+RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.senderNodeName)|0)+RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.receiverNodeName)|0)+RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.metaData)|0)&65535},updateHeader:function(message_size,entry_count){this.headerLength=this.computeSize();this.messageSize=message_size;this.entryCount=entry_count},write:function(w){var bSenderNodeID,bReceiverNodeID,i,i1;for(w.pushRelativeLimit(this.headerLength),w.writeString8("RRAC"),w.write$9(this.messageSize),w.write$8(2),w.write$8(this.headerLength),bSenderNodeID=this.senderNodeID.toByteArray(),bReceiverNodeID=this.receiverNodeID.toByteArray(),i=0;i<16;i=i+1|0)w.write(bSenderNodeID[i]);for(i1=0;i1<16;i1=i1+1|0)w.write(bReceiverNodeID[i1]);if(w.write$9(this.senderEndpoint),w.write$9(this.receiverEndpoint),w.write$8(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.senderNodeName)&65535),w.writeString8(this.senderNodeName),w.write$8(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.receiverNodeName)&65535),w.writeString8(this.receiverNodeName),w.write$8(RobotRaconteur.ArrayBinaryWriter.getStringByteCount8(this.metaData)&65535),w.writeString8(this.metaData),w.write$8(this.entryCount),w.write$8(this.messageID),w.write$8(this.messageResID),w.getDistanceFromLimit()!==0)throw new RobotRaconteur.ProtocolException("Message write error");w.popLimit()},read:function(r){var seed=r.readString8(4),version,bSenderNodeID,i,bReceiverNodeID,i1,pname_s,pname_r,meta_s;if(!Bridge.referenceEquals(seed,"RRAC"))throw new RobotRaconteur.ProtocolException("Incorrect message seed");if(this.messageSize=r.readUInt32(),version=r.readUInt16(),version!==2)throw new RobotRaconteur.ProtocolException("Uknown protocol version");for(this.headerLength=r.readUInt16(),r.pushRelativeLimit((this.headerLength-12|0)>>>0),bSenderNodeID=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<16;i=i+1|0)bSenderNodeID[i]=r.readByte();for(this.senderNodeID=new RobotRaconteur.NodeID("constructor",bSenderNodeID),bReceiverNodeID=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i1=0;i1<16;i1=i1+1|0)bReceiverNodeID[i1]=r.readByte();if(this.receiverNodeID=new RobotRaconteur.NodeID("constructor",bReceiverNodeID),this.senderEndpoint=r.readUInt32(),this.receiverEndpoint=r.readUInt32(),pname_s=r.readUInt16(),this.senderNodeName=r.readString8(pname_s),pname_r=r.readUInt16(),this.receiverNodeName=r.readString8(pname_r),meta_s=r.readUInt16(),this.metaData=r.readString8(meta_s),this.entryCount=r.readUInt16(),this.messageID=r.readUInt16(),this.messageResID=r.readUInt16(),r.getDistanceFromLimit()!==0)throw new RobotRaconteur.ProtocolException("Error reading message");r.popLimit()}});Bridge.define("RobotRaconteur.MultiDimArray",{dimCount:0,dims:null,real:null,complex:!1,imag:null,constructor:function(){},constructor$1:function(Dims,Real,Imag){Imag===void 0&&(Imag=null);this.dimCount=Dims.length;this.dims=Dims;this.real=Real;Imag!=null&&(this.complex=!0,this.imag=Imag)},calculateCopyIndices:function(mema,memorypos,memb,startbuffer,count,dimcount,indexa,indexb){var copy_ops,i,stridea,i1,j,strideb,i2,j1,cdims,i3,j2,j3,j4;if(mema.complex!==memb.complex)throw new Bridge.InvalidOperationException("Complex mismatch");if(dimcount.v=mema.dimCount,dimcount.v===0)throw new Bridge.InvalidOperationException("Destination array is empty");if(dimcount.v!==memb.dimCount||dimcount.v!==memorypos.length||dimcount.v!==startbuffer.length||dimcount.v!==count.length)throw new Bridge.InvalidOperationException("Dimension counts do not match");for(copy_ops=1,i=1;i<dimcount.v;i=i+1|0)copy_ops=copy_ops*count[i]|0;for(stridea=Bridge.Array.init(dimcount.v,0),i1=0;i1<dimcount.v;i1=i1+1|0)for(stridea[i1]=1,j=0;j<i1;j=j+1|0)stridea[i1]=stridea[i1]*mema.dims[j]|0;for(strideb=Bridge.Array.init(dimcount.v,0),i2=0;i2<dimcount.v;i2=i2+1|0)for(strideb[i2]=1,j1=0;j1<i2;j1=j1+1|0)strideb[i2]=strideb[i2]*memb.dims[j1]|0;for(cdims=Bridge.Array.init(dimcount.v,0),indexa.v=new Int32Array(copy_ops),indexb.v=new Int32Array(copy_ops),i3=0;i3<copy_ops;i3=i3+1|0){for(indexa.v[i3]=0,j2=0;j2<dimcount.v;j2=j2+1|0)indexa.v[i3]=indexa.v[i3]+((cdims[j2]+memorypos[j2]|0)*stridea[j2]|0)|0;for(indexb.v[i3]=0,j3=0;j3<dimcount.v;j3=j3+1|0)indexb.v[i3]=indexb.v[i3]+((cdims[j3]+startbuffer[j3]|0)*strideb[j3]|0)|0;for(cdims[1]=cdims[1]+1|0,j4=1;j4<dimcount.v;j4=j4+1|0)cdims[j4]>(count[j4]-1|0)&&(cdims[j4]=cdims[j4]-count[j4]|0,j4<(dimcount.v-1|0)&&(cdims[j4+1|0]=cdims[j4+1|0]+1|0))}},retrieveSubArray:function(memorypos,buffer,bufferpos,count){var mema=this,memb=buffer,i;if(mema.complex!==memb.complex)throw new Bridge.InvalidOperationException("Complex mismatch");var indexa={},indexb={};for(this.calculateCopyIndices(mema,memorypos,memb,bufferpos,count,{},indexa,indexb),i=0;i<indexa.v.length;i=i+1|0)Bridge.Array.copy(mema.real,indexa.v[i],memb.real,indexb.v[i],count[0]),mema.complex&&Bridge.Array.copy(mema.imag,indexa.v[i],memb.imag,indexb.v[i],count[0])},assignSubArray:function(memorypos,buffer,bufferpos,count){var mema=this,memb=buffer,i;if(mema.complex!==memb.complex)throw new Bridge.InvalidOperationException("Complex mismatch");var indexa={},indexb={};for(this.calculateCopyIndices(mema,memorypos,memb,bufferpos,count,{},indexa,indexb),i=0;i<indexa.v.length;i=i+1|0)Bridge.Array.copy(memb.real,indexb.v[i],mema.real,indexa.v[i],count[0]),mema.complex&&Bridge.Array.copy(memb.imag,indexb.v[i],mema.imag,indexa.v[i],count[0])}});Bridge.define("RobotRaconteur.NodeID",{statics:{getAny:function(){return new RobotRaconteur.NodeID("constructor",Bridge.Array.init(16,0))},tryParse$1:function(stringid,bytes){var r,res,res1,i,i1,res2,res3,j;if(Bridge.referenceEquals(stringid,"{0}"))return bytes.v=Bridge.Array.init(16,0),!0;if(bytes.v=null,r=new RegExp("\\{?([a-fA-F0-9]{8})-([a-fA-F0-9]{4})-([a-fA-F0-9]{4})-([a-fA-F0-9]{4})-([a-fA-F0-9]{12})\\}?"),res=r.exec(stringid),res==null)return!1;for(res1="",i=1;i<6;i=i+1|0)res1+=res[i];for(bytes.v=Bridge.Array.init(16,0),i1=0;i1<16;i1=i1+1|0){for(res2=res1.substr(i1*2|0,2).toUpperCase(),res3=Bridge.Array.init(2,0),j=0;j<2;j=j+1|0)res3[j]=res2.charCodeAt(j)>=48&&res2.charCodeAt(j)<=57?(res2.charCodeAt(j)-48|0)&255:((res2.charCodeAt(j)-65|0)+10|0)&255;bytes.v[i1]=(res3[0]<<4|res3[1])&255}return!0},tryParse:function(stringid,nodeid){var bytes={};return(nodeid.v=null,!RobotRaconteur.NodeID.tryParse$1(stringid,bytes))?!1:(nodeid.v=new RobotRaconteur.NodeID("constructor",bytes.v),!0)},newUniqueID:function(){for(var byte_id=Bridge.Array.init(16,0),i=0;i<16;i=i+1|0)byte_id[i]=Bridge.Int.clipu8(Math.random()*255);return byte_id[6]=(byte_id[6]&15|64)&255,byte_id[8]=(byte_id[8]&15|160)&255,new RobotRaconteur.NodeID("constructor",byte_id)},op_Explicit:function(i){return i.toByteArray()},op_Equality:function(id1,id2){return id1==null&&id2==null?!0:id1==null&&id2!=null||id1!=null&&id2==null?!1:Bridge.Linq.Enumerable.from(id1.id).sequenceEqual(id2.id)},op_Inequality:function(id1,id2){return id1==null&&id2==null?!1:id1==null&&id2!=null||id1!=null&&id2==null?!0:!Bridge.Linq.Enumerable.from(id1.id).sequenceEqual(id2.id)}},id:null,constructor:function(id){if(id.length!==16)throw new Bridge.InvalidOperationException("Node ID must be 128 bits long");this.id=id},constructor$1:function(id){var id1={};if(RobotRaconteur.NodeID.tryParse$1(id,id1)){this.id=id1.v;return}throw new Bridge.InvalidOperationException("Invalid format for NodeID");},getIsAnyNode:function(){return Bridge.Linq.Enumerable.from(this.id).all($_.RobotRaconteur.NodeID.f1)},toByteArray:function(){var bid=Bridge.Array.init(16,0);return Bridge.Array.copy(this.id,0,bid,0,16),bid},toString:function(){var hexvals=Bridge.Linq.Enumerable.from(this.id).select($_.RobotRaconteur.NodeID.f2).toArray(),g1=hexvals.slice(0,4).join(""),g2=hexvals.slice(4,6).join(""),g3=hexvals.slice(6,8).join(""),g4=hexvals.slice(8,10).join(""),g5=hexvals.slice(10,16).join("");return"{"+[g1,g2,g3,g4,g5].join("-")+"}"},equals:function(obj){return obj==null?!1:Bridge.is(obj,RobotRaconteur.NodeID)?RobotRaconteur.NodeID.op_Equality(this,Bridge.cast(obj,RobotRaconteur.NodeID)):!1},getHashCode:function(){for(var sum=0,b,$t=Bridge.getEnumerator(this.id);$t.moveNext();)b=$t.getCurrent(),sum=sum+b|0;return sum}});Bridge.ns("RobotRaconteur.NodeID",$_);Bridge.apply($_.RobotRaconteur.NodeID,{f1:function(x){return x===0},f2:function(x){return Bridge.String.format("{0:x2}",x)}});Bridge.define("RobotRaconteur.ParseConnectionUrlResult",{scheme:null,host:null,port:0,path:null,nodeid:null,nodename:null,service:null});Bridge.define("RobotRaconteur.Pipe",{statics:{ANY_INDEX:-1},pipeendpoints:null,m_Name:null,datatype:null,stub:null,connecting:null,early_endpoints:null,config:{init:function(){this.pipeendpoints=new Bridge.Dictionary$2(Bridge.Int32,RobotRaconteur.Pipe.PipeEndpoint)();this.connecting=new Bridge.List$1(Object)();this.early_endpoints=new Bridge.Dictionary$2(Bridge.Int32,RobotRaconteur.Pipe.PipeEndpoint)()}},constructor:function(name,datatype,stub){this.m_Name=name;this.stub=stub;this.datatype=datatype},getMemberName:function(){return this.m_Name},sendPipePacket:function(data,index,packetnumber,requestack,e){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,me,m,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:e===void 0&&(e=null);me=this.packPacket(data,index,packetnumber,requestack);m=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.PipePacket,this.getMemberName());m.addElement(me);$task1=this.stub.rR_SendPipeMessage(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},connect:function(index){var $step=0,$task1,$taskResult1,$jumpFromFinally,$tcs=new Bridge.TaskCompletionSource,$returnValue,connecting_key,connecting_key2,m,ret,rindex,e,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4],$step);switch($step){case 0:index===void 0&&(index=-1);connecting_key={};connecting_key2={item1:index,item2:connecting_key};this.connecting.add(connecting_key2);$step=1;continue;case 1:m=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.PipeConnectReq,this.getMemberName());m.addElement(this.stub.getRR_Context().packMessageElement(index,"int32 index",this.stub));$task1=this.stub.rR_ProcessTransaction(m);$step=2;$task1.continueWith($asyncBody);return;case 2:$taskResult1=$task1.getAwaitedResult();ret=$taskResult1;rindex=Bridge.cast(this.stub.getRR_Context().unpackMessageElement(ret.findElement("index"),"int32 index",this.stub),Bridge.Int32);this.early_endpoints.containsKey(rindex)?(e=this.early_endpoints.get(rindex),this.early_endpoints.remove(rindex)):e=new RobotRaconteur.Pipe.PipeEndpoint(this,rindex);this.pipeendpoints.add(rindex,e);$returnValue=e;$step=3;continue;case 3:if(this.connecting.remove(connecting_key2),this.connecting.getCount()===0&&this.early_endpoints.clear(),$jumpFromFinally>-1)$step=$jumpFromFinally,$jumpFromFinally=null;else{if($async_e){$tcs.setException($async_e);return}if(Bridge.isDefined($returnValue)){$tcs.setResult($returnValue);return}}$step=4;continue;case 4:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=2){$step=3;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},pipePacketReceived:function(m,e){var $t,index,ack,$t1,mack,me1,index2;if(e===void 0&&(e=null),m.entryType===RobotRaconteur.MessageEntryType.PipeClosed)try{index=Bridge.cast(this.stub.getRR_Context().unpackMessageElement(m.findElement("index"),"int32 index",this.stub),Bridge.Int32);this.pipeendpoints.get(index).remoteClose()}catch($e1){$e1=Bridge.Exception.create($e1)}else if(m.entryType===RobotRaconteur.MessageEntryType.PipePacket){for(ack=new Bridge.List$1(RobotRaconteur.MessageElement)(),$t=Bridge.getEnumerator(m.elements);$t.moveNext();)$t1=function(){var me=$t.getCurrent(),ack_me;try{var index1=Bridge.Int32.parse(me.elementName),pnum={},p=null;if(this.pipeendpoints.containsKey(index1)?p=this.pipeendpoints.get(index1):this.early_endpoints.containsKey(index1)?p=this.early_endpoints.get(index1):this.connecting.getCount()>0&&Bridge.Linq.Enumerable.from(this.connecting).any(function(x){return x.item1===-1||x.item1===index1})&&(p=new RobotRaconteur.Pipe.PipeEndpoint(this,index1),this.early_endpoints.add(index1,p)),p==null)return{jump:1};this.dispatchPacket(me,p,pnum)&&(ack_me=this.stub.getRR_Context().packMessageElement(pnum.v,"uint32 value",this.stub),ack_me.elementName=me.elementName,ack.add(ack_me))}catch($e2){$e2=Bridge.Exception.create($e2)}}.call(this)||{},$t1.jump==1;try{ack.getCount()>0&&(mack=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.PipePacketRet,m.memberName),mack.elements=ack,RobotRaconteur.Extensions.ignoreResult(this.stub.rR_SendPipeMessage(mack)))}catch($e3){$e3=Bridge.Exception.create($e3)}}else if(m.entryType===RobotRaconteur.MessageEntryType.PipePacketRet)try{for($t1=Bridge.getEnumerator(m.elements);$t1.moveNext();)me1=$t1.getCurrent(),index2=Bridge.Int32.parse(me1.elementName),this.dispatchPacketAck(me1,this.pipeendpoints.get(index2))}catch($e4){$e4=Bridge.Exception.create($e4)}},shutdown:function(){for(var endps=Bridge.Linq.Enumerable.from(this.pipeendpoints.getValues()).toArray(),e,$t=Bridge.getEnumerator(endps);$t.moveNext();){e=$t.getCurrent();try{e.remoteClose()}catch($e1){$e1=Bridge.Exception.create($e1)}}},close:function(e,ee){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,m,ret,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:ee===void 0&&(ee=null);m=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.PipeDisconnectReq,this.getMemberName());m.addElement(this.stub.getRR_Context().packMessageElement(e.getIndex(),"int32 index",this.stub));$task1=this.stub.rR_ProcessTransaction(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();ret=$taskResult1;$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},dispatchPacketAck:function(me,e){var pnum=Bridge.cast(this.stub.getRR_Context().unpackMessageElement(me,"uint32 packetnumber",this.stub),Bridge.UInt32);e.pipePacketAckReceived(pnum)},dispatchPacket:function(me,e,packetnumber){var index=Bridge.Int32.parse(me.elementName),elems=Bridge.cast(me.getData(),RobotRaconteur.MessageElementMap$1(String)).elements,data;return packetnumber.v=Bridge.cast(this.stub.getRR_Context().unpackMessageElement(RobotRaconteur.MessageElement.findElement(elems,"packetnumber"),"uint32 packetnumber",this.stub),Bridge.UInt32),data=this.stub.getRR_Context().unpackMessageElement(RobotRaconteur.MessageElement.findElement(elems,"packet"),this.datatype,this.stub),e.pipePacketReceived(data,packetnumber.v),Bridge.Linq.Enumerable.from(elems).any($_.RobotRaconteur.Pipe.f1)},packPacket:function(data,index,packetnumber,requestack){var elems=new Bridge.List$1(RobotRaconteur.MessageElement)(),elem,delems,me;return elems.add(this.stub.getRR_Context().packMessageElement(packetnumber,"uint32 packetnumber",this.stub)),elem=this.stub.getRR_Context().packMessageElement(data,this.datatype,this.stub),elem.elementName="packet",elems.add(elem),requestack&&elems.add(this.stub.getRR_Context().packMessageElement(1,"int32 requestack",this.stub)),delems=new RobotRaconteur.MessageElementMap$1(String)(elems),me=new RobotRaconteur.MessageElement("constructor$1",index.toString(),delems),me},deleteEndpoint:function(e){this.pipeendpoints.remove(e.getIndex())}});Bridge.ns("RobotRaconteur.Pipe",$_);Bridge.apply($_.RobotRaconteur.Pipe,{f1:function(x){return Bridge.referenceEquals(x.elementName,"requestack")}});Bridge.define("RobotRaconteur.Pipe.PipeEndpoint",{send_packet_number:0,recv_packet_number:0,parent:null,index:0,endpoint:null,requestPacketAck:!1,send_mutex:null,out_of_order_packets:null,recv_lock:null,recv_packets:null,close_callback:null,config:{events:{PacketReceivedEvent:null,PacketAckReceivedEvent:null},init:function(){this.send_mutex=new RobotRaconteur.AsyncMutex;this.out_of_order_packets=new Bridge.Dictionary$2(Bridge.UInt32,Object)();this.recv_lock={};this.recv_packets=new Bridge.List$1(Object)()}},constructor:function(parent,index,endpoint){endpoint===void 0&&(endpoint=null);this.parent=parent;this.index=index;this.endpoint=endpoint},getIndex:function(){return this.index},getEndpoint:function(){return this.endpoint.getLocalEndpoint()},getAvailable:function(){return this.recv_packets.getCount()},getPipeCloseCallback:function(){return this.close_callback},setPipeCloseCallback:function(value){this.close_callback=value},sendPacket:function(packet){var $step=0,$task1,$task2,$jumpFromFinally,$tcs=new Bridge.TaskCompletionSource,$returnValue,mutex,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4,5],$step);switch($step){case 0:mutex=this.send_mutex.enter();$step=1;continue;case 1:$task1=mutex;$step=2;$task1.continueWith($asyncBody);return;case 2:$task1.getAwaitedResult();this.send_packet_number=this.send_packet_number<4294967295?this.send_packet_number+1>>>0:0;$task2=this.parent.sendPipePacket(packet,this.index,this.send_packet_number,this.requestPacketAck,this.endpoint);$step=3;$task2.continueWith($asyncBody);return;case 3:$task2.getAwaitedResult();$returnValue=this.send_packet_number;$step=4;continue;case 4:if(this.send_mutex.exit(mutex),$jumpFromFinally>-1)$step=$jumpFromFinally,$jumpFromFinally=null;else{if($async_e){$tcs.setException($async_e);return}if(Bridge.isDefined($returnValue)){$tcs.setResult($returnValue);return}}$step=5;continue;case 5:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=3){$step=4;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},close:function(){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:$task1=this.parent.close(this);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},increment_packet_number:function(packetnum){return packetnum<4294967295?packetnum+1>>>0:0},pipePacketReceived:function(packet,packetnum){if(packetnum===this.increment_packet_number(this.recv_packet_number)){if(this.recv_packets.add(packet),this.recv_packet_number=this.increment_packet_number(this.recv_packet_number),this.out_of_order_packets.getCount()>0)while(Bridge.Array.contains(this.out_of_order_packets.getKeys(),this.increment_packet_number(this.recv_packet_number))){this.recv_packet_number=this.increment_packet_number(this.recv_packet_number);var opacket=this.out_of_order_packets.get(this.recv_packet_number);this.recv_packets.add(opacket);this.out_of_order_packets.remove(this.recv_packet_number)}if(this.PacketReceivedEvent!=null)try{this.PacketReceivedEvent(this)}catch($e1){$e1=Bridge.Exception.create($e1)}}else this.out_of_order_packets.add(packetnum,packet)},pipePacketAckReceived:function(packetnum){this.PacketAckReceivedEvent(this,packetnum)},peekNextPacket:function(){return Bridge.Linq.Enumerable.from(this.recv_packets).first()},receivePacket:function(){var o=Bridge.Linq.Enumerable.from(this.recv_packets).first();return this.recv_packets.removeAt(0),o},remoteClose:function(){if(this.close_callback!=null)try{this.close_callback(this)}catch($e1){$e1=Bridge.Exception.create($e1)}try{RobotRaconteur.Extensions.ignoreResult(this.close())}catch($e2){$e2=Bridge.Exception.create($e2)}}});Bridge.define("RobotRaconteur.RobotRaconteurExceptionUtil",{statics:{exceptionToMessageEntry:function(exception,entry){if(Bridge.is(exception,RobotRaconteur.RobotRaconteurException)){var r=Bridge.cast(exception,RobotRaconteur.RobotRaconteurException);entry.error=r.errorCode;entry.addElement$1("errorname",r.error);entry.addElement$1("errorstring",r.getMessage())}else entry.error=RobotRaconteur.MessageErrorType.RemoteError,entry.addElement$1("errorname",Bridge.getType(exception).toString()),entry.addElement$1("errorstring",exception.getMessage())},messageEntryToException:function(entry){switch(entry.error){case RobotRaconteur.MessageErrorType.ConnectionError:return new RobotRaconteur.ConnectionException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.ProtocolError:return new RobotRaconteur.ProtocolException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.ServiceNotFound:return new RobotRaconteur.ServiceNotFoundException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.ObjectNotFound:return new RobotRaconteur.ObjectNotFoundException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.InvalidEndpoint:return new RobotRaconteur.InvalidEndpointException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.EndpointCommunicationFatalError:return new RobotRaconteur.EndpointCommunicationFatalException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.NodeNotFound:return new RobotRaconteur.NodeNotFoundException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.ServiceError:return new RobotRaconteur.ServiceException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.MemberNotFound:return new RobotRaconteur.MemberNotFoundException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.MemberFormatMismatch:return new RobotRaconteur.MemberFormatMismatchException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.DataTypeMismatch:return new RobotRaconteur.DataTypeMismatchException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.DataTypeError:return new RobotRaconteur.DataTypeException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.DataSerializationError:return new RobotRaconteur.DataTypeException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.MessageEntryNotFound:return new RobotRaconteur.MessageEntryNotFoundException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.MessageElementNotFound:return new RobotRaconteur.MessageElementNotFoundException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.UnknownError:return new RobotRaconteur.UnknownException(entry.findElement("errorname").castData(String),entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.RemoteError:return new RobotRaconteur.RobotRaconteurRemoteException("constructor$1",entry.findElement("errorname").castData(String),entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.TransactionTimeout:return new RobotRaconteur.TransactionTimeoutException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.AuthenticationError:return new RobotRaconteur.AuthenticationException(entry.findElement("errorstring").castData(String));case RobotRaconteur.MessageErrorType.ObjectLockedError:return new RobotRaconteur.ObjectLockedException(entry.findElement("errorstring").castData(String))}return new RobotRaconteur.RobotRaconteurException("constructor$1",entry.error,entry.findElement("errorname").castData(String),entry.findElement("errorstring").castData(String))}}});Bridge.define("RobotRaconteur.RobotRaconteurNode",{statics:{sp:null,Version:"0.8.0",gets:function(){return RobotRaconteur.RobotRaconteurNode.sp==null&&(RobotRaconteur.RobotRaconteurNode.sp=new RobotRaconteur.RobotRaconteurNode),RobotRaconteur.RobotRaconteurNode.sp}},m_NodeID:null,m_NodeName:null,endpoints:null,endpointInactivityTimeout:6e5,transportInactivityTimeout:6e5,transactionTimeout:15e3,transport:null,config:{init:function(){this.endpoints=new Bridge.Dictionary$2(Bridge.UInt32,RobotRaconteur.Endpoint)()}},constructor:function(){this.transport=new RobotRaconteur.WebSocketTransport(this)},getNodeID:function(){return this.m_NodeID==null&&(this.m_NodeID=RobotRaconteur.NodeID.newUniqueID()),this.m_NodeID},setNodeID:function(value){if(this.m_NodeID==null)this.m_NodeID=value;else throw new Bridge.InvalidOperationException("NodeID cannot be changed once it is set");},getNodeName:function(){return this.m_NodeName==null&&(this.m_NodeName=""),this.m_NodeName},setNodeName:function(value){if(this.m_NodeName==null){var r=new RegExp("^[a-zA-Z][a-zA-Z0-9_\\.\\-]*$");if(r.exec(value)==null)throw new Bridge.InvalidOperationException("Invalid node name");this.m_NodeName=value}else throw new Bridge.InvalidOperationException("NodeName cannot be changed once it is set");},sendMessage:function(m){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,e,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(RobotRaconteur.NodeID.op_Inequality(m.header.senderNodeID,this.getNodeID()))throw new RobotRaconteur.ConnectionException("Could not route message");try{e=this.endpoints.get(m.header.senderEndpoint)}catch($e1){if($e1=Bridge.Exception.create($e1),Bridge.is($e1,Bridge.KeyNotFoundException))throw new RobotRaconteur.InvalidEndpointException("Could not find endpoint");else throw $e1;}$task1=this.transport.sendMessage(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},messageReceived:function(m){var eret,e,eret1;if(RobotRaconteur.NodeID.op_Inequality(m.header.receiverNodeID,this.getNodeID()))eret=this.generateErrorReturnMessage(m,RobotRaconteur.MessageErrorType.NodeNotFound,"RobotRaconteur.NodeNotFound","Could not find route to remote node"),eret.entries.getCount()>0&&RobotRaconteur.Extensions.ignoreResult(this.sendMessage(eret));else try{e=this.endpoints.get(m.header.receiverEndpoint);e.messageReceived(m)}catch($e1){if($e1=Bridge.Exception.create($e1),Bridge.is($e1,Bridge.KeyNotFoundException))eret1=this.generateErrorReturnMessage(m,RobotRaconteur.MessageErrorType.InvalidEndpoint,"RobotRaconteur.InvalidEndpoint","Invalid destination endpoint"),eret1.entries.getCount()>0&&RobotRaconteur.Extensions.ignoreResult(this.sendMessage(eret1));else throw $e1;}},generateErrorReturnMessage:function(m,err,errname,errdesc){var $t,ret=new RobotRaconteur.Message,me,eret;for(ret.header=new RobotRaconteur.MessageHeader,ret.header.receiverNodeName=m.header.senderNodeName,ret.header.senderNodeName=m.header.receiverNodeName,ret.header.receiverNodeID=m.header.senderNodeID,ret.header.receiverEndpoint=m.header.senderEndpoint,ret.header.senderEndpoint=m.header.receiverEndpoint,ret.header.senderNodeID=m.header.receiverNodeID,$t=Bridge.getEnumerator(m.entries);$t.moveNext();)me=$t.getCurrent(),Bridge.cast(me.entryType,Bridge.Int32)%2==1&&(eret=new RobotRaconteur.MessageEntry("constructor$1",me.entryType+1,me.memberName),eret.transactionID=me.transactionID,eret.servicePath=me.servicePath,eret.addElement$1("errorname",errname),eret.addElement$1("errorstring",errdesc),eret.error=err,ret.entries.add(eret));return ret},registerEndpoint:function(e){var ep;do ep=Bridge.Int.clipu32(Math.random()*4294967295);while(this.endpoints.containsKey(ep));return e.m_LocalEndpoint=ep,this.endpoints.add(ep,e),ep},deleteEndpoint:function(e){try{RobotRaconteur.Extensions.ignoreResult(this.transport.closeTransportConnection(e))}catch($e1){$e1=Bridge.Exception.create($e1)}try{this.endpoints.remove(e.getLocalEndpoint())}catch($e2){$e2=Bridge.Exception.create($e2)}},checkConnection:function(endpoint){try{var e;try{e=this.endpoints.get(endpoint)}catch($e1){if($e1=Bridge.Exception.create($e1),Bridge.is($e1,Bridge.KeyNotFoundException))throw new RobotRaconteur.InvalidEndpointException("Invalid endpoint");else throw $e1;}this.transport.checkConnection(endpoint)}catch($e2){if($e2=Bridge.Exception.create($e2),Bridge.is($e2,Bridge.KeyNotFoundException))throw new RobotRaconteur.ConnectionException("Transport not connected");else throw $e2;}},connectService:function(url,username,credentials){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,c,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4],$step);switch($step){case 0:username===void 0&&(username=null);credentials===void 0&&(credentials=null);c=new RobotRaconteur.ClientContext(this);$step=1;continue;case 1:this.registerEndpoint(c);$task1=RobotRaconteur.Extensions.awaitWithTimeout$1(Object,c.connectService(this.transport,url,username,credentials),5e3);$step=2;$task1.continueWith($asyncBody);return;case 2:$taskResult1=$task1.getAwaitedResult();$tcs.setResult($taskResult1);return;case 3:try{this.deleteEndpoint(c)}catch($e1){$e1=Bridge.Exception.create($e1)}throw $async_e;case 4:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=2){$step=3;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},disconnectService:function(obj){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,stub,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:stub=Bridge.cast(obj,RobotRaconteur.ServiceStub);$task1=stub.getRR_Context().close();$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},requestObjectLock:function(obj,flags){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,s,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(!Bridge.is(obj,RobotRaconteur.ServiceStub))throw new Bridge.InvalidOperationException("Can only lock object opened through Robot Raconteur");s=Bridge.cast(obj,RobotRaconteur.ServiceStub);$task1=s.getRR_Context().requestObjectLock(obj,flags);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();$tcs.setResult($taskResult1);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},releaseObjectLock:function(obj){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,s,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(!Bridge.is(obj,RobotRaconteur.ServiceStub))throw new Bridge.InvalidOperationException("Can only unlock object opened through Robot Raconteur");s=Bridge.cast(obj,RobotRaconteur.ServiceStub);$task1=s.getRR_Context().releaseObjectLock(obj);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();$tcs.setResult($taskResult1);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},monitorEnter:function(obj,timeout){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,s,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(timeout===void 0&&(timeout=-1),!Bridge.is(obj,RobotRaconteur.ServiceStub))throw new Bridge.InvalidOperationException("Only service stubs can be monitored by RobotRaconteurNode");s=Bridge.cast(obj,RobotRaconteur.ServiceStub);$task1=s.getRR_Context().monitorEnter(obj,timeout);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();$tcs.setResult($taskResult1);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},monitorExit:function(lock_){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:$task1=lock_.stub.getRR_Context().monitorExit(lock_);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}});Bridge.define("RobotRaconteur.RobotRaconteurNode.MonitorLock",{lock_:null,stub:null});Bridge.define("RobotRaconteur.RobotRaconteurObjectLockFlags",{statics:{USER_LOCK:0,CLIENT_LOCK:1},$enum:!0});Bridge.define("RobotRaconteur.RobotRaconteurParseException",{inherits:[Bridge.Exception],lineNumber:0,constructor:function(e){Bridge.Exception.prototype.$constructor.call(this,e)},constructor$1:function(e,line){Bridge.Exception.prototype.$constructor.call(this,e);this.lineNumber=line},toString:function(){return"RobotRaconteur Parse Error On Line "+this.lineNumber+": "+this.getMessage()}});Bridge.define("RobotRaconteur.RobotRaconteurVarValue",{datatype:null,data:null,constructor:function(data,datatype){this.datatype=datatype;this.data=data}});Bridge.define("RobotRaconteur.ServiceDefinition",{name:null,structures:null,objects:null,options:null,imports:null,exceptions:null,version:"0",config:{init:function(){this.structures=new Bridge.Dictionary$2(String,RobotRaconteur.ServiceEntryDefinition)();this.objects=new Bridge.Dictionary$2(String,RobotRaconteur.ServiceEntryDefinition)();this.options=new Bridge.List$1(String)();this.imports=new Bridge.List$1(String)();this.exceptions=new Bridge.List$1(String)()}},toString:function(){for(var $t1,$t2,$t3,$t4,$t5,o="service "+this.name+"\n\n",$import,option,exception,found,so,so1,d,d1,$t=Bridge.getEnumerator(this.imports);$t.moveNext();)$import=$t.getCurrent(),o+="import "+$import+"\n";for($t1=Bridge.getEnumerator(this.options);$t1.moveNext();)option=$t1.getCurrent(),o+="option "+Bridge.String.replaceAll(option,'"','""')+"\n";for($t2=Bridge.getEnumerator(this.exceptions);$t2.moveNext();)exception=$t2.getCurrent(),o+="exception "+exception+"\n";if(this.version!=null&&!Bridge.referenceEquals(this.version,"")&&!Bridge.referenceEquals(this.version,"0")){for(found=!1,$t3=Bridge.getEnumerator(this.options);$t3.moveNext();)so=$t3.getCurrent(),so1=RobotRaconteur.Extensions.splitEmpty(so),so1.length>0&&Bridge.referenceEquals(so1[0],"version")&&(found=!0);found||(o+="option version "+this.version+"\n")}for(o+="\n",$t4=Bridge.getEnumerator(this.structures.getValues());$t4.moveNext();)d=$t4.getCurrent(),o+=d.toString()+"\n\n";for($t5=Bridge.getEnumerator(this.objects.getValues());$t5.moveNext();)d1=$t5.getCurrent(),o+=d1.toString()+"\n\n";return o},fromString:function(s){for(var $t1,lines2=new Bridge.List$1(String)(),lines3=Bridge.String.split(s,["\n","\r","\r\n"],null,1),pos,lines,s1,stype,odata,i,n1,rr1,s2,s21,l1,initpos,found,se,so,so1,$t=Bridge.getEnumerator(lines3);$t.moveNext();){var l=$t.getCurrent(),l2=l.replace(new RegExp("^[ \\t]*#[^\\n]*$"),""),l3=l2.replace(new RegExp("^[ \\t]+|[ \\t]+$"),"").trim();lines2.add(l3)}for(pos=0,lines=lines2.toArray();lines[pos].length===0;)pos=pos+1|0;if(s1=RobotRaconteur.Extensions.splitEmpty(lines[pos]),!Bridge.referenceEquals(s1[0],"service"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Service name must be specified at start of definition");if(s1.length>2)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Parse error",pos);this.name=s1[1].trim();this.structures=new Bridge.Dictionary$2(String,RobotRaconteur.ServiceEntryDefinition)();this.objects=new Bridge.Dictionary$2(String,RobotRaconteur.ServiceEntryDefinition)();pos=pos+1|0;try{while(pos<lines.length){while(pos<lines.length&&lines[pos].length===0)pos=pos+1|0;if(!(pos<lines.length))break;for(stype=RobotRaconteur.Extensions.splitEmpty(lines[pos])[0].trim();Bridge.referenceEquals(stype,"option")||Bridge.referenceEquals(stype,"import")||Bridge.referenceEquals(stype,"exception");){if(Bridge.referenceEquals(stype,"option")&&(odata=RobotRaconteur.Extensions.splitEmpty$1(lines[pos],2),this.options.add(odata[1].trim()),Bridge.String.startsWith(RobotRaconteur.Extensions.splitEmpty(odata[1])[0],"version"))){var odata2=RobotRaconteur.Extensions.splitEmpty(lines[pos]),ver=odata2[2],nver=Bridge.Linq.Enumerable.from(Bridge.String.split(ver,[46].map(function(i){return String.fromCharCode(i)}))).select($_.RobotRaconteur.ServiceDefinition.f1).toArray(),rrver=Bridge.Linq.Enumerable.from(Bridge.String.split(RobotRaconteur.RobotRaconteurNode.Version,[46].map(function(i){return String.fromCharCode(i)}))).select($_.RobotRaconteur.ServiceDefinition.f1).toArray(),max=nver.length>=rrver.length?nver.length:rrver.length;for(i=0;i<max;i=i+1|0){if(n1=i<nver.length?nver[i]:0,rr1=i<rrver.length?rrver[i]:0,n1>rr1)throw new Bridge.Exception("Service requires newer version of Robot Raconteur");if(n1<rr1)break}}if(Bridge.referenceEquals(stype,"import")){if(s2=RobotRaconteur.Extensions.splitEmpty(lines[pos]),s2.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Parse error",pos);this.imports.add(s2[1])}if(Bridge.referenceEquals(stype,"exception")){if(s21=RobotRaconteur.Extensions.splitEmpty(lines[pos]),s21.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Parse error",pos);this.exceptions.add(s21[1])}for(pos=pos+1|0;pos<lines.length&&lines[pos].length===0;)pos=pos+1|0;if(!(pos<lines.length))break;stype=RobotRaconteur.Extensions.splitEmpty(lines[pos])[0].trim()}for(l1="";pos<lines.length&&lines[pos].length===0;)pos=pos+1|0;if(!(pos<lines.length))break;for(initpos=pos,found=!1;pos<lines.length&&!found;)l1+=lines[pos]+"\n",lines[pos].length>=3&&(found=Bridge.referenceEquals(lines[pos].substr(0,3),"end")),pos=pos+1|0;se=new RobotRaconteur.ServiceEntryDefinition(this);se.fromString$1(l1,initpos);se.isStructure?this.structures.add(se.name,se):this.objects.add(se.name,se)}for($t1=Bridge.getEnumerator(this.options);$t1.moveNext();)if(so=$t1.getCurrent(),so1=RobotRaconteur.Extensions.splitEmpty(so),so1.length>0&&Bridge.referenceEquals(so1[0],"version")){if(so1.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Parse error",pos);this.version=so1[1]}}catch(e){if(e=Bridge.Exception.create(e),Bridge.is(e,RobotRaconteur.RobotRaconteurParseException))throw e;throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Parse error near: "+lines[pos],pos);}},checkVersion:function(verstr){var $t,e,odata_1_split,i,n1,rr1;for(verstr===void 0&&(verstr=null),verstr==null&&(verstr="0.8.0"),$t=Bridge.getEnumerator(this.options);$t.moveNext();)if(e=$t.getCurrent(),odata_1_split=RobotRaconteur.Extensions.splitEmpty(e),Bridge.referenceEquals(odata_1_split[0],"version")){if(odata_1_split.length>2)throw new RobotRaconteur.ServiceException("Invalid version in Service Definition");var ver=odata_1_split[1],nver=Bridge.Linq.Enumerable.from(Bridge.String.split(ver,[46].map(function(i){return String.fromCharCode(i)}))).select($_.RobotRaconteur.ServiceDefinition.f1).toArray(),rrver=Bridge.Linq.Enumerable.from(Bridge.String.split(verstr,[46].map(function(i){return String.fromCharCode(i)}))).select($_.RobotRaconteur.ServiceDefinition.f1).toArray(),max=Math.max(nver.length,rrver.length);for(i=0;i<max;i=i+1|0){if(n1=i<nver.length?nver[i]:0,rr1=i<rrver.length?rrver[i]:0,n1>rr1)throw new RobotRaconteur.ServiceException("Service requires newer version of Robot Raconteur");if(n1<rr1)break}}}});Bridge.ns("RobotRaconteur.ServiceDefinition",$_);Bridge.apply($_.RobotRaconteur.ServiceDefinition,{f1:function(x){return Bridge.Int32.parse(x)}});Bridge.define("RobotRaconteur.ServiceDefinitionUtil",{statics:{splitQualifiedName:function(name){var pos=name.lastIndexOf(String.fromCharCode(46));return pos<0?{item1:Bridge.cast(null,String),item2:name}:{item1:name.substr(0,pos),item2:name.substr(pos+1|0,(name.length-pos|0)-1|0)}},splitParameterString:function(str){for(var o=new Bridge.List$1(String)(),inbracket=!1,pos=0,i=0;i<str.length;i=i+1|0)if(inbracket||str.charCodeAt(i)!==91||(inbracket=!0),inbracket&&str.charCodeAt(i)===93&&(inbracket=!1),!inbracket&&str.charCodeAt(i)===44&&(o.add(str.substr(pos,i-pos|0)),pos=i+1|0,pos>str.length))break;return pos<str.length&&o.add(str.substr(pos)),Bridge.Linq.Enumerable.from(o).select($_.RobotRaconteur.ServiceDefinitionUtil.f1).toArray()}}});Bridge.ns("RobotRaconteur.ServiceDefinitionUtil",$_);Bridge.apply($_.RobotRaconteur.ServiceDefinitionUtil,{f1:function(x){return x.trim()}});Bridge.define("RobotRaconteur.ServiceEntryDefinition",{name:null,members:null,isStructure:!0,"implements":null,options:null,serviceDefinition:null,config:{init:function(){this.members=new Bridge.Dictionary$2(String,RobotRaconteur.MemberDefinition)();this.implements=new Bridge.List$1(String)();this.options=new Bridge.List$1(String)()}},constructor:function(def){this.serviceDefinition=def},toString:function(){for(var $t1,$t2,o=(this.isStructure?"struct":"object")+" "+this.name+"\n",imp,option,d,$t=Bridge.getEnumerator(this.implements);$t.moveNext();)imp=$t.getCurrent(),o+="    implements "+imp+"\n";for($t1=Bridge.getEnumerator(this.options);$t1.moveNext();)option=$t1.getCurrent(),o+="    option "+option+"\n";for($t2=Bridge.getEnumerator(this.members.getValues());$t2.moveNext();)d=$t2.getCurrent(),o+="    "+d.toString()+"\n";return o+="end "+(this.isStructure?"struct":"object")+"\n",this.isStructure&&(o=Bridge.String.replaceAll(o,"property","field")),o},fromString:function(s){this.fromString$1(s,0)},fromString$1:function(s,startline){var tt,i,s2,odata,p1f,p1,p2,p3,p4,p5,p6,p7,p8,r,r1;this.members=new Bridge.Dictionary$2(String,RobotRaconteur.MemberDefinition)();var l=Bridge.String.split(s,[10].map(function(i){return String.fromCharCode(i)})),def=RobotRaconteur.Extensions.splitEmpty(l[0]);if(def.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Parse error",startline);tt=def[0];i=0;try{if(!Bridge.referenceEquals(tt,"struct")&&!Bridge.referenceEquals(tt,"object"))throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Unknown service entry type",startline);for(this.isStructure=Bridge.referenceEquals(tt,"struct"),this.name=def[1].trim(),i=1;i<l.length;i=i+1|0)if(l[i].length!==0){tt=RobotRaconteur.Extensions.splitEmpty(l[i])[0];switch(tt){case"implements":if(this.isStructure)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Structures can only contain fields and options",startline+i|0);if(s2=RobotRaconteur.Extensions.splitEmpty(l[i]),s2.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Parse error",startline+1|0);this.implements.add(s2[1]);break;case"option":odata=RobotRaconteur.Extensions.splitEmpty$1(l[i],2);this.options.add(odata[1].trim());break;case"field":if(!this.isStructure)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Objects cannot contain fields.  Use properties instead.",startline+1|0);p1f=new RobotRaconteur.PropertyDefinition(this);p1f.fromString(l[i]);this.members.add(p1f.name,p1f);break;case"property":if(this.isStructure)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Structures can only contain fields and options",startline+i|0);p1=new RobotRaconteur.PropertyDefinition(this);p1.fromString(l[i]);this.members.add(p1.name,p1);break;case"function":if(this.isStructure)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Structures can only contain fields and options",startline+i|0);p2=new RobotRaconteur.FunctionDefinition(this);p2.fromString(l[i]);this.members.add(p2.name,p2);break;case"event":if(this.isStructure)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Structures can only contain fields and options",startline+i|0);p3=new RobotRaconteur.EventDefinition(this);p3.fromString(l[i]);this.members.add(p3.name,p3);break;case"objref":if(this.isStructure)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Structures can only contain fields and options",startline+i|0);p4=new RobotRaconteur.ObjRefDefinition(this);p4.fromString(l[i]);this.members.add(p4.name,p4);break;case"pipe":if(this.isStructure)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Structures can only contain fields and options",startline+i|0);p5=new RobotRaconteur.PipeDefinition(this);p5.fromString(l[i]);this.members.add(p5.name,p5);break;case"callback":if(this.isStructure)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Structures can only contain fields and options",startline+i|0);p6=new RobotRaconteur.CallbackDefinition(this);p6.fromString(l[i]);this.members.add(p6.name,p6);break;case"wire":if(this.isStructure)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Structures can only contain fields and options",startline+i|0);p7=new RobotRaconteur.WireDefinition(this);p7.fromString(l[i]);this.members.add(p7.name,p7);break;case"memory":if(this.isStructure)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Structures can only contain fields and options",startline+i|0);p8=new RobotRaconteur.MemoryDefinition(this);p8.fromString(l[i]);this.members.add(p8.name,p8);break;case"end":if(this.isStructure){if(r=new RegExp("^end\\s+struct$"),r.exec(l[i].trim())==null)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Parse error",startline+i|0);}else if(r1=new RegExp("^end\\s+object$"),r1.exec(l[i].trim())==null)throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Parse error",startline+i|0);return;default:throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Unknown member type",startline+i|0);}}}catch(exp){exp=Bridge.Exception.create(exp);throw new RobotRaconteur.RobotRaconteurParseException("constructor$1","Parse error: "+exp.getMessage()+" near: "+l[i],startline+i|0);}}});Bridge.define("RobotRaconteur.ServiceStub",{rr_objecttype:null,rR_ServicePath:null,rr_context:null,rr_async_mutex:null,config:{init:function(){this.rr_async_mutex=new RobotRaconteur.AsyncMutex}},constructor:function(objecttype,path,c){this.rr_context=c;this.rR_ServicePath=path;this.rr_objecttype=objecttype},getRR_Context:function(){return this.rr_context},rR_ReleaseContext:function(){this.rr_context=null},rR_ProcessTransaction:function(m){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(this.getRR_Context()==null)throw new RobotRaconteur.ServiceException("Reference has been released");m.servicePath=this.rR_ServicePath;$task1=this.getRR_Context().processTransaction(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();$tcs.setResult($taskResult1);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},rR_FindObjRef:function(n){if(this.getRR_Context()==null)throw new RobotRaconteur.ServiceException("Reference has been released");return this.getRR_Context().findObjRef(this.rR_ServicePath+"."+n)},rR_FindObjRef$1:function(n,i){if(this.getRR_Context()==null)throw new RobotRaconteur.ServiceException("Reference has been released");return this.getRR_Context().findObjRef(this.rR_ServicePath+"."+n+"["+Bridge.String.replaceAll(encodeURI(i.toString()),".","%2e")+"]")},rR_SendPipeMessage:function(m){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(this.getRR_Context()==null)throw new RobotRaconteur.ServiceException("Reference has been released");m.servicePath=this.rR_ServicePath;$task1=this.getRR_Context().sendPipeMessage(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},rR_SendWireMessage:function(m){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(this.getRR_Context()==null)throw new RobotRaconteur.ServiceException("Reference has been released");m.servicePath=this.rR_ServicePath;$task1=this.getRR_Context().sendWireMessage(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}});Bridge.define("RobotRaconteur.Transport",{statics:{m_CurrentThreadTransportConnectionURL:null,m_CurrentThreadTransport:null,getCurrentThreadTransportConnectionURL:function(){return RobotRaconteur.Transport.m_CurrentThreadTransportConnectionURL},getCurrentThreadTransport:function(){return RobotRaconteur.Transport.m_CurrentThreadTransport}},transportID:0,node:null,config:{events:{MessageReceivedEvent:null,TransportListeners:null}},constructor:function(node){node===void 0&&(node=null);this.node=node!=null?node:RobotRaconteur.RobotRaconteurNode.gets()},checkConnection:function(){},sendMessage:function(){throw new Bridge.NotImplementedException;},messageReceived:function(m){this.MessageReceivedEvent(m)},close:function(){return this.fireTransportEventListener(RobotRaconteur.TransportListenerEventType.TransportClosed,null),Bridge.Task.fromResult(0)},fireTransportEventListener:function(ev,parameter){if(this.TransportListeners!=null)try{this.TransportListeners(this,ev,parameter)}catch($e1){$e1=Bridge.Exception.create($e1)}}});Bridge.define("RobotRaconteur.TransportListenerEventType",{statics:{TransportClosed:1,TransportConnectionClosed:2},$enum:!0});Bridge.define("RobotRaconteur.TransportUtil",{statics:{parseConnectionUrl:function(url){var $t,rr1=new RegExp("^([^:\\s]+)://((?:\\[[A-Fa-f0-9\\:]+(?:\\%\\w*)?\\])|(?:[^\\[\\]\\:/\\?\\s]+))(?::([^:/\\?\\s]+))?(?:/([^\\?\\s]*))?\\??([^\\s]*)$"),u1=rr1.exec(url),o,ap,noden,query_params,q2,e,q3,rr;if(u1==null)throw new RobotRaconteur.ConnectionException("Invalid connection URL");if(u1[0]==null||u1[1]==null)throw new RobotRaconteur.ConnectionException("Invalid connection URL");if(o=new RobotRaconteur.ParseConnectionUrlResult,o.scheme=u1[1],o.host=u1[2],o.port=Bridge.referenceEquals(u1[3],"")||u1[3]==null?-1:Bridge.Int32.parse(u1[3]),Bridge.referenceEquals(o.scheme,"tcp")){if(!(Bridge.referenceEquals(u1[5],"")||u1[5]==null))throw new RobotRaconteur.ConnectionException("Invalid connection URL");if(Bridge.referenceEquals(u1[4],"")||u1[4]==null)throw new RobotRaconteur.ConnectionException("Invalid connection URL");if(ap=Bridge.String.split(u1[4],[47].map(function(i){return String.fromCharCode(i)}),null,1),ap.length!==2)throw new RobotRaconteur.ConnectionException("Invalid connection URL");return noden=ap[0],Bridge.String.contains(noden,"{")||Bridge.String.contains(noden,"[")?(o.nodeid=new RobotRaconteur.NodeID("constructor$1",noden),o.nodename=""):(o.nodename=noden,o.nodeid=RobotRaconteur.NodeID.getAny()),o.service=ap[1],o.path="/",o}if(o.port===-1&&((Bridge.referenceEquals(o.scheme,"rr+tcp")||Bridge.referenceEquals(o.scheme,"rrs+tcp"))&&(o.port=48653),(Bridge.referenceEquals(o.scheme,"rr+ws")||Bridge.referenceEquals(o.scheme,"rrs+ws"))&&(o.port=80),(Bridge.referenceEquals(o.scheme,"rr+wss")||Bridge.referenceEquals(o.scheme,"rrs+wss"))&&(o.port=443)),o.path=u1[4],(o.path==null||Bridge.referenceEquals(o.path,""))&&(o.path="/"),query_params=new Bridge.Dictionary$2(String,String)(),Bridge.referenceEquals(u1[5],"")||u1[5]==null)throw new RobotRaconteur.ConnectionException("Invalid connection URL");for(q2=new Bridge.List$1(String)(),$t=Bridge.getEnumerator(Bridge.String.split(Bridge.String.trimStart(u1[5],[63]),[38].map(function(i){return String.fromCharCode(i)}),null,1));$t.moveNext();){if(e=$t.getCurrent(),q3=Bridge.String.split(e,[61].map(function(i){return String.fromCharCode(i)})),q3.length!==2)throw new RobotRaconteur.ConnectionException("Invalid Connection URL");if(q3[0].length===0||q3[1].length===0)throw new RobotRaconteur.ConnectionException("Invalid Connection URL");query_params.add(q3[0],decodeURI(q3[1]))}if(!query_params.containsKey("service"))throw new RobotRaconteur.ConnectionException("Invalid Connection URL");if(o.service=query_params.get("service"),Bridge.String.isNullOrWhiteSpace(o.service))throw new RobotRaconteur.ConnectionException("Invalid Connection URL");if(o.nodeid=query_params.containsKey("nodeid")?new RobotRaconteur.NodeID("constructor$1",query_params.get("nodeid")):RobotRaconteur.NodeID.getAny(),query_params.containsKey("nodename")){if(o.nodename=query_params.get("nodename"),rr=new RegExp("^[a-zA-Z][a-zA-Z0-9_\\.\\-]*$"),rr.exec(o.nodename)==null)throw new RobotRaconteur.ConnectionException('"'+o.nodename+'" is an invalid NodeName');}else o.nodename="";return o}}});Bridge.define("RobotRaconteur.TypeDefinition",{statics:{dataTypeFromString:function(d){switch(d){case"void":return RobotRaconteur.DataTypes.void_t;case"double":return RobotRaconteur.DataTypes.double_t;case"single":return RobotRaconteur.DataTypes.single_t;case"int8":return RobotRaconteur.DataTypes.int8_t;case"uint8":return RobotRaconteur.DataTypes.uint8_t;case"int16":return RobotRaconteur.DataTypes.int16_t;case"uint16":return RobotRaconteur.DataTypes.uint16_t;case"int32":return RobotRaconteur.DataTypes.int32_t;case"uint32":return RobotRaconteur.DataTypes.uint32_t;case"int64":return RobotRaconteur.DataTypes.int64_t;case"uint64":return RobotRaconteur.DataTypes.uint64_t;case"string":return RobotRaconteur.DataTypes.string_t;case"structure":return RobotRaconteur.DataTypes.structure_t;case"object":return RobotRaconteur.DataTypes.object_t;case"varvalue":return RobotRaconteur.DataTypes.varvalue_t;case"varobject":return RobotRaconteur.DataTypes.varobject_t}return RobotRaconteur.DataTypes.structure_t},stringFromDataType:function(d){switch(d){case RobotRaconteur.DataTypes.void_t:return"void";case RobotRaconteur.DataTypes.double_t:return"double";case RobotRaconteur.DataTypes.single_t:return"single";case RobotRaconteur.DataTypes.int8_t:return"int8";case RobotRaconteur.DataTypes.uint8_t:return"uint8";case RobotRaconteur.DataTypes.int16_t:return"int16";case RobotRaconteur.DataTypes.uint16_t:return"uint16";case RobotRaconteur.DataTypes.int32_t:return"int32";case RobotRaconteur.DataTypes.uint32_t:return"uint32";case RobotRaconteur.DataTypes.int64_t:return"int64";case RobotRaconteur.DataTypes.uint64_t:return"uint64";case RobotRaconteur.DataTypes.string_t:return"string";case RobotRaconteur.DataTypes.structure_t:return"structure";case RobotRaconteur.DataTypes.object_t:return"object";case RobotRaconteur.DataTypes.varvalue_t:return"varvalue";case RobotRaconteur.DataTypes.varobject_t:return"varobject"}return null},op_Equality:function(a,b){return Bridge.referenceEquals(a,b)?!0:a==null||b==null?!1:Bridge.referenceEquals(a.name,b.name)?Bridge.referenceEquals(a.typeString,b.typeString)?a.isArray!==b.isArray?!1:a.isMultiDimArray!==b.isMultiDimArray?!1:a.isMap!==b.isMap?!1:a.keyType!==b.keyType?!1:a.isList!==b.isList?!1:a.length!==b.length?!1:a.varLength!==b.varLength?!1:!(a.multiDimLength==null&&b.multiDimLength==null)&&(a.multiDimLength==null||b.multiDimLength==null||!Bridge.Linq.Enumerable.from(a.multiDimLength).sequenceEqual(b.multiDimLength))?!1:a.importedType!==b.importedType?!1:!0:!1:!1},op_Inequality:function(a,b){return!RobotRaconteur.TypeDefinition.op_Equality(a,b)}},name:null,type:0,typeString:null,isArray:!1,isMultiDimArray:!1,isMap:!1,keyType:0,isList:!1,length:0,varLength:!1,multiDimLength:null,importedType:!1,member:null,constructor:function(){},constructor$1:function(copyFrom){this.name=copyFrom.name;this.type=copyFrom.type;this.typeString=copyFrom.typeString;this.isArray=copyFrom.isArray;this.isMultiDimArray=copyFrom.isMultiDimArray;this.isMap=copyFrom.isMap;this.keyType=copyFrom.keyType;this.isList=copyFrom.isList;this.length=copyFrom.length;this.varLength=copyFrom.varLength;this.multiDimLength=copyFrom.multiDimLength;this.member=copyFrom.member},toString:function(){var o=this.type>=RobotRaconteur.DataTypes.structure_t&&!(this.type===RobotRaconteur.DataTypes.varvalue_t)&&!(this.type===RobotRaconteur.DataTypes.varobject_t)?this.typeString:RobotRaconteur.TypeDefinition.stringFromDataType(this.type);return this.isArray&&(o+=this.isMultiDimArray?this.varLength?"[*]":"["+Bridge.toArray(Bridge.Linq.Enumerable.from(this.multiDimLength).select($_.RobotRaconteur.TypeDefinition.f1)).join(",")+"]":"["+(this.length!==0?this.length+(this.varLength?"-":""):"")+"]"),this.isMap&&(o+="{"+RobotRaconteur.TypeDefinition.stringFromDataType(this.keyType)+"}"),this.isList&&(o+="{list}"),o+(" "+this.name)},fromString:function(s){var sres,ttype,stype,sres2,s2,sres21,s21,l,t;if(s=s.trim(),sres=RobotRaconteur.Extensions.splitEmpty(s),ttype=sres[0],this.name=sres.length>1?sres[1].trim():"",sres.length>2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(Bridge.String.contains(ttype,"{")||Bridge.String.contains(ttype,"}")){if(sres2=Bridge.String.split(ttype,[123].map(function(i){return String.fromCharCode(i)})),sres2.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(ttype=sres2[0].trim(),s2=sres2[1].trim(),!Bridge.String.endsWith(s2,"}"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(s2=s2.substr(0,s2.length-1|0),Bridge.String.contains(s2,"{"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Only one dimension of indexing allowed");if(Bridge.String.contains(s2,"}")||Bridge.String.contains(s2,"[")||Bridge.String.contains(s2,"]"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(Bridge.referenceEquals(s2,"list"))this.isList=!0;else if(this.isMap=!0,this.keyType=RobotRaconteur.TypeDefinition.dataTypeFromString(s2),this.keyType!==RobotRaconteur.DataTypes.int32_t&&this.keyType!==RobotRaconteur.DataTypes.string_t)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Only int32 and string types can be used as indexers");}if(Bridge.String.contains(ttype,"[")||Bridge.String.contains(ttype,"]")){if(this.isArray=!0,sres21=Bridge.String.split(ttype,[91].map(function(i){return String.fromCharCode(i)})),sres21.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(stype=sres21[0].trim(),s21=sres21[1],!Bridge.String.endsWith(s21,"]"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(s21=s21.substr(0,s21.length-1|0),Bridge.String.contains(s21,"["))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Use [*] syntax for multidimensional arrays");if(Bridge.String.contains(s21,"]")||Bridge.String.contains(s21,"{")||Bridge.String.contains(s21,"}"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(s21.length===0)this.length=0,this.varLength=!0;else if(Bridge.referenceEquals(s21,"*"))this.isMultiDimArray=!0,this.varLength=!0,this.length=0;else if(Bridge.String.contains(s21,",")){l=null;try{l=Bridge.Linq.Enumerable.from(Bridge.String.split(s21,[44].map(function(i){return String.fromCharCode(i)}))).select($_.RobotRaconteur.TypeDefinition.f2).select($_.RobotRaconteur.TypeDefinition.f3).toArray()}catch($e1){$e1=Bridge.Exception.create($e1);throw new RobotRaconteur.RobotRaconteurParseException("constructor","Could not parse data type: "+s);}this.varLength=!1;this.isMultiDimArray=!0;this.length=0;this.multiDimLength=l}else Bridge.String.endsWith(s21,"-")&&(this.varLength=!0,s21=s21.substr(0,s21.length-1|0)),this.length=Bridge.UInt32.parse(s21)}else stype=ttype;if(Bridge.String.contains(stype,"[")||Bridge.String.contains(stype,"]")||Bridge.String.contains(stype,"{")||Bridge.String.contains(stype,"}"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(Bridge.String.contains(this.name,"[")||Bridge.String.contains(this.name,"]")||Bridge.String.contains(this.name,"{")||Bridge.String.contains(this.name,"}"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");t=RobotRaconteur.TypeDefinition.dataTypeFromString(stype);t===RobotRaconteur.DataTypes.structure_t?(this.type=RobotRaconteur.DataTypes.structure_t,this.typeString=stype,Bridge.String.contains(stype,".")&&(this.importedType=!0)):(this.type=t,this.typeString="")},equals:function(o){return o==null?!1:RobotRaconteur.TypeDefinition.op_Equality(this,Bridge.cast(o,RobotRaconteur.TypeDefinition))}});Bridge.ns("RobotRaconteur.TypeDefinition",$_);Bridge.apply($_.RobotRaconteur.TypeDefinition,{f1:function(x){return x.toString()},f2:function(x){return x.trim()},f3:function(x){return Bridge.UInt32.parse(x)}});Bridge.define("RobotRaconteur.AuthenticationException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.AuthenticationError,"RobotRaconteur.AuthenticationError",message)}});Bridge.define("RobotRaconteur.CallbackDefinition",{inherits:[RobotRaconteur.MemberDefinition],returnType:null,parameters:null,config:{init:function(){this.parameters=new Bridge.List$1(RobotRaconteur.TypeDefinition)()}},constructor:function(ServiceEntry){RobotRaconteur.MemberDefinition.prototype.$constructor.call(this,ServiceEntry)},toString:function(){for(var pa=Bridge.Array.init(this.parameters.getCount(),null),i=0;i<pa.length;i=i+1|0)pa[i]=this.parameters.getItem(i).toString();return"callback "+this.returnType.toString()+" "+this.name+" ("+pa.join(", ")+")"},fromString:function(s){var sp=RobotRaconteur.Extensions.splitEmpty$1(s.trim(),2),sp2,sp3,sp3_1,sp4,pcount,i,d;if(!Bridge.referenceEquals(sp[0].trim(),"callback"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Format Error");if(sp2=RobotRaconteur.Extensions.splitEmpty$1(sp[1],2),this.returnType=new RobotRaconteur.TypeDefinition("constructor"),this.returnType.member=this,this.returnType.fromString(sp2[0]),sp3=Bridge.String.split(sp2[1],[40].map(function(i){return String.fromCharCode(i)})),sp3.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);if(RobotRaconteur.Extensions.splitEmpty(sp3[0]).length!==1)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(this.name=sp3[0].trim(),sp3_1=sp3[1].trim(),!Bridge.String.endsWith(sp3_1,")"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);if(sp3_1=sp3_1.substr(0,sp3_1.length-1|0),Bridge.String.contains(sp3_1,")"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);for(sp4=RobotRaconteur.ServiceDefinitionUtil.splitParameterString(sp3_1),pcount=sp4.length,pcount===1&&sp4[0].trim().length===0&&(pcount=0),this.parameters=new Bridge.List$1(RobotRaconteur.TypeDefinition)(pcount),i=0;i<pcount;i=i+1|0){if(d=new RobotRaconteur.TypeDefinition("constructor"),d.member=this,d.fromString(sp4[i]),Bridge.String.isNullOrWhiteSpace(d.name))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");this.parameters.add(d)}}});Bridge.define("RobotRaconteur.ClientContext",{inherits:[RobotRaconteur.Endpoint],statics:{memberIter:function(T,d){return Bridge.Linq.Enumerable.from(d.members).where(function(x){return Bridge.is(x.value,T)}).select(function(x){return Bridge.as(x.value,T)})}},stubs:null,m_Connected:!1,m_ServiceName:null,rec_wait:null,processTransaction_checkconnection_current:null,transaction_number:0,connecturl:null,root_object_type:null,pulled_service_defs:null,m_UserAuthenticated:!1,m_AuthenticatedUsername:null,config:{init:function(){this.rec_wait=new Bridge.Dictionary$2(Bridge.UInt32,Bridge.TaskCompletionSource)();this.lastMessageSentTime=Bridge.Date.utcNow()||new Date(-864e13);this.pulled_service_defs=new Bridge.Dictionary$2(String,Object)()}},constructor:function(node){RobotRaconteur.Endpoint.prototype.$constructor.call(this,node);this.stubs=new Bridge.Dictionary$2(String,RobotRaconteur.ServiceStub)()},getConnected:function(){return this.m_Connected},getServiceName:function(){return this.m_ServiceName},getUserAuthenticated:function(){return this.m_UserAuthenticated},getAuthenticatedUsername:function(){return this.m_AuthenticatedUsername},findObjRef:function(path){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,e,ret,objecttype,objectdef,stub,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(Bridge.Array.contains(this.stubs.getKeys(),path)){$tcs.setResult(this.stubs.get(path));return}e=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.ObjectTypeName,"");e.servicePath=path;$task1=this.processTransaction(e);$step=1;$task1.continueWith($asyncBody);return;case 1:if($taskResult1=$task1.getAwaitedResult(),ret=$taskResult1,objecttype=ret.findElement("objecttype").castData(String),Bridge.referenceEquals(objecttype,""))throw new RobotRaconteur.ObjectNotFoundException("Object type was not returned.");if(objectdef=RobotRaconteur.ServiceDefinitionUtil.splitQualifiedName(objecttype).item1,stub=this.initStub(objecttype,path),Bridge.Array.contains(this.stubs.getKeys(),path)){$tcs.setResult(this.stubs.get(path));return}this.stubs.set(path,stub);$tcs.setResult(stub);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},processTransaction:function(m){var $step=0,$task1,$jumpFromFinally,$tcs=new Bridge.TaskCompletionSource,$returnValue,transaction_start,transaction_timeout,rec_source,t_id,rec_message,r,$async_e,e,e2,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4],$step);switch($step){case 0:transaction_start=Bridge.Date.utcNow();transaction_timeout=this.node.transactionTimeout;rec_source=new Bridge.TaskCompletionSource;this.transaction_number=this.transaction_number+1>>>0;m.transactionID=this.transaction_number;t_id=this.transaction_number;this.rec_wait.add(t_id,rec_source);this.processTransaction_checkconnection_current==null&&(this.processTransaction_checkconnection_current=this.processTransaction_checkconnection());rec_message=null;$step=1;continue;case 1:r=Bridge.fn.bind(this,function(){var $step=0,$task1,$task2,$taskResult2,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2],$step);switch($step){case 0:$task1=this.sendMessage$1(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$task2=rec_source.task;$step=2;$task2.continueWith($asyncBody);return;case 2:$taskResult2=$task2.getAwaitedResult();rec_message=$taskResult2;$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task});$task1=RobotRaconteur.Extensions.awaitWithTimeout(r(),this.node.transactionTimeout|0);$step=2;$task1.continueWith($asyncBody);return;case 2:$task1.getAwaitedResult();$step=3;continue;case 3:if(this.rec_wait.remove(t_id),$jumpFromFinally>-1)$step=$jumpFromFinally,$jumpFromFinally=null;else{if($async_e){$tcs.setException($async_e);return}if(Bridge.isDefined($returnValue)){$tcs.setResult($returnValue);return}}$step=4;continue;case 4:if(rec_message.transactionID!==t_id)throw new Bridge.Exception("This should be impossible!");if(rec_message.error!==RobotRaconteur.MessageErrorType.None){e=RobotRaconteur.RobotRaconteurExceptionUtil.messageEntryToException(rec_message);e2=Bridge.as(e,RobotRaconteur.RobotRaconteurRemoteException);throw e;}$tcs.setResult(rec_message);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=2){$step=3;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},processTransaction_checkconnection:function(){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,rec_wait2,$t,r,$t1,t,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,5,6],$step);switch($step){case 0:if(1){$step=1;continue}$step=6;continue;case 1:if(this.rec_wait.getCount()<0){this.processTransaction_checkconnection_current=null;$tcs.setResult(null);return}try{this.node.checkConnection(this.getLocalEndpoint())}catch($e1){for($e1=Bridge.Exception.create($e1),rec_wait2=new Bridge.List$1(Bridge.TaskCompletionSource)(),$t=Bridge.getEnumerator(this.rec_wait.getValues());$t.moveNext();)r=$t.getCurrent(),rec_wait2.add(r);for($t1=Bridge.getEnumerator(rec_wait2);$t1.moveNext();)t=$t1.getCurrent(),t.trySetException(new RobotRaconteur.ConnectionException("Connection closed"));$tcs.setResult(null);return}$step=2;continue;case 2:$task1=Bridge.Task.delay(500);$step=3;$task1.continueWith($asyncBody);return;case 3:$task1.getAwaitedResult();$step=5;continue;case 5:$step=0;continue;case 6:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=2&&$step<=3){$step=4;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},sendMessage$1:function(m){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,mm,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(!this.getConnected())throw new RobotRaconteur.ConnectionException("Client has been disconnected");mm=new RobotRaconteur.Message;mm.header=new RobotRaconteur.MessageHeader;mm.entries.add(m);this.lastMessageSentTime=Bridge.Date.utcNow();$task1=this.sendMessage(mm);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},messageReceived:function(m){var $t,mm;if(this.lastMessageReceivedTime=Bridge.Date.utcNow(),!(m.entries.getCount()>=1)||(m.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.ConnectClientRet&&(this.m_RemoteEndpoint=m.header.senderEndpoint,this.m_RemoteNodeID=m.header.senderNodeID,this.m_RemoteNodeName=m.header.senderNodeName),m.entries.getItem(0).entryType!==RobotRaconteur.MessageEntryType.EndpointCheckCapability))for($t=Bridge.getEnumerator(m.entries);$t.moveNext();){if(mm=$t.getCurrent(),mm.error===RobotRaconteur.MessageErrorType.InvalidEndpoint){RobotRaconteur.Extensions.ignoreResult(this.close());return}this.messageEntryReceived(mm)}},messageEntryReceived:function(m){var $t,a,stub,e,r,t_id,a1,stub1,a2,stub2,path,objkeys,path1;if(m.entryType===RobotRaconteur.MessageEntryType.EventReq)a=null,Bridge.Array.contains(this.stubs.getKeys(),m.servicePath)&&(stub=this.stubs.get(m.servicePath),e=Bridge.as(stub[m.memberName],RobotRaconteur.Evt),a=function(){e.fire(m)}),a!=null&&RobotRaconteur.Extensions.ignoreResult(Bridge.Task.run(a));else if(m.entryType===RobotRaconteur.MessageEntryType.PropertyGetRes||m.entryType===RobotRaconteur.MessageEntryType.PropertySetRes||m.entryType===RobotRaconteur.MessageEntryType.FunctionCallRes||m.entryType===RobotRaconteur.MessageEntryType.ObjectTypeNameRet||m.entryType===RobotRaconteur.MessageEntryType.ConnectClientRet||m.entryType===RobotRaconteur.MessageEntryType.DisconnectClientRet||m.entryType===RobotRaconteur.MessageEntryType.GetServiceDescRet||m.entryType>=RobotRaconteur.MessageEntryType.PipeConnectReq&&m.entryType<=RobotRaconteur.MessageEntryType.PipeDisconnectRet||m.entryType===RobotRaconteur.MessageEntryType.ClientSessionOpRet||m.entryType===RobotRaconteur.MessageEntryType.WireConnectRet||m.entryType===RobotRaconteur.MessageEntryType.WireDisconnectRet||m.entryType===RobotRaconteur.MessageEntryType.MemoryReadRet||m.entryType===RobotRaconteur.MessageEntryType.MemoryWriteRet||m.entryType===RobotRaconteur.MessageEntryType.MemoryGetParamRet)r=null,t_id=m.transactionID,this.rec_wait.containsKey(t_id)&&(r=this.rec_wait.get(t_id)),r!=null&&r.trySetResult(m);else if(m.entryType===RobotRaconteur.MessageEntryType.ServiceClosed)RobotRaconteur.Extensions.ignoreResult(this.close());else if(m.entryType!==RobotRaconteur.MessageEntryType.ClientKeepAliveRet)if(m.entryType===RobotRaconteur.MessageEntryType.PipePacket||m.entryType===RobotRaconteur.MessageEntryType.PipeClosed||m.entryType===RobotRaconteur.MessageEntryType.PipePacketRet)a1=null,Bridge.Array.contains(this.stubs.getKeys(),m.servicePath)&&(stub1=this.stubs.get(m.servicePath),a1=function(){Bridge.cast(stub1[m.memberName],RobotRaconteur.Pipe).pipePacketReceived(m)}),a1!=null&&RobotRaconteur.Extensions.ignoreResult(Bridge.Task.run(a1));else if(m.entryType===RobotRaconteur.MessageEntryType.WirePacket||m.entryType===RobotRaconteur.MessageEntryType.WireClosed)a2=null,Bridge.Array.contains(this.stubs.getKeys(),m.servicePath)&&(stub2=this.stubs.get(m.servicePath)),a2!=null&&RobotRaconteur.Extensions.ignoreResult(Bridge.Task.run(a2));else if(m.entryType===RobotRaconteur.MessageEntryType.ServicePathReleasedReq)for(path=m.servicePath,objkeys=Bridge.Linq.Enumerable.from(this.stubs.getKeys()).where(function(x){return x.length>=path.length&&Bridge.referenceEquals(x.substr(0,path.length),path)}).toArray(),$t=Bridge.getEnumerator(objkeys);$t.moveNext();){path1=$t.getCurrent();try{this.stubs.get(path1).rR_ReleaseContext();this.stubs.remove(path1)}catch($e1){$e1=Bridge.Exception.create($e1)}}else if(m.entryType===RobotRaconteur.MessageEntryType.CallbackCallReq)RobotRaconteur.Extensions.ignoreResult(this.processCallbackCall(m));else throw new RobotRaconteur.ServiceException("Unknown service command");},processCallbackCall:function(m){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,ret,stub,s,objectdef,typedef,param,$t,t,cb,ret1,mr,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:ret=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.CallbackCallRet,m.memberName);ret.servicePath=m.servicePath;ret.transactionID=m.transactionID;try{if(!this.stubs.containsKey(m.servicePath))throw new RobotRaconteur.ServiceException("Stub not found");if(stub=this.stubs.get(m.servicePath),s=RobotRaconteur.ServiceDefinitionUtil.splitQualifiedName(stub.rr_objecttype),objectdef=this.getPulledServiceType(s.item1).item2.objects.get(s.item2),typedef=Bridge.as(objectdef.members.get(m.memberName),RobotRaconteur.CallbackDefinition),typedef==null)throw new RobotRaconteur.MemberNotFoundException("Member not found");for(param=new Bridge.List$1(Object)(),$t=Bridge.getEnumerator(typedef.parameters);$t.moveNext();)t=$t.getCurrent(),param.add(this.unpackMessageElement(m.findElement(t.name),t,stub));cb=stub[typedef.name];typedef.returnType.type===RobotRaconteur.DataTypes.void_t?(cb(param.toArray()),ret.addElement(this.packMessageElement(0,"int32 return",stub))):(ret1=cb(param.toArray()),mr=this.packMessageElement(ret1,typedef.returnType,stub),mr.elementName="return",ret.addElement(mr))}catch(e){e=Bridge.Exception.create(e);ret=new RobotRaconteur.MessageEntry("constructor$1",m.entryType+1,m.memberName);ret.servicePath=m.servicePath;ret.transactionID=m.transactionID;RobotRaconteur.RobotRaconteurExceptionUtil.exceptionToMessageEntry(e,ret)}$task1=this.sendMessage$1(ret);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},sendPipeMessage:function(m){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:$task1=this.sendMessage$1(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},sendWireMessage:function(m){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:$task1=this.sendMessage$1(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},connectService:function(c,url,username,credentials){var $step=0,$task1,$taskResult1,$task2,$taskResult2,$task3,$taskResult3,$task4,$taskResult4,$task5,$taskResult5,$tcs=new Bridge.TaskCompletionSource,u,d,$t,d2,e,ret,type,e2,stub,noop,e1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4,5,6,7,8,9,10],$step);switch($step){case 0:if(username===void 0&&(username=null),credentials===void 0&&(credentials=null),this.connecturl=url,u=RobotRaconteur.TransportUtil.parseConnectionUrl(url),this.m_RemoteNodeID=u.nodeid,this.m_RemoteNodeName=u.nodename,this.m_ServiceName=u.service,!c.canConnectService(url))throw new RobotRaconteur.ServiceException("Invalid transport");$task1=c.createTransportConnection(url,this);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();this.transportConnection=$taskResult1;this.m_Connected=!0;$step=2;continue;case 2:this.m_RemoteEndpoint=0;$task2=this.pullServiceDefinitionAndImports(null);$step=3;$task2.continueWith($asyncBody);return;case 3:for($taskResult2=$task2.getAwaitedResult(),d=$taskResult2,$t=Bridge.getEnumerator(d);$t.moveNext();)d2=$t.getCurrent(),this.pulled_service_defs.containsKey(d2.item2.name)||this.pulled_service_defs.add(d2.item2.name,d2);e=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.ObjectTypeName,"");e.servicePath=this.getServiceName();$task3=this.processTransaction(e);$step=4;$task3.continueWith($asyncBody);return;case 4:if($taskResult3=$task3.getAwaitedResult(),ret=$taskResult3,ret.error!==RobotRaconteur.MessageErrorType.None){$tcs.setResult(null);return}if(type=ret.findElement("objecttype").castData(String),Bridge.referenceEquals(type,"")){$tcs.setResult(new RobotRaconteur.ObjectNotFoundException("Could not find object type"));return}this.root_object_type=type;e2=new RobotRaconteur.MessageEntry("constructor");e2.servicePath=this.getServiceName();e2.memberName="registerclient";e2.entryType=RobotRaconteur.MessageEntryType.ConnectClient;$task4=this.processTransaction(e2);$step=5;$task4.continueWith($asyncBody);return;case 5:if($taskResult4=$task4.getAwaitedResult(),username!=null){$step=6;continue}$step=8;continue;case 6:$task5=this.authenticateUser(username,credentials);$step=7;$task5.continueWith($asyncBody);return;case 7:$taskResult5=$task5.getAwaitedResult();$step=8;continue;case 8:stub=this.initStub(type,this.getServiceName());this.stubs.add(this.getServiceName(),stub);noop=this.doHeartbeat();$tcs.setResult(stub);return;case 9:this.m_Connected=!1;try{this.transportConnection.close()}catch($e1){$e1=Bridge.Exception.create($e1)}throw e1;case 10:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=2&&$step<=8){e1=$async_e;$step=9;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},pullServiceDefinition:function(servicetype){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,e3,res,def,d,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:e3=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.GetServiceDesc,"");e3.servicePath=this.m_ServiceName;servicetype!=null&&e3.addElement$1("ServiceType",servicetype);$task1=this.processTransaction(e3);$step=1;$task1.continueWith($asyncBody);return;case 1:if($taskResult1=$task1.getAwaitedResult(),res=$taskResult1,def=res.findElement("servicedef").castData(String),Bridge.referenceEquals(def,""))throw new RobotRaconteur.ServiceNotFoundException("Could not find service definition");d=new RobotRaconteur.ServiceDefinition;d.fromString(def);servicetype==null&&Bridge.Linq.Enumerable.from(res.elements).count($_.RobotRaconteur.ClientContext.f1)!==0;$tcs.setResult({item1:def,item2:d});return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},pullServiceDefinitionAndImports:function(servicetype){var $step=0,$task1,$taskResult1,$task2,$taskResult2,$tcs=new Bridge.TaskCompletionSource,defs,root,$t,i,defs2,$t1,d,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4,5,6,7],$step);switch($step){case 0:defs=new Bridge.List$1(Object)();$task1=this.pullServiceDefinition(servicetype);$step=1;$task1.continueWith($asyncBody);return;case 1:if($taskResult1=$task1.getAwaitedResult(),root=$taskResult1,defs.add(root),root.item2.imports.getCount()===0){$tcs.setResult(defs.toArray());return}$t=Bridge.getEnumerator(root.item2.imports);$step=2;continue;case 2:if($t.moveNext()){i=$t.getCurrent();$step=3;continue}$step=7;continue;case 3:if(Bridge.Linq.Enumerable.from(defs).count(function(x){return Bridge.referenceEquals(x.item2.name,i)})===0){$step=4;continue}$step=6;continue;case 4:$task2=this.pullServiceDefinitionAndImports(i);$step=5;$task2.continueWith($asyncBody);return;case 5:for($taskResult2=$task2.getAwaitedResult(),defs2=$taskResult2,$t1=Bridge.getEnumerator(defs2);$t1.moveNext();)(function(){d=$t1.getCurrent();Bridge.Linq.Enumerable.from(defs).count(function(x){return Bridge.referenceEquals(x.item2.name,d.item2.name)})===0&&defs.add(d)}).call(this);$step=6;continue;case 6:$step=2;continue;case 7:$tcs.setResult(defs.toArray());return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},getPulledServiceType:function(type){if(!this.pulled_service_defs.containsKey(type))throw new RobotRaconteur.ServiceException("Unknown service type");return this.pulled_service_defs.get(type)},getPulledServiceTypes:function(){return Bridge.Linq.Enumerable.from(this.pulled_service_defs.getKeys()).toArray()},doHeartbeat:function(){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,noop,m,noop1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3],$step);switch($step){case 0:if(this.m_Connected){$step=1;continue}$step=3;continue;case 1:Bridge.Date.subdd(Bridge.Date.utcNow(),this.lastMessageReceivedTime).getTotalMilliseconds()>this.node.endpointInactivityTimeout&&(noop=RobotRaconteur.Extensions.ignoreResult(this.close()));this.m_RemoteEndpoint!==0&&Bridge.Date.subdd(Bridge.Date.utcNow(),this.lastMessageSentTime).getTotalMilliseconds()>6e4&&(m=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.ClientKeepAliveReq,""),m.servicePath=this.m_ServiceName,m.transactionID=0,noop1=RobotRaconteur.Extensions.ignoreResult(this.sendMessage$1(m)));$task1=Bridge.Task.delay(5e3);$step=2;$task1.continueWith($asyncBody);return;case 2:$task1.getAwaitedResult();$step=0;continue;case 3:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},close:function(){var $step=0,$tcs=new Bridge.TaskCompletionSource,e,noop,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0],$step);switch($step){case 0:try{e=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.DisconnectClient,"");e.addElement$1("servicename",this.getServiceName());noop=RobotRaconteur.Extensions.ignoreResult(this.processTransaction(e))}catch($e1){$e1=Bridge.Exception.create($e1)}this.stubs.clear();this.m_Connected=!1;this.node.deleteEndpoint(this);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},packMessageElement:function(data,type1,stub){var $t,$t1,$t2,$t3,type,data2,dt,element,type2,l,i,v,el,type21,l1,l2,data21,l3,type1_r,type1_i,typestr2,servicetype_str,structuretype_str,t,servicetype,structuretype,l4,f,mm,data22,count,data3;if(Bridge.is(type1,String)?(type=new RobotRaconteur.TypeDefinition("constructor"),type.fromString(Bridge.cast(type1,String))):type=Bridge.cast(type1,RobotRaconteur.TypeDefinition),type.type!==RobotRaconteur.DataTypes.varvalue_t||type.isMap||type.isList||(data2=Bridge.cast(data,RobotRaconteur.RobotRaconteurVarValue),dt=data2.datatype,RobotRaconteur.Extensions.splitEmpty(dt).length===1&&(dt=dt+" value"),type=new RobotRaconteur.TypeDefinition("constructor"),type.fromString(dt),data=data2.data),element=new RobotRaconteur.MessageElement("constructor"),element.elementName=type.name,data==null){if(type.type>=RobotRaconteur.DataTypes.double_t&&type.type<=RobotRaconteur.DataTypes.uint64_t&&type.length===0&&!type.varLength)throw new Bridge.NullReferenceException("Fixed length array must not be null");if(type.type===RobotRaconteur.DataTypes.multidimarray_t&&!type.varLength)throw new Bridge.NullReferenceException("Fixed dimension array much not be null");return element.elementType=RobotRaconteur.DataTypes.void_t,element.dataCount=0,element.setData(null),element}if(type.isList){for(type2=new RobotRaconteur.TypeDefinition("constructor"),type2.fromString(type.toString()),type2.isList=!1,type2.keyType=RobotRaconteur.DataTypes.void_t,element.elementType=RobotRaconteur.DataTypes.list_t,l=new Bridge.List$1(RobotRaconteur.MessageElement)(),i=0,$t=Bridge.getEnumerator(Bridge.as(data,Bridge.IEnumerable));$t.moveNext();)v=$t.getCurrent(),el=this.packMessageElement(v,type2,stub),el.elementName=i.toString(),l.add(el),i=i+1|0;return element.dataCount=l.getCount()>>>0,element.setData(new RobotRaconteur.MessageElementList(l)),element}if(type.isMap){if(type21=new RobotRaconteur.TypeDefinition("constructor"),type21.fromString(type.toString()),type21.isMap=!1,type21.keyType=RobotRaconteur.DataTypes.void_t,type.keyType===RobotRaconteur.DataTypes.int32_t){for(element.elementType=RobotRaconteur.DataTypes.vector_t,l1=new Bridge.List$1(RobotRaconteur.MessageElement)(),$t1=Bridge.getEnumerator(Bridge.as(data,Bridge.IEnumerable));$t1.moveNext();){var v1=$t1.getCurrent(),v2=v1,el1=this.packMessageElement(v2.value,type21,stub);el1.elementName=v2.key.toString();l1.add(el1)}return element.dataCount=l1.getCount()>>>0,element.setData(new RobotRaconteur.MessageElementMap$1(Bridge.Int32)(l1)),element}if(type.keyType===RobotRaconteur.DataTypes.string_t){for(element.elementType=RobotRaconteur.DataTypes.dictionary_t,l2=new Bridge.List$1(RobotRaconteur.MessageElement)(),$t2=Bridge.getEnumerator(Bridge.as(data,Bridge.IEnumerable));$t2.moveNext();){var v3=$t2.getCurrent(),v21=v3,el2=this.packMessageElement(v21.value,type21,stub);el2.elementName=v21.key.toString();l2.add(el2)}return element.dataCount=l2.getCount()>>>0,element.setData(new RobotRaconteur.MessageElementMap$1(String)(l2)),element}throw new RobotRaconteur.DataTypeException("Invalid key type");}else{if(type.isMultiDimArray)return data21=Bridge.cast(data,RobotRaconteur.MultiDimArray),element.elementType=RobotRaconteur.DataTypes.multidimarray_t,l3=new Bridge.List$1(RobotRaconteur.MessageElement)(),l3.add(this.packMessageElement(data21.dimCount,"int32 dimcount",stub)),l3.add(this.packMessageElement(data21.dims,"int32[] dims",stub)),type1_r=new RobotRaconteur.TypeDefinition("constructor"),type1_r.fromString(type.toString()),type1_r.name="real",type1_r.isMultiDimArray=!1,type1_r.varLength=!0,l3.add(this.packMessageElement(data21.real,type1_r,stub)),data21.complex?(type1_i=new RobotRaconteur.TypeDefinition("constructor"),type1_i.fromString(type.toString()),type1_i.name="imag",type1_i.isMultiDimArray=!1,l3.add(this.packMessageElement(data21.imag,type1_i,stub)),element.dataCount=4):element.dataCount=3,element.setData(new RobotRaconteur.MessageElementMultiDimArray(l3)),element;if(type.type===RobotRaconteur.DataTypes.structure_t){if(typestr2=type.typeString,Bridge.String.contains(typestr2,".")?(t=RobotRaconteur.ServiceDefinitionUtil.splitQualifiedName(typestr2),servicetype_str=t.item1,structuretype_str=t.item2):(servicetype_str=stub==null?RobotRaconteur.ServiceDefinitionUtil.splitQualifiedName(this.root_object_type).item1:RobotRaconteur.ServiceDefinitionUtil.splitQualifiedName(stub.rr_objecttype).item1,structuretype_str=typestr2),servicetype=this.getPulledServiceType(servicetype_str).item2,!servicetype.structures.containsKey(structuretype_str))throw new RobotRaconteur.DataTypeException("Invalid structure type");for(structuretype=servicetype.structures.get(structuretype_str),l4=new Bridge.List$1(RobotRaconteur.MessageElement)(),$t3=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(structuretype.members).select($_.RobotRaconteur.ClientContext.f2));$t3.moveNext();)f=$t3.getCurrent(),mm=this.packMessageElement(data[f.name],f.type,stub),mm.elementName=f.name,l4.add(mm);return element.elementType=RobotRaconteur.DataTypes.structure_t,element.dataCount=l4.getCount()>>>0,element.setData(new RobotRaconteur.MessageElementStructure(servicetype_str+"."+structuretype_str,l4)),element}if(type.type===RobotRaconteur.DataTypes.string_t)return element.elementType=RobotRaconteur.DataTypes.string_t,element.setData(Bridge.as(data,String)),element.dataCount=Bridge.as(data,String).length>>>0,element;if(type.type>=RobotRaconteur.DataTypes.double_t&&type.type<=RobotRaconteur.DataTypes.uint64_t){if(Bridge.is(data,Float64Array)){if(type.type!==RobotRaconteur.DataTypes.double_t)throw new RobotRaconteur.DataTypeMismatchException("Data type mismatch");data22=data;count=Bridge.as(data,Float64Array).length>>>0}else if(Bridge.is(data,Float32Array)){if(type.type!==RobotRaconteur.DataTypes.single_t)throw new RobotRaconteur.DataTypeMismatchException("Data type mismatch");data22=data;count=Bridge.as(data,Float32Array).length>>>0}else if(Bridge.is(data,Uint8Array)){if(type.type!==RobotRaconteur.DataTypes.uint8_t)throw new RobotRaconteur.DataTypeMismatchException("Data type mismatch");data22=data;count=Bridge.as(data,Uint8Array).length>>>0}else if(Bridge.is(data,Int8Array)){if(type.type!==RobotRaconteur.DataTypes.int8_t)throw new RobotRaconteur.DataTypeMismatchException("Data type mismatch");data22=data;count=Bridge.as(data,Int8Array).length>>>0}else if(Bridge.is(data,Uint16Array)){if(type.type!==RobotRaconteur.DataTypes.uint16_t)throw new RobotRaconteur.DataTypeMismatchException("Data type mismatch");data22=data;count=Bridge.as(data,Uint16Array).length>>>0}else if(Bridge.is(data,Int16Array)){if(type.type!==RobotRaconteur.DataTypes.int16_t)throw new RobotRaconteur.DataTypeMismatchException("Data type mismatch");data22=data;count=Bridge.as(data,Int16Array).length>>>0}else if(Bridge.is(data,Uint32Array)){if(type.type!==RobotRaconteur.DataTypes.uint32_t)throw new RobotRaconteur.DataTypeMismatchException("Data type mismatch");data22=data;count=Bridge.as(data,Uint32Array).length>>>0}else if(Bridge.is(data,Int32Array)){if(type.type!==RobotRaconteur.DataTypes.int32_t)throw new RobotRaconteur.DataTypeMismatchException("Data type mismatch");data22=data;count=Bridge.as(data,Int32Array).length>>>0}else{data3=Bridge.isArray(data)?data:[data];switch(type.type){case RobotRaconteur.DataTypes.double_t:data22=new Float64Array(data3);count=Bridge.as(data22,Float64Array).length>>>0;break;case RobotRaconteur.DataTypes.single_t:data22=new Float32Array(data3);count=Bridge.as(data22,Float32Array).length>>>0;break;case RobotRaconteur.DataTypes.uint8_t:data22=new Uint8Array(data3);count=Bridge.as(data22,Uint8Array).length>>>0;break;case RobotRaconteur.DataTypes.int8_t:data22=new Int8Array(data3);count=Bridge.as(data22,Int8Array).length>>>0;break;case RobotRaconteur.DataTypes.uint16_t:data22=new Uint16Array(data3);count=Bridge.as(data22,Uint16Array).length>>>0;break;case RobotRaconteur.DataTypes.int16_t:data22=new Int16Array(data3);count=Bridge.as(data22,Int16Array).length>>>0;break;case RobotRaconteur.DataTypes.uint32_t:data22=new Uint32Array(data3);count=Bridge.as(data22,Uint32Array).length>>>0;break;case RobotRaconteur.DataTypes.int32_t:data22=new Int32Array(data3);count=Bridge.as(data22,Int32Array).length>>>0;break;case RobotRaconteur.DataTypes.uint64_t:case RobotRaconteur.DataTypes.int64_t:throw new Bridge.NotImplementedException("64-bit types not implemented");default:throw new RobotRaconteur.DataTypeException("Could not pack message element");}}if(type.isArray){if(!type.varLength&&count!==type.length)throw new RobotRaconteur.DataTypeException("Expected array of length "+type.length);}else if(count!==1)throw new RobotRaconteur.DataTypeException("Number expected");return element.elementType=type.type,element.dataCount=count,element.setData(data22),element}throw new RobotRaconteur.DataTypeException("Could not pack message element");}},unpackMessageElement:function(element,type1,stub){var $t,$t1,$t2,$t3,type=null,vardata,type1_2t,count,typestr2,servicetype_str,structuretype_str,t,servicetype,structuretype,o,type2,l,i,el1,type21,l1,el2,type22,l2,el3,real,imag;if(type1!=null&&(Bridge.is(type1,String)?(type=new RobotRaconteur.TypeDefinition("constructor"),type.fromString(Bridge.cast(type1,String))):type=Bridge.cast(type1,RobotRaconteur.TypeDefinition),type.type===RobotRaconteur.DataTypes.varvalue_t&&!type.isMap&&!type.isList)){if(type=null,vardata=this.unpackMessageElement(element,null,stub),type1_2t=new RobotRaconteur.TypeDefinition("constructor"),element.elementType>=RobotRaconteur.DataTypes.double_t&&element.elementType<RobotRaconteur.DataTypes.uint64_t)type1_2t.isArray=!0,type1_2t.type=element.elementType;else if(element.elementType===RobotRaconteur.DataTypes.string_t)type1_2t.type=element.elementType;else if(element.elementType===RobotRaconteur.DataTypes.structure_t)type1_2t.type=element.elementType,type1_2t.typeString=element.elementTypeName;else if(element.elementType===RobotRaconteur.DataTypes.list_t)type1_2t.type=RobotRaconteur.DataTypes.varvalue_t,type1_2t.isList=!0;else if(element.elementType===RobotRaconteur.DataTypes.vector_t)type1_2t.type=RobotRaconteur.DataTypes.varvalue_t,type1_2t.isMap=!0,type1_2t.keyType=RobotRaconteur.DataTypes.int32_t;else if(element.elementType===RobotRaconteur.DataTypes.dictionary_t)type1_2t.type=RobotRaconteur.DataTypes.varvalue_t,type1_2t.isMap=!0,type1_2t.keyType=RobotRaconteur.DataTypes.string_t;else if(element.elementType===RobotRaconteur.DataTypes.multidimarray_t)type1_2t.isArray=!0,type1_2t.isMultiDimArray=!0,type1_2t.type=RobotRaconteur.MessageElement.findElement(element.castData(RobotRaconteur.MessageElementMultiDimArray).elements,"real").elementType;else throw new RobotRaconteur.DataTypeException("Invalid data type");return type1_2t.name="value",new RobotRaconteur.RobotRaconteurVarValue(vardata,type1_2t.toString())}if(element.elementType===RobotRaconteur.DataTypes.void_t)return null;if(element.elementType>=RobotRaconteur.DataTypes.double_t&&element.elementType<=RobotRaconteur.DataTypes.uint64_t){if(count=Bridge.cast(element.getData().length,Bridge.UInt32),type!=null)if(type.isArray){if(!type.varLength&&count!==type.length)throw new RobotRaconteur.DataTypeMismatchException("Invalid array length");}else return element.getData()[0];return element.getData()}if(element.elementType===RobotRaconteur.DataTypes.string_t)return element.getData();if(element.elementType===RobotRaconteur.DataTypes.structure_t){if(typestr2=element.elementTypeName,Bridge.String.contains(typestr2,".")?(t=RobotRaconteur.ServiceDefinitionUtil.splitQualifiedName(typestr2),servicetype_str=t.item1,structuretype_str=t.item2):(servicetype_str=stub==null?RobotRaconteur.ServiceDefinitionUtil.splitQualifiedName(this.root_object_type).item1:RobotRaconteur.ServiceDefinitionUtil.splitQualifiedName(stub.rr_objecttype).item1,structuretype_str=typestr2),servicetype=this.getPulledServiceType(servicetype_str).item2,!servicetype.structures.containsKey(structuretype_str))throw new RobotRaconteur.DataTypeException("Invalid structure type");for(structuretype=servicetype.structures.get(structuretype_str),o={},$t=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(structuretype.members).select($_.RobotRaconteur.ClientContext.f2));$t.moveNext();){var f=$t.getCurrent(),el=RobotRaconteur.MessageElement.findElement(element.castData(RobotRaconteur.MessageElementStructure).elements,f.name),field=this.unpackMessageElement(el,f.type,stub);o[f.name]=field}return o}if(element.elementType===RobotRaconteur.DataTypes.list_t){if(type2=null,type!=null){if(!type.isList)throw new RobotRaconteur.DataTypeMismatchException("Type is not a list");type2=new RobotRaconteur.TypeDefinition("constructor");type2.fromString(type.toString());type2.isList=!1;type2.keyType=RobotRaconteur.DataTypes.void_t}for(l=new Bridge.List$1(Object)(),i=0,$t1=Bridge.getEnumerator(element.castData(RobotRaconteur.MessageElementList).elements);$t1.moveNext();){if(el1=$t1.getCurrent(),Bridge.UInt32.parse(el1.elementName)!==i)throw new RobotRaconteur.DataTypeException("Invalid list");l.add(this.unpackMessageElement(el1,type2,stub));i=i+1>>>0}return l}if(element.elementType===RobotRaconteur.DataTypes.vector_t){if(type21=null,type!=null){if(!type.isMap)throw new RobotRaconteur.DataTypeMismatchException("Type is not a map");type21=new RobotRaconteur.TypeDefinition("constructor");type21.fromString(type.toString());type21.isMap=!1;type21.keyType=RobotRaconteur.DataTypes.void_t}for(l1=new Bridge.Dictionary$2(Bridge.Int32,Object)(),$t2=Bridge.getEnumerator(element.castData(RobotRaconteur.MessageElementMap$1(Bridge.Int32)).elements);$t2.moveNext();)el2=$t2.getCurrent(),l1.add(Bridge.Int32.parse(el2.elementName),this.unpackMessageElement(el2,type21,stub));return l1}if(element.elementType===RobotRaconteur.DataTypes.dictionary_t){if(type22=null,type!=null){if(!type.isMap)throw new RobotRaconteur.DataTypeMismatchException("Type is not a map");type22=new RobotRaconteur.TypeDefinition("constructor");type22.fromString(type.toString());type22.isMap=!1;type22.keyType=RobotRaconteur.DataTypes.void_t}for(l2=new Bridge.Dictionary$2(String,Object)(),$t3=Bridge.getEnumerator(element.castData(RobotRaconteur.MessageElementMap$1(String)).elements);$t3.moveNext();)el3=$t3.getCurrent(),l2.add(el3.elementName,this.unpackMessageElement(el3,type22,stub));return l2}if(element.elementType===RobotRaconteur.DataTypes.multidimarray_t){if(type!=null&&!type.isMultiDimArray)throw new RobotRaconteur.DataTypeMismatchException("Invalid Data Type");var elems=element.castData(RobotRaconteur.MessageElementMultiDimArray).elements,dims=Bridge.cast(this.unpackMessageElement(RobotRaconteur.MessageElement.findElement(elems,"dims"),"int32[] value",stub),Int32Array),dimcount=Bridge.cast(this.unpackMessageElement(RobotRaconteur.MessageElement.findElement(elems,"dimcount"),"int value",stub),Bridge.Int32);if(dims.length!==dimcount)throw new RobotRaconteur.DataTypeException("MultiDimArray mismatch");return real=this.unpackMessageElement(RobotRaconteur.MessageElement.findElement(elems,"real"),null,stub),imag=null,Bridge.Linq.Enumerable.from(elems).count($_.RobotRaconteur.ClientContext.f3)!==0&&(imag=this.unpackMessageElement(RobotRaconteur.MessageElement.findElement(elems,"imag"),null,stub)),new RobotRaconteur.MultiDimArray("constructor$1",dims,real,imag)}throw new RobotRaconteur.DataTypeException("Could not unpack message element");},initStub:function(type,path){var $t,$t1,$t2,$t3,$t4,$t5,s=RobotRaconteur.ServiceDefinitionUtil.splitQualifiedName(type),def=this.getPulledServiceType(s.item1),objectdef,stub,p1,p4,pipe_client,p5;if(!def.item2.objects.containsKey(s.item2))throw new RobotRaconteur.ServiceException("Invalid object type");for(objectdef=def.item2.objects.get(s.item2),stub=new RobotRaconteur.ServiceStub(type,path,this),$t=Bridge.getEnumerator(RobotRaconteur.ClientContext.memberIter(RobotRaconteur.PropertyDefinition,objectdef));$t.moveNext();)(function(){var p=$t.getCurrent(),get_=Bridge.fn.bind(this,function(){return Bridge.fn.bind(this,function(){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,req,res,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(arguments.length!==0)throw new Bridge.InvalidOperationException("Incorrect number of function parameters for property get");req=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.PropertyGetReq,p.name);$task1=stub.rR_ProcessTransaction(req);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();res=$taskResult1;$tcs.setResult(this.unpackMessageElement(res.findElement("value"),p.type,stub));return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task})}),set_=Bridge.fn.bind(this,function(){return Bridge.fn.bind(this,function(){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,req,res,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(arguments.length!==1)throw new Bridge.InvalidOperationException("Incorrect number of function parameters for property set");req=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.PropertySetReq,p.name);req.elements.add(this.packMessageElement(arguments[0],p.type,stub));$task1=stub.rR_ProcessTransaction(req);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();res=$taskResult1;$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task})});stub["get_"+p.name]=get_();stub["set_"+p.name]=set_()}).call(this);for($t1=Bridge.getEnumerator(RobotRaconteur.ClientContext.memberIter(RobotRaconteur.EventDefinition,objectdef));$t1.moveNext();)p1=$t1.getCurrent(),stub[p1.name]=new RobotRaconteur.Evt(stub,p1);for($t2=Bridge.getEnumerator(RobotRaconteur.ClientContext.memberIter(RobotRaconteur.FunctionDefinition,objectdef));$t2.moveNext();)(function(){var p2=$t2.getCurrent(),f=Bridge.fn.bind(this,function(){return Bridge.fn.bind(this,function(){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,req,i,res,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(arguments.length!==p2.parameters.getCount())throw new Bridge.InvalidOperationException("Incorrect number of function parameters for: "+p2.name);for(req=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.FunctionCallReq,p2.name),i=0;i<p2.parameters.getCount();i=i+1|0)req.elements.add(this.packMessageElement(arguments[i],p2.parameters.getItem(i),stub));$task1=stub.rR_ProcessTransaction(req);$step=1;$task1.continueWith($asyncBody);return;case 1:if($taskResult1=$task1.getAwaitedResult(),res=$taskResult1,p2.returnType.type===RobotRaconteur.DataTypes.void_t){$tcs.setResult(null);return}$tcs.setResult(this.unpackMessageElement(res.findElement("return"),p2.returnType,stub));return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task})});stub[p2.name]=f()}).call(this);for($t3=Bridge.getEnumerator(RobotRaconteur.ClientContext.memberIter(RobotRaconteur.ObjRefDefinition,objectdef));$t3.moveNext();)(function(){var p3=$t3.getCurrent(),get_1=function(){return p3.isArray||p3.isIndexed?function(){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:$task1=stub.rR_FindObjRef$1(p3.name,arguments[0].toString());$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();$tcs.setResult($taskResult1);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}:function(){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:$task1=stub.rR_FindObjRef(p3.name);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();$tcs.setResult($taskResult1);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}};stub["get_"+p3.name]=get_1()}).call(this);for($t4=Bridge.getEnumerator(RobotRaconteur.ClientContext.memberIter(RobotRaconteur.PipeDefinition,objectdef));$t4.moveNext();)p4=$t4.getCurrent(),pipe_client=new RobotRaconteur.Pipe(p4.name,p4.type,stub),stub[p4.name]=pipe_client;for($t5=Bridge.getEnumerator(RobotRaconteur.ClientContext.memberIter(RobotRaconteur.CallbackDefinition,objectdef));$t5.moveNext();)p5=$t5.getCurrent(),stub[p5.name]=null;return stub},requestObjectLock:function(obj,flags){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,s,command,m,ret,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(!Bridge.is(obj,RobotRaconteur.ServiceStub))throw new Bridge.InvalidOperationException("Can only lock object opened through Robot Raconteur");if(s=Bridge.cast(obj,RobotRaconteur.ServiceStub),command="",flags===RobotRaconteur.RobotRaconteurObjectLockFlags.USER_LOCK)command="RequestObjectLock";else if(flags===RobotRaconteur.RobotRaconteurObjectLockFlags.CLIENT_LOCK)command="RequestClientObjectLock";else throw new Bridge.InvalidOperationException("Unknown flags");m=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.ClientSessionOpReq,command);m.servicePath=s.rR_ServicePath;$task1=this.processTransaction(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();ret=$taskResult1;$tcs.setResult(ret.findElement("return").castData(String));return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},releaseObjectLock:function(obj){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,s,m,ret,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:if(!Bridge.is(obj,RobotRaconteur.ServiceStub))throw new Bridge.InvalidOperationException("Can only lock object opened through Robot Raconteur");s=Bridge.cast(obj,RobotRaconteur.ServiceStub);m=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.ClientSessionOpReq,"ReleaseObjectLock");m.servicePath=s.rR_ServicePath;$task1=this.processTransaction(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();ret=$taskResult1;$tcs.setResult(ret.findElement("return").castData(String));return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},monitorEnter:function(obj,timeout){var $step=0,$task1,$taskResult1,$task2,$taskResult2,$task3,$taskResult3,$jumpFromFinally,$tcs=new Bridge.TaskCompletionSource,$returnValue,iserror,lock_,s,keep_trying,m,ret,retcode,m1,ret1,retcode1,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4,5,6,7,8,10,11],$step);switch($step){case 0:iserror=!0;lock_=null;$step=1;continue;case 1:if(!Bridge.is(obj,RobotRaconteur.ServiceStub))throw new Bridge.InvalidOperationException("Can only unlock object opened through Robot Raconteur");s=Bridge.cast(obj,RobotRaconteur.ServiceStub);$task1=s.rr_async_mutex.lock();$step=2;$task1.continueWith($asyncBody);return;case 2:$taskResult1=$task1.getAwaitedResult();lock_=$taskResult1;keep_trying=!0;m=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.ClientSessionOpReq,"MonitorEnter");m.servicePath=s.rR_ServicePath;m.addElement(this.packMessageElement(timeout,"int32 timeout",s));$task2=this.processTransaction(m);$step=3;$task2.continueWith($asyncBody);return;case 3:if($taskResult2=$task2.getAwaitedResult(),ret=$taskResult2,retcode=ret.findElement("return").castData(String),Bridge.referenceEquals(retcode,"OK")){iserror=!1;$returnValue=Bridge.merge(new RobotRaconteur.RobotRaconteurNode.MonitorLock,{lock_:lock_,stub:s});$step=10;continue}if(Bridge.referenceEquals(retcode,"Continue")){$step=4;continue}else{$step=8;continue}case 4:if(keep_trying){$step=5;continue}$step=7;continue;case 5:m1=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.ClientSessionOpReq,"MonitorContinueEnter");m1.servicePath=s.rR_ServicePath;$task3=this.processTransaction(m1);$step=6;$task3.continueWith($asyncBody);return;case 6:if($taskResult3=$task3.getAwaitedResult(),ret1=$taskResult3,retcode1=ret1.findElement("return").castData(String),Bridge.referenceEquals(retcode1,"OK")){iserror=!1;$returnValue=Bridge.merge(new RobotRaconteur.RobotRaconteurNode.MonitorLock,{lock_:lock_,stub:s});$step=10;continue}if(!Bridge.referenceEquals(retcode1,"Continue"))throw new RobotRaconteur.ProtocolException("Unknown return code");$step=4;continue;case 7:$step=9;continue;case 8:throw new RobotRaconteur.ProtocolException("Unknown return code");case 10:if(iserror&&lock_!=null&&lock_.dispose(),$jumpFromFinally>-1)$step=$jumpFromFinally,$jumpFromFinally=null;else{if($async_e){$tcs.setException($async_e);return}if(Bridge.isDefined($returnValue)){$tcs.setResult($returnValue);return}}$step=11;continue;case 11:throw new RobotRaconteur.ProtocolException("Unknown return code");default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=9){$step=10;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},monitorExit:function(lock_){var $step=0,$task1,$taskResult1,$jumpFromFinally,$tcs=new Bridge.TaskCompletionSource,$returnValue,m,ret,retcode,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([1,2,3,4],$step);switch($step){case 1:m=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.ClientSessionOpReq,"MonitorExit");m.servicePath=lock_.stub.rR_ServicePath;$task1=this.processTransaction(m);$step=2;$task1.continueWith($asyncBody);return;case 2:if($taskResult1=$task1.getAwaitedResult(),ret=$taskResult1,retcode=ret.findElement("return").castData(String),!Bridge.referenceEquals(retcode,"OK"))throw new RobotRaconteur.ProtocolException("Unknown return code");$step=3;continue;case 3:try{lock_.lock_.dispose()}catch($e1){$e1=Bridge.Exception.create($e1)}if($jumpFromFinally>-1)$step=$jumpFromFinally,$jumpFromFinally=null;else{if($async_e){$tcs.setException($async_e);return}if(Bridge.isDefined($returnValue)){$tcs.setResult($returnValue);return}}$step=4;continue;case 4:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=2){$step=3;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},authenticateUser:function(username,credentials){var $step=0,$task1,$taskResult1,$tcs=new Bridge.TaskCompletionSource,m,ret,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:m=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.ClientSessionOpReq,"AuthenticateUser");m.servicePath=this.getServiceName();m.addElement(this.packMessageElement(username,"string username",null));m.addElement(this.packMessageElement(credentials,"varvalue{string} credentials",null));$task1=this.processTransaction(m);$step=1;$task1.continueWith($asyncBody);return;case 1:$taskResult1=$task1.getAwaitedResult();ret=$taskResult1;this.m_AuthenticatedUsername=username;this.m_UserAuthenticated=!0;$tcs.setResult(ret.findElement("return").castData(String));return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}});Bridge.ns("RobotRaconteur.ClientContext",$_);Bridge.apply($_.RobotRaconteur.ClientContext,{f1:function(x){return Bridge.referenceEquals(x.elementName,"attributes")},f2:function(x){return Bridge.as(x.value,RobotRaconteur.PropertyDefinition)},f3:function(x){return Bridge.referenceEquals(x.elementName,"imag")}});Bridge.define("RobotRaconteur.ConnectionException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.ConnectionError,"RobotRaconteur.ConnectionError",message)}});Bridge.define("RobotRaconteur.DataSerializationException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.DataSerializationError,"RobotRaconteur.DataSerializationError",message)}});Bridge.define("RobotRaconteur.DataTypeException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.DataTypeError,"RobotRaconteur.DataTypeError",message)}});Bridge.define("RobotRaconteur.DataTypeMismatchException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.DataTypeMismatch,"RobotRaconteur.DataTypeMismatch",message)}});Bridge.define("RobotRaconteur.EndpointCommunicationFatalException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.EndpointCommunicationFatalError,"RobotRaconteur.EndpointCommunicationFatalError",message)}});Bridge.define("RobotRaconteur.EventDefinition",{inherits:[RobotRaconteur.MemberDefinition],parameters:null,config:{init:function(){this.parameters=new Bridge.List$1(RobotRaconteur.TypeDefinition)()}},constructor:function(ServiceEntry){RobotRaconteur.MemberDefinition.prototype.$constructor.call(this,ServiceEntry)},toString:function(){for(var pa=Bridge.Array.init(this.parameters.getCount(),null),i=0;i<pa.length;i=i+1|0)pa[i]=this.parameters.getItem(i).toString();return"event "+this.name+" ("+pa.join(", ")+")"},fromString:function(s){var sp=RobotRaconteur.Extensions.splitEmpty$1(s.trim(),2),sp3,sp3_1,sp4,pcount,i,d;if(!Bridge.referenceEquals(sp[0].trim(),"event"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Format Error");if(sp3=Bridge.String.split(sp[1],[40].map(function(i){return String.fromCharCode(i)})),sp3.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);if(RobotRaconteur.Extensions.splitEmpty(sp3[0]).length!==1)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(this.name=sp3[0].trim(),sp3_1=sp3[1].trim(),!Bridge.String.endsWith(sp3_1,")"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);if(sp3_1=sp3_1.substr(0,sp3_1.length-1|0),Bridge.String.contains(sp3_1,")"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);for(sp4=RobotRaconteur.ServiceDefinitionUtil.splitParameterString(sp3_1),pcount=sp4.length,pcount===1&&sp4[0].trim().length===0&&(pcount=0),this.parameters=new Bridge.List$1(RobotRaconteur.TypeDefinition)(pcount),i=0;i<pcount;i=i+1|0){if(d=new RobotRaconteur.TypeDefinition("constructor"),d.member=this,d.fromString(sp4[i]),Bridge.String.isNullOrWhiteSpace(d.name))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");this.parameters.add(d)}}});Bridge.define("RobotRaconteur.FunctionDefinition",{inherits:[RobotRaconteur.MemberDefinition],returnType:null,parameters:null,config:{init:function(){this.parameters=new Bridge.List$1(RobotRaconteur.TypeDefinition)()}},constructor:function(ServiceEntry){RobotRaconteur.MemberDefinition.prototype.$constructor.call(this,ServiceEntry)},toString:function(){for(var pa=Bridge.Array.init(this.parameters.getCount(),null),i=0;i<pa.length;i=i+1|0)pa[i]=this.parameters.getItem(i).toString();return"function "+this.returnType.toString()+" "+this.name+" ("+pa.join(", ")+")"},fromString:function(s){var sp=RobotRaconteur.Extensions.splitEmpty$1(s.trim(),2),sp2,sp3,sp3_1,sp4,pcount,i,d;if(!Bridge.referenceEquals(sp[0].trim(),"function"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Format Error");if(sp2=RobotRaconteur.Extensions.splitEmpty$1(sp[1],2),this.returnType=new RobotRaconteur.TypeDefinition("constructor"),this.returnType.member=this,this.returnType.fromString(sp2[0]),sp3=Bridge.String.split(sp2[1],[40].map(function(i){return String.fromCharCode(i)})),sp3.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);if(RobotRaconteur.Extensions.splitEmpty(sp3[0]).length!==1)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(this.name=sp3[0].trim(),sp3_1=sp3[1].trim(),!Bridge.String.endsWith(sp3_1,")"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);if(sp3_1=sp3_1.substr(0,sp3_1.length-1|0),Bridge.String.contains(sp3_1,")"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);for(sp4=RobotRaconteur.ServiceDefinitionUtil.splitParameterString(sp3_1),pcount=sp4.length,pcount===1&&sp4[0].trim().length===0&&(pcount=0),this.parameters=new Bridge.List$1(RobotRaconteur.TypeDefinition)(pcount),i=0;i<pcount;i=i+1|0){if(d=new RobotRaconteur.TypeDefinition("constructor"),d.member=this,d.fromString(sp4[i]),Bridge.String.isNullOrWhiteSpace(d.name))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");this.parameters.add(d)}}});Bridge.define("RobotRaconteur.InvalidEndpointException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.InvalidEndpoint,"RobotRaconteur.InvalidEndpoint",message)}});Bridge.define("RobotRaconteur.MemberFormatMismatchException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.MemberFormatMismatch,"RobotRaconteur.MemberFormatMismatch",message)}});Bridge.define("RobotRaconteur.MemberNotFoundException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.MemberNotFound,"RobotRaconteur.MemberNotFound",message)}});Bridge.define("RobotRaconteur.MemoryDefinition",{inherits:[RobotRaconteur.MemberDefinition],type:null,constructor:function(ServiceEntry){RobotRaconteur.MemberDefinition.prototype.$constructor.call(this,ServiceEntry)},toString:function(){var t=new RobotRaconteur.TypeDefinition("constructor$1",this.type);return t.name=this.name,t.member=this,Bridge.String.format("memory {0}",t.toString())},fromString:function(s){var sp=RobotRaconteur.Extensions.splitEmpty$1(s.trim(),2);if(!Bridge.referenceEquals(sp[0].trim(),"memory"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Format Error");if(sp.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);if(this.type=new RobotRaconteur.TypeDefinition("constructor"),this.type.member=this,this.type.fromString(sp[1]),Bridge.String.isNullOrWhiteSpace(this.type.name))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(this.name=this.type.name,this.type.name="packettype",!this.type.isArray||this.type.isMap)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Memory must be an array or multidimarray");if(!(this.type.type>=RobotRaconteur.DataTypes.double_t&&this.type.type<=RobotRaconteur.DataTypes.uint64_t))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Memory must be a number array or multidimarray");}});Bridge.define("RobotRaconteur.MessageElementNotFoundException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.MessageElementNotFound,"RobotRaconteur.MessageElementNotFound",message)}});Bridge.define("RobotRaconteur.MessageEntryNotFoundException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.MessageEntryNotFound,"RobotRaconteur.MessageEntryNotFound",message)}});Bridge.define("RobotRaconteur.NodeNotFoundException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.NodeNotFound,"RobotRaconteur.NodeNotFound",message)}});Bridge.define("RobotRaconteur.ObjectLockedException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.ObjectLockedError,"RobotRaconteur.ObjectLockedError",message)}});Bridge.define("RobotRaconteur.ObjectNotFoundException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.ObjectNotFound,"RobotRaconteur.ObjectNotFound",message)}});Bridge.define("RobotRaconteur.ObjRefDefinition",{inherits:[RobotRaconteur.MemberDefinition],objectType:null,isArray:!1,isIndexed:!1,indexerType:0,constructor:function(ServiceEntry){RobotRaconteur.MemberDefinition.prototype.$constructor.call(this,ServiceEntry)},toString:function(){var s_indexedtype="",objt;if(this.isIndexed)switch(this.indexerType){case RobotRaconteur.DataTypes.int32_t:s_indexedtype="{int32}";break;case RobotRaconteur.DataTypes.string_t:s_indexedtype="{string}";break;default:throw new RobotRaconteur.DataTypeException("Unknown indexer type");}return objt=this.objectType,Bridge.referenceEquals(objt,"object")&&(objt="varobject"),"objref "+objt+(this.isArray?"[]":s_indexedtype)+" "+this.name},fromString:function(s){var sp=RobotRaconteur.Extensions.splitEmpty(s.trim()),sp_2,sp1,sp_21,stype;if(sp.length!==3)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(!Bridge.referenceEquals(sp[0].trim(),"objref"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Format Error");if(Bridge.String.contains(sp[1],"[")||Bridge.String.contains(sp[1],"]")){if(!Bridge.String.endsWith(sp[1],"[]"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(sp_2=sp[1].substr(0,sp[1].length-2|0),Bridge.String.contains(sp_2,"[")||Bridge.String.contains(sp_2,"]"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(this.isArray=!0,Bridge.String.contains(sp_2,"{")||Bridge.String.contains(sp_2,"}"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Invalid object indexing notation");this.objectType=sp_2;Bridge.referenceEquals(this.objectType,"varobject")&&(this.objectType="object");this.name=sp[2].trim()}else if(Bridge.String.contains(sp[1],"{")||Bridge.String.contains(sp[1],"}")){if(this.isIndexed=!0,sp1=Bridge.String.split(sp[1],[123].map(function(i){return String.fromCharCode(i)})),sp1.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(!Bridge.String.endsWith(sp1[1],"}"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");if(sp_21=sp1[1].substr(0,sp1[1].length-1|0),Bridge.String.contains(sp_21,"[")||Bridge.String.contains(sp_21,"]")||Bridge.String.contains(sp_21,"{")||Bridge.String.contains(sp_21,"}"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");stype=sp_21;switch(stype){case"int32":this.indexerType=RobotRaconteur.DataTypes.int32_t;break;case"string":this.indexerType=RobotRaconteur.DataTypes.string_t;break;default:throw new RobotRaconteur.RobotRaconteurParseException("constructor","Invalid object reference indexer type");}this.objectType=sp1[0];Bridge.referenceEquals(this.objectType,"varobject")&&(this.objectType="object");this.name=sp[2].trim()}else this.objectType=sp[1],Bridge.referenceEquals(this.objectType,"varobject")&&(this.objectType="object"),this.name=sp[2].trim()}});Bridge.define("RobotRaconteur.PipeDefinition",{inherits:[RobotRaconteur.MemberDefinition],type:null,constructor:function(ServiceEntry){RobotRaconteur.MemberDefinition.prototype.$constructor.call(this,ServiceEntry)},toString:function(){var t=new RobotRaconteur.TypeDefinition("constructor$1",this.type);return t.member=this,t.name=this.name,Bridge.String.format("pipe {0}",t.toString())},fromString:function(s){var sp=RobotRaconteur.Extensions.splitEmpty$1(s.trim(),2);if(!Bridge.referenceEquals(sp[0].trim(),"pipe"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Format Error");if(sp.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);if(this.type=new RobotRaconteur.TypeDefinition("constructor"),this.type.member=this,this.type.fromString(sp[1]),Bridge.String.isNullOrWhiteSpace(this.type.name))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");this.name=this.type.name;this.type.name="packettype"}});Bridge.define("RobotRaconteur.PropertyDefinition",{inherits:[RobotRaconteur.MemberDefinition],type:null,constructor:function(ServiceEntry){RobotRaconteur.MemberDefinition.prototype.$constructor.call(this,ServiceEntry)},toString:function(){return this.toString$1(!1)},toString$1:function(isstruct){var t=new RobotRaconteur.TypeDefinition("constructor$1",this.type);return t.member=this,t.name=this.name,t.isArray=this.type.isArray,isstruct?Bridge.String.format("field {0}",t.toString()):Bridge.String.format("property {0}",t.toString())},fromString:function(s){var sp=RobotRaconteur.Extensions.splitEmpty$1(s.trim(),2);if(!Bridge.referenceEquals(sp[0].trim(),"property")&&!Bridge.referenceEquals(sp[0].trim(),"field"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Format Error");if(sp.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);if(this.type=new RobotRaconteur.TypeDefinition("constructor"),this.type.member=this,this.type.fromString(sp[1]),Bridge.String.isNullOrWhiteSpace(this.type.name))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");this.name=this.type.name;this.type.name="value"}});Bridge.define("RobotRaconteur.ProtocolException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.ProtocolError,"RobotRaconteur.ProtocolError",message)}});Bridge.define("RobotRaconteur.RobotRaconteurRemoteException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor$1:function(error,message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.RemoteError,error,message)},constructor:function(innerexception){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.RemoteError,Bridge.getType(innerexception).toString(),innerexception.getMessage())}});Bridge.define("RobotRaconteur.ServiceException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.ServiceError,"RobotRaconteur.ServiceError",message)}});Bridge.define("RobotRaconteur.ServiceNotFoundException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.ServiceNotFound,"RobotRaconteur.ServiceNotFound",message)}});Bridge.define("RobotRaconteur.TransactionTimeoutException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.TransactionTimeout,"RobotRaconteur.TransactionTimeout",message)}});Bridge.define("RobotRaconteur.UnknownException",{inherits:[RobotRaconteur.RobotRaconteurException],constructor:function(error,message){RobotRaconteur.RobotRaconteurException.prototype.constructor$1.call(this,RobotRaconteur.MessageErrorType.UnknownError,error,message)}});Bridge.define("RobotRaconteur.WebSocketTransport",{inherits:[RobotRaconteur.Transport],statics:{robot_Raconteur_Node_Node_Root_CA:"-----BEGIN CERTIFICATE-----\r\nMIIFujCCA6KgAwIBAgIQDdViP0ny9X/N86KnGB9/GzANBgkqhkiG9w0BAQsFADBU\r\nMQswCQYDVQQGEwJVUzEeMBwGA1UEChMVV2Fzb24gVGVjaG5vbG9neSwgTExDMSUw\r\nIwYDVQQDExxSb2JvdCBSYWNvbnRldXIgTm9kZSBSb290IENBMB4XDTE1MTIxNzAw\r\nMDAwMFoXDTQ1MTIxNjIzNTk1OVowVDELMAkGA1UEBhMCVVMxHjAcBgNVBAoTFVdh\r\nc29uIFRlY2hub2xvZ3ksIExMQzElMCMGA1UEAxMcUm9ib3QgUmFjb250ZXVyIE5v\r\nZGUgUm9vdCBDQTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAKz0a+6Q\r\nz3KpjDuHWp+4nl7AEVuwtO2MtoQCIL+HA807Fsa8DDFlWks4tXUa/BvW9mEz1BDU\r\nvcl698QN74sNEKfUdSGrsPkTvFi1AbV9nmQg9aDSZ0WnzCeu8VzxawmiYVlfYWVl\r\n1nCijAFZzp0Ii1kaVAjxUaeliXIuTpFjmOH29IecKKrpDeOVM3aRkaCin9CRloqt\r\nk3b8VgGl/h5hlQA2KLnhpsoqnYoX27ecPoVx4cnZ/Nj+w6TgxSb+JLu2r9n8QgIq\r\nnewIznDTlVkmdQgs19JpQz7AqTkKPBUuOZksGSA64ZZx42DhdbhDedZjAI9P65px\r\nNZa+iUE6Tdtpv5H/Zs+/+BnVRjTl85hJLR4EXXA4qRR/I0ILxBz5lx5/XqMO20X+\r\nc75wm6s5EH7Fjot/1BqaR2ABSQ7oclfqOmSHb0ifySPIs++sVGu8Na1zI7Gvj1c3\r\n/HzjD7nYvKDzpe809oobLj+G9huwNO9JGnBdmmCWA4qK6L7sdkUTiNRtwINxldJH\r\nGqJ53BIx82ZeomGCMn9HgDXlDnnIPiYlWmkS5pAiFGL8+YpxdLP+JWjUa0QR+wQN\r\n4XjOl7cAIe2GJF+mnQWChLBlS41i6CpAGYHuqub99ee4jFRQ403TyZmGbxtVkzZ9\r\nJ+3MT+ss8/KPFtn9CyzG3rdnxnUQUXO0L6k9AgMBAAGjgYcwgYQwEgYDVR0TAQH/\r\nBAgwBgEB/wIBATAOBgNVHQ8BAf8EBAMCAQYwFgYMKwYBBAGC4w8BAQMBAQH/BAMB\r\nAf8wJwYDVR0RBCAwHqQcMBoxGDAWBgNVBAMTD01QS0ktNDA5Ni0xLTIxMTAdBgNV\r\nHQ4EFgQURwBrvHpIMFp63LVGH7XrAZbq/sgwDQYJKoZIhvcNAQELBQADggIBAIbT\r\n+sutok2DTnTKCknxDxgdVeha2KBm8qe2wfygSYmM/hGfoIEZnn8Dbh7kLCyrVAZ9\r\nt3KDRm7YY/WuMU7hJxnbiURxigqhLNDFSXrJ0a0Evev5MbXj4vX4603RpuWwQ2F8\r\nRzHhH1TDMkc5+MaAZRifgZlufOlaOkK5pr5Izm2rgIaEuLxkt+DiCzejf4HH91sr\r\nKKbH1JaqWVngYtDnHuDhDipLsYCwTPNJSCta0FXoTJXGDF+3ft0lL2QOn4WvdmXK\r\nEve6VcSXiXlcgPlYyPUbEm7Sy5pQ8r/ulyfWixmbSZ3WuSRZDPx8g1xn6U3EeLXl\r\nM01qajteTTKMLcBAASjv5liJilk37hWTSCL48vG7JBcLmilPVXMMkalR0vUyZP6Y\r\ndqzeE8DSKIOUHJ4kRIyV/ECVIHKafr3FmJAlARN00iE3OP1u40ym+HA0q3rGG610\r\nJgpL4YU8s7OeeYJtCtXl9U4/Angm9sH0jIuMVD0frMCtk1KV92/hmtYVJIMurBjj\r\nC6YjQE9GeVtJlk9vpVm2FZTfsjixSuj/HhSC0KGiioSzet6e5qwDK9jlJkKJuLf5\r\n0IwyjKVX/DJpcRz+1wYfwHeD0oWohvs2dO6A4srDewpmtVtWVhxcbD3uS3mSgS62\r\nw5hECOru5bK1ZNWz2yDdlsBztP9lUqWL++rper0W\r\n-----END CERTIFICATE-----\r\n"},transportConnections:null,config:{properties:{DefaultReceiveTimeout:0},init:function(){this.transportConnections=new Bridge.Dictionary$2(Bridge.UInt32,RobotRaconteur.WebSocketTransportConnection)()}},constructor:function(node){node===void 0&&(node=null);RobotRaconteur.Transport.prototype.$constructor.call(this,node);this.setDefaultReceiveTimeout(15e3)},getIsClient:function(){return!0},getIsServer:function(){return!1},getUrlSchemeString:function(){return["rr+ws","rr+wss","rr+tcp","tcp","rrs+tcp","rrs+ws","rrs+wss"]},canConnectService:function(url){var u=RobotRaconteur.TransportUtil.parseConnectionUrl(url);return Bridge.Linq.Enumerable.from(this.getUrlSchemeString()).contains(u.scheme)?!0:!1},createTransportConnection:function(url,e){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,t,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1],$step);switch($step){case 0:t=new RobotRaconteur.WebSocketTransportConnection(this);$task1=t.connectTransport(url,e);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(t);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},closeTransportConnection:function(e){return this.transportConnections.containsKey(e.getLocalEndpoint())&&this.transportConnections.get(e.getLocalEndpoint()).close(),Bridge.Task.fromResult(0)},sendMessage:function(m){var $step=0,$task1,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4],$step);switch($step){case 0:if(RobotRaconteur.NodeID.op_Inequality(m.header.senderNodeID,this.node.getNodeID()))throw new RobotRaconteur.NodeNotFoundException("Invalid sender node");$step=1;continue;case 1:$task1=this.transportConnections.get(m.header.senderEndpoint).sendMessage(m);$step=2;$task1.continueWith($asyncBody);return;case 2:$task1.getAwaitedResult();$step=4;continue;case 3:throw new RobotRaconteur.ConnectionException("Connection to remote node has been closed");case 4:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=2&&Bridge.is($async_e,Bridge.KeyNotFoundException)){$step=3;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},messageReceived:function(m){this.node.messageReceived(m)}});Bridge.define("RobotRaconteur.WebSocketTransportConnection",{inherits:[RobotRaconteur.ITransportConnection],m_LocalEndpoint:0,m_RemoteEndpoint:0,m_RemoteNodeID:null,receiveTimeout:15e3,m_HeartbeatPeriod:5e3,target_nodeid:null,target_nodename:null,node:null,parent:null,m_Connected:!1,websocket:null,connect_task:null,connecting:!1,use_tls:!1,tls_active:!1,tls:null,recv_buf:null,recv_header:null,recv_message_len:0,recv_message_pos:0,send_backlog:null,pause_send:!1,streamop_queue:null,streamop_ret:null,clienthandshake_recv_task:null,clienthandshake_connect_task:null,starttls_host:null,config:{init:function(){this.m_RemoteNodeID=RobotRaconteur.NodeID.getAny();this.tlastsend=new Date(-864e13);this.tlastrec=new Date(-864e13);this.tlastrec_mes=new Date(-864e13);this.recv_buf=new Uint8Array(10240);this.recv_header=new ArrayBuffer(0);this.send_backlog=new Bridge.List$1(RobotRaconteur.Message)();this.streamop_queue=new Bridge.List$1(Bridge.TaskCompletionSource)()}},constructor:function(parent){this.parent=parent;this.tlastsend=Bridge.Date.utcNow();this.tlastrec=Bridge.Date.utcNow();this.tlastrec_mes=Bridge.Date.utcNow();this.node=parent.node;this.receiveTimeout=15e3},getLocalEndpoint:function(){return this.m_LocalEndpoint},getRemoteEndpoint:function(){return this.m_RemoteEndpoint},getRemoteNodeID:function(){return this.m_RemoteNodeID},connectTransport:function(url,e){var $step=0,$task1,$taskResult1,$task2,$task3,$taskResult3,$tcs=new Bridge.TaskCompletionSource,u,d,url2,a,args,noop,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4,5],$step);switch($step){case 0:if(u=RobotRaconteur.TransportUtil.parseConnectionUrl(url),Bridge.String.startsWith(u.scheme,"rrs+"))try{if(d=forge.tls,d==null)throw new RobotRaconteur.ConnectionException("TLS not available");this.use_tls=!0}catch($e1){$e1=Bridge.Exception.create($e1);throw new RobotRaconteur.ConnectionException("TLS not available");}if(Bridge.referenceEquals(u.scheme,"rr+tcp")||Bridge.referenceEquals(u.scheme,"rrs+tcp"))url2="ws://"+u.host+":"+u.port.toString()+u.path+"?"+Bridge.String.split(url,[63].map(function(i){return String.fromCharCode(i)}),2)[1];else if(Bridge.referenceEquals(u.scheme,"tcp"))a=new Bridge.Dictionary$2(String,String)(),u.nodeid.getIsAnyNode()?Bridge.String.isNullOrEmpty(u.nodename)||a.add("nodename",u.nodename):a.add("nodeid",Bridge.String.trim(u.nodeid.toString(),[123,125])),a.add("service",u.service),url2="ws://"+u.host+":"+u.port.toString()+"?"+Bridge.toArray(Bridge.Linq.Enumerable.from(a).select($_.RobotRaconteur.WebSocketTransportConnection.f1)).join("&");else if(Bridge.referenceEquals(u.scheme,"rr+ws")||Bridge.referenceEquals(u.scheme,"rrs+ws"))url2="ws://"+u.host+":"+u.port.toString()+u.path+"?"+Bridge.String.split(url,[63].map(function(i){return String.fromCharCode(i)}),2)[1];else if(Bridge.referenceEquals(u.scheme,"rr+wss")||Bridge.referenceEquals(u.scheme,"rrs+wss"))url2="wss://"+u.host+":"+u.port.toString()+u.path+"?"+Bridge.String.split(url,[63].map(function(i){return String.fromCharCode(i)}),2)[1];else throw new RobotRaconteur.ConnectionException("Invalid transport scheme");this.m_LocalEndpoint=e.getLocalEndpoint();this.target_nodeid=u.nodeid;this.target_nodename=u.nodename;this.websocket=new WebSocket(url2,"robotraconteur.robotraconteur.com");this.websocket.binaryType="arraybuffer";this.websocket.onmessage=Bridge.fn.bind(this,$_.RobotRaconteur.WebSocketTransportConnection.f2);this.websocket.onopen=Bridge.fn.bind(this,$_.RobotRaconteur.WebSocketTransportConnection.f3);this.websocket.onclose=Bridge.fn.bind(this,$_.RobotRaconteur.WebSocketTransportConnection.f4);this.websocket.onerror=Bridge.fn.bind(this,$_.RobotRaconteur.WebSocketTransportConnection.f5);this.connecting=!0;this.connect_task=new Bridge.TaskCompletionSource;$task1=this.connect_task.task;$step=1;$task1.continueWith($asyncBody);return;case 1:if($taskResult1=$task1.getAwaitedResult(),this.m_Connected=!0,this.use_tls){$step=2;continue}$step=4;continue;case 2:$task2=this.doClientTlsHandshake();$step=3;$task2.continueWith($asyncBody);return;case 3:$task2.getAwaitedResult();$step=4;continue;case 4:args={item1:u.nodeid,item2:u.nodename};$task3=this.streamOp("CreateConnection",args);$step=5;$task3.continueWith($asyncBody);return;case 5:$taskResult3=$task3.getAwaitedResult();noop=this.doHeartbeat();this.parent.transportConnections.add(this.m_LocalEndpoint,this);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},onmessage:function(evt){var evt2=evt,data=Bridge.as(evt2.data,ArrayBuffer),data2;if(data==null){this.close();return}if(this.tls_active)data2=forge.util.binary.raw.encode(new Uint8Array(data)),this.tls.process(data2);else this.onmessage2(data)},onmessage2:function(data){var recv_header1,len,data4,needed,take,r,m;if(this.recv_message_len===0){if(this.recv_header.byteLength===0){if(data.byteLength<8){this.recv_header=data;return}if(recv_header1=data.slice(0,8),len=this.read_message_len(recv_header1),len===-1){this.close();return}this.recv_buf.byteLength<len&&(this.recv_buf=new Uint8Array(len));this.recv_message_len=len;this.recv_message_pos=0;this.onmessage2(data);return}if(data4=new Uint8Array(this.recv_header.byteLength+data.byteLength|0),data4.set(new Uint8Array(this.recv_header),0),data4.set(new Uint8Array(data),this.recv_header.byteLength),(data.byteLength+this.recv_header.byteLength|0)<8){this.recv_header=data4.buffer;return}this.recv_header=new ArrayBuffer(0);this.onmessage2(data4.buffer);return}if(needed=this.recv_message_len-this.recv_message_pos|0,take=needed>data.byteLength?data.byteLength:needed,this.recv_buf.set(new Uint8Array(data).subarray(0,take),this.recv_message_pos),this.recv_message_pos=this.recv_message_pos+take|0,!(this.recv_message_pos<this.recv_message_len)){if(r=new RobotRaconteur.ArrayBinaryReader(this.recv_buf.buffer,0,this.recv_message_len),m=new RobotRaconteur.Message,m.read(r),this.recv_message_len=0,this.recv_message_pos=0,Bridge.Task.run(Bridge.fn.bind(this,function(){return RobotRaconteur.Extensions.ignoreResult(this.processMessage(m))})),data.byteLength>take)this.onmessage2(data.slice(needed));return}},read_message_len:function(data){var r=new RobotRaconteur.ArrayBinaryReader(data,0,8),seed=r.readString8(4),len;return Bridge.referenceEquals(seed,"RRAC")?(len=r.readUInt32(),len|0):-1},onopen:function(){if(this.connecting){this.connecting=!1;var c=this.connect_task;this.connect_task=null;c.trySetResult(0)}},onclose:function(){if(this.connecting){this.connecting=!1;var c=this.connect_task;this.connect_task=null;c.trySetException(new RobotRaconteur.ConnectionException("Could not connect to service"));return}try{this.close()}catch($e1){$e1=Bridge.Exception.create($e1)}},onerror:function(){if(this.connecting){this.connecting=!1;var c=this.connect_task;this.connect_task=null;c.trySetException(new RobotRaconteur.ConnectionException("Could not connect to service"));return}try{this.close()}catch($e1){$e1=Bridge.Exception.create($e1)}},websocket_send:function(buf){var pos,l,buf2;if(buf.byteLength<65535)this.websocket.send(buf);else for(pos=0;pos<buf.byteLength;)l=(buf.byteLength-pos|0)>65535?65535:buf.byteLength-pos|0,buf2=buf.slice(pos,l+pos|0),this.websocket.send(buf2),pos=pos+l|0},sendMessage:function(m){if(this.pause_send)return this.send_backlog.add(m),Bridge.Task.fromResult(0);var size=m.computeSize(),buf=new ArrayBuffer(size|0),w=new RobotRaconteur.ArrayBinaryWriter(buf,0,size|0);return m.write(w),this.tls_active?this.tls.prepare(buf):this.websocket_send(buf),this.tlastsend=Bridge.Date.utcNow(),Bridge.Task.fromResult(0)},close:function(){this.m_Connected=!1;try{this.parent.transportConnections.remove(this.m_LocalEndpoint)}catch($e1){$e1=Bridge.Exception.create($e1)}this.websocket.close();this.clienthandshake_recv_task!=null&&this.clienthandshake_recv_task.trySetCanceled();this.clienthandshake_connect_task!=null&&this.clienthandshake_recv_task.trySetCanceled();this.streamop_ret!=null&&this.streamop_ret.trySetCanceled()},processMessage:function(mes){var $step=0,$task1,$task2,$tcs=new Bridge.TaskCompletionSource,RemoteNodeID1,local_ep,remote_ep,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([1,2,3,4,5,6,7,8,9,10,11,12],$step);switch($step){case 1:if(RemoteNodeID1=this.m_RemoteNodeID,local_ep=this.m_LocalEndpoint,remote_ep=this.m_RemoteEndpoint,this.tlastrec=Bridge.Date.utcNow(),mes.entries.getCount()===1&&(mes.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.StreamOp||mes.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.StreamOpRet)){$step=2;continue}$step=7;continue;case 2:if(mes.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.StreamOpRet&&Bridge.referenceEquals(mes.entries.getItem(0).memberName,"STARTTLS")){$step=3;continue}else{$step=4;continue}case 3:if(this.clienthandshake_recv_task==null){this.close();$tcs.setResult(null);return}this.tls_active=!0;this.clienthandshake_recv_task.trySetResult(mes);$step=6;continue;case 4:$task1=this.streamOpMessageReceived(mes);$step=5;$task1.continueWith($asyncBody);return;case 5:$task1.getAwaitedResult();$step=6;continue;case 6:$tcs.setResult(null);return;case 7:if(mes.entries.getCount()===1&&(mes.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.StreamCheckCapability||mes.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.StreamCheckCapabilityRet)){this.checkStreamCapability_MessageReceived(mes);$tcs.setResult(null);return}if(mes.entries.getCount()===1&&mes.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.ConnectClientRet&&remote_ep===0&&(this.m_RemoteEndpoint===0&&(this.m_RemoteEndpoint=mes.header.senderEndpoint),remote_ep=this.m_RemoteEndpoint),!(mes.entries.getCount()===1&&(mes.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.ConnectionTest||mes.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.ConnectionTestRet))){$step=8;continue}$step=10;continue;case 8:this.tlastrec_mes=Bridge.Date.utcNow();$task2=this.processMessage2(mes);$step=9;$task2.continueWith($asyncBody);return;case 9:$task2.getAwaitedResult();$step=10;continue;case 10:$step=12;continue;case 11:this.close();$step=12;continue;case 12:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=10){$step=11;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},processMessage2:function(m){var $step=0,$task1,$jumpFromFinally,$tcs=new Bridge.TaskCompletionSource,$returnValue,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([1,2,3,4,5],$step);switch($step){case 1:$task1=this.messageReceived(m);$step=2;$task1.continueWith($asyncBody);return;case 2:$task1.getAwaitedResult();$step=4;continue;case 3:this.close();$step=4;continue;case 4:if($jumpFromFinally>-1)$step=$jumpFromFinally,$jumpFromFinally=null;else{if($async_e){$tcs.setException($async_e);return}if(Bridge.isDefined($returnValue)){$tcs.setResult($returnValue);return}}$step=5;continue;case 5:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=2){$step=3;$asyncBody();return}if($step>=1&&$step<=3){$step=4;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},messageReceived:function(m){var $step=0,$tcs=new Bridge.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0],$step);switch($step){case 0:this.parent.messageReceived(m);$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},packStreamOpRequest:function(command){var mm=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.StreamOp,command);if(!Bridge.referenceEquals(command,"GetRemoteNodeID"))throw new Bridge.InvalidOperationException("Unknown StreamOp command");return Bridge.Task.fromResult(mm)},unpackStreamOpResponse:function(response,header){var command=response.memberName,n,n1;switch(command){case"GetRemoteNodeID":return n=header.senderNodeID,Bridge.Task.fromResult(n);case"CreateConnection":if(response.error!==RobotRaconteur.MessageErrorType.None&&response.error!==RobotRaconteur.MessageErrorType.ProtocolError)throw RobotRaconteur.RobotRaconteurExceptionUtil.messageEntryToException(response);if(this.m_RemoteNodeID.getIsAnyNode()){if(!Bridge.referenceEquals(this.target_nodename,"")&&!Bridge.referenceEquals(this.target_nodename,header.senderNodeName))throw new RobotRaconteur.ConnectionException("Invalid node connection");if(!this.target_nodeid.getIsAnyNode()&&RobotRaconteur.NodeID.op_Inequality(this.target_nodeid,header.senderNodeID))throw new RobotRaconteur.ConnectionException("Invalid node connection");}else if(RobotRaconteur.NodeID.op_Inequality(header.senderNodeID,this.m_RemoteNodeID))throw new RobotRaconteur.ConnectionException("Invalid node connection");return n1=header.senderNodeID,Bridge.Task.fromResult(n1);default:throw new RobotRaconteur.MemberNotFoundException("Unknown command");}},processStreamOpRequest:function(request){var command=request.memberName,mmret=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.StreamOpRet,command);try{switch(command){case"GetRemoteNodeID":break;default:throw new RobotRaconteur.ProtocolException("Unknown StreamOp Command");}}catch($e1){$e1=Bridge.Exception.create($e1);mmret.error=RobotRaconteur.MessageErrorType.ProtocolError;mmret.addElement$1("errorname","RobotRaconteur.ProtocolError");mmret.addElement$1("errorstring","Invalid Stream Operation")}return Bridge.Task.fromResult(mmret)},streamOp:function(command,args){var $step=0,$task1,$taskResult1,$task2,$taskResult2,$task3,$task4,$taskResult4,$task5,$taskResult5,$jumpFromFinally,$tcs=new Bridge.TaskCompletionSource,$returnValue,t,m,a,mm,mm1,streamop_ret1,$async_e,t2,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,4,5,6,7,8,9,10,11,12,13],$step);switch($step){case 0:if(args===void 0&&(args=null),t=null,!this.m_Connected)throw new RobotRaconteur.ConnectionException("Transport connection closed");if(this.streamop_ret==null?this.streamop_ret=new Bridge.TaskCompletionSource:(t=new Bridge.TaskCompletionSource,this.streamop_queue.add(t)),t!=null){$step=1;continue}$step=3;continue;case 1:$task1=t.task;$step=2;$task1.continueWith($asyncBody);return;case 2:$taskResult1=$task1.getAwaitedResult();$step=3;continue;case 4:if(m=new RobotRaconteur.Message,m.header=new RobotRaconteur.MessageHeader,m.header.receiverNodeName="",m.header.senderNodeName=this.node.getNodeName(),m.header.senderNodeID=this.node.getNodeID(),m.header.receiverNodeID=this.getRemoteNodeID(),Bridge.referenceEquals(command,"CreateConnection")){$step=5;continue}else{$step=6;continue}case 5:a=args;m.header.receiverNodeID=a.item1;m.header.receiverNodeName=a.item2;mm=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.StreamOp,command);m.entries.add(mm);$step=8;continue;case 6:$task2=this.packStreamOpRequest(command,args);$step=7;$task2.continueWith($asyncBody);return;case 7:$taskResult2=$task2.getAwaitedResult();mm1=$taskResult2;m.entries.add(mm1);$step=8;continue;case 8:$task3=this.sendMessage(m);$step=9;$task3.continueWith($asyncBody);return;case 9:$task3.getAwaitedResult();$task4=this.streamop_ret.task;$step=10;$task4.continueWith($asyncBody);return;case 10:$taskResult4=$task4.getAwaitedResult();streamop_ret1=$taskResult4;$task5=this.unpackStreamOpResponse(streamop_ret1.entries.getItem(0),streamop_ret1.header);$step=11;$task5.continueWith($asyncBody);return;case 11:$taskResult5=$task5.getAwaitedResult();$returnValue=$taskResult5;$step=12;continue;case 12:if(this.streamop_queue.getCount()===0?this.streamop_ret=null:(this.streamop_ret=new Bridge.TaskCompletionSource,t2=this.streamop_queue.getItem(0),this.streamop_queue.removeAt(0),t2.trySetResult(0)),$jumpFromFinally>-1)$step=$jumpFromFinally,$jumpFromFinally=null;else{if($async_e){$tcs.setException($async_e);return}if(Bridge.isDefined($returnValue)){$tcs.setResult($returnValue);return}}$step=13;continue;case 13:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=4&&$step<=11){$step=12;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},streamOpMessageReceived:function(m){var $step=0,$task1,$taskResult1,$task2,$tcs=new Bridge.TaskCompletionSource,mm,command,mret,mmret,r,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4,5,6,7],$step);switch($step){case 0:try{mm=m.entries.getItem(0)}catch($e1){$e1=Bridge.Exception.create($e1);$tcs.setResult(null);return}if(mm.entryType===RobotRaconteur.MessageEntryType.StreamOp){$step=1;continue}else{$step=6;continue}case 1:command=mm.memberName;mret=new RobotRaconteur.Message;mret.header=new RobotRaconteur.MessageHeader;mret.header.senderNodeName=this.node.getNodeName();mret.header.receiverNodeName=m.header.senderNodeName;mret.header.senderNodeID=this.node.getNodeID();mret.header.receiverNodeID=m.header.senderNodeID;$task1=this.processStreamOpRequest(mm,m.header);$step=2;$task1.continueWith($asyncBody);return;case 2:if($taskResult1=$task1.getAwaitedResult(),mmret=$taskResult1,mmret!=null){$step=3;continue}$step=5;continue;case 3:mret.entries.add(mmret);$task2=this.sendMessage(mret);$step=4;$task2.continueWith($asyncBody);return;case 4:$task2.getAwaitedResult();$step=5;continue;case 5:$step=7;continue;case 6:if(r=null,this.streamop_ret==null){$tcs.setResult(null);return}r=this.streamop_ret;r.trySetResult(m);$step=7;continue;case 7:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=Bridge.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},checkStreamCapability_MessageReceived:function(m){var ret,mret,retval;try{m.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.StreamCheckCapability?(ret=new RobotRaconteur.Message,ret.header=new RobotRaconteur.MessageHeader,ret.header.senderNodeID=this.node.getNodeID(),ret.header.receiverNodeID=m.header.senderNodeID,mret=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.StreamCheckCapabilityRet,m.entries.getItem(0).memberName),mret.servicePath=m.entries.getItem(0).servicePath,retval=new Uint32Array(1),retval[0]=0,mret.addElement$1("return",retval),ret.entries.add(mret),this.sendMessage(ret)):m.entries.getItem(0).entryType===RobotRaconteur.MessageEntryType.StreamCheckCapabilityRet}catch($e1){$e1=Bridge.Exception.create($e1)}},checkConnection:function(endpoint){if(!this.m_Connected||endpoint!==this.m_LocalEndpoint)throw new RobotRaconteur.ConnectionException("Transport connection closed");},doHeartbeat:function(){var $step=0,$task1,$task2,$tcs=new Bridge.TaskCompletionSource,m,mm,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([1,2,3,4,5,6,7,8,9],$step);switch($step){case 1:if(this.m_Connected){$step=2;continue}$step=7;continue;case 2:$task1=Bridge.Task.delay(500);$step=3;$task1.continueWith($asyncBody);return;case 3:if($task1.getAwaitedResult(),Bridge.Date.subdd(Bridge.Date.utcNow(),this.tlastsend).getTotalMilliseconds()>this.m_HeartbeatPeriod){$step=4;continue}$step=6;continue;case 4:m=new RobotRaconteur.Message;m.header=new RobotRaconteur.MessageHeader;m.header.senderNodeID=this.node.getNodeID();m.header.receiverNodeID=this.getRemoteNodeID();mm=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.ConnectionTest,"");m.entries.add(mm);$task2=this.sendMessage(m);$step=5;$task2.continueWith($asyncBody);return;case 5:$task2.getAwaitedResult();$step=6;continue;case 6:Bridge.Date.subdd(this.tlastsend,this.tlastrec).getTotalMilliseconds()>this.receiveTimeout?this.close():Bridge.Date.subdd(Bridge.Date.utcNow(),this.tlastrec_mes).getTotalMilliseconds()>this.node.transportInactivityTimeout&&this.close();$step=1;continue;case 7:$step=9;continue;case 8:this.close();$step=9;continue;case 9:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=7){$step=8;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},doClientTlsHandshake:function(){var $step=0,$task1,$taskResult1,$task2,$taskResult2,$task3,$jumpFromFinally,$tcs=new Bridge.TaskCompletionSource,$returnValue,m,mm,cert,mutualauth,size,buf,w,mret,recv_nodeid,recv_nodename,host,forge_args,$t,m2,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=Bridge.Array.min([0,1,2,3,4,5,6,7,8,9,10],$step);switch($step){case 0:this.clienthandshake_recv_task=new Bridge.TaskCompletionSource;this.clienthandshake_connect_task=new Bridge.TaskCompletionSource;$step=1;continue;case 1:this.pause_send=!0;m=new RobotRaconteur.Message;m.header=new RobotRaconteur.MessageHeader;m.header.receiverNodeID=this.target_nodeid;m.header.receiverNodeName=this.target_nodename;mm=new RobotRaconteur.MessageEntry("constructor$1",RobotRaconteur.MessageEntryType.StreamOp,"STARTTLS");cert=this.getTlsCertificate();mutualauth=cert!=null;mutualauth&&mm.addElement$1("mutualauth","true");m.entries.add(mm);size=m.computeSize();buf=new ArrayBuffer(size|0);w=new RobotRaconteur.ArrayBinaryWriter(buf,0,size|0);m.write(w);this.websocket_send(buf);$task1=this.clienthandshake_recv_task.task;$step=2;$task1.continueWith($asyncBody);return;case 2:if($taskResult1=$task1.getAwaitedResult(),mret=$taskResult1,recv_nodeid=mret.header.senderNodeID,recv_nodename=mret.header.senderNodeName,!this.target_nodeid.getIsAnyNode()&&RobotRaconteur.NodeID.op_Inequality(this.target_nodeid,recv_nodeid))throw new RobotRaconteur.ConnectionException("Could not validate remote node");if(!Bridge.String.isNullOrEmpty(this.target_nodename)&&!Bridge.referenceEquals(this.target_nodename,recv_nodename))throw new RobotRaconteur.ConnectionException("Could not validate remote node");if(mret.entries.getCount()!==1)throw new RobotRaconteur.ConnectionException("TLS handshake error");if(mret.entries.getItem(0).entryType!==RobotRaconteur.MessageEntryType.StreamOpRet||!Bridge.referenceEquals(mret.entries.getItem(0).memberName,"STARTTLS"))throw new RobotRaconteur.ConnectionException("TLS handshake error");if(mutualauth&&Bridge.Linq.Enumerable.from(mret.entries.getItem(0).elements).count($_.RobotRaconteur.WebSocketTransportConnection.f6)===0)throw new RobotRaconteur.ConnectionException("TLS handshake error");host="Robot Raconteur Node "+recv_nodeid.toString();this.starttls_host=host;forge_args={};forge_args.server=!1;forge_args.virtualHost=host;forge_args.verify=Bridge.fn.bind(this,this.verify_remote_cert);forge_args.connected=Bridge.fn.bind(this,this.on_tls_connected);forge_args.tlsDataReady=Bridge.fn.bind(this,this.on_tls_tlsDataReady);forge_args.dataReady=Bridge.fn.bind(this,this.on_tls_dataReady);forge_args.closed=Bridge.fn.bind(this,this.on_tls_closed);forge_args.error=Bridge.fn.bind(this,this.on_tls_error);forge_args.caStore=[RobotRaconteur.WebSocketTransport.robot_Raconteur_Node_Node_Root_CA];forge.oids["1.3.6.1.4.1.45455.1.1.3.1"]="robotRaconteurRoot";forge.oids["1.3.6.1.4.1.45455.1.1.3.2"]="robotRaconteurIntermediate";forge.oids["1.3.6.1.4.1.45455.1.1.3.3"]="robotRaconteurNode";this.tls=forge.tls.createConnection(forge_args);this.tls.handshake();$task2=this.clienthandshake_connect_task.task;$step=3;$task2.continueWith($asyncBody);return;case 3:$taskResult2=$task2.getAwaitedResult();this.pause_send=!1;$t=Bridge.getEnumerator(this.send_backlog);$step=4;continue;case 4:if($t.moveNext()){m2=$t.getCurrent();$step=5;continue}$step=7;continue;case 5:$task3=this.sendMessage(m2);$step=6;$task3.continueWith($asyncBody);return;case 6:$task3.getAwaitedResult();$step=4;continue;case 7:$step=9;continue;case 8:this.close();throw $async_e;case 9:if(this.clienthandshake_recv_task=null,this.clienthandshake_connect_task=null,$jumpFromFinally>-1)$step=$jumpFromFinally,$jumpFromFinally=null;else{if($async_e){$tcs.setException($async_e);return}if(Bridge.isDefined($returnValue)){$tcs.setResult($returnValue);return}}$step=10;continue;case 10:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){if($async_e=Bridge.Exception.create($async_e1),$step>=1&&$step<=7){$step=8;$asyncBody();return}if($step>=1&&$step<=8){$step=9;$asyncBody();return}$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},getTlsCertificate:function(){return null},verify_remote_cert:function(connection,verified,depth,certs){var cn_good,attr,i,extension_good,ext,i1,extension_good1,ext1,i2;if(Bridge.referenceEquals(depth,0)){for(cn_good=!1,attr=certs[0].subject.attributes,i=0;i<attr.length;i=i+1|0)Bridge.referenceEquals(attr[i].name,"commonName")&&Bridge.referenceEquals(attr[i].value,this.starttls_host)&&(cn_good=!0);if(!cn_good)return!1;for(extension_good=!1,ext=certs[0].extensions,i1=0;i1<ext.length;i1=i1+1|0)Bridge.referenceEquals(ext[i1].id,"1.3.6.1.4.1.45455.1.1.3.3")&&(extension_good=!0)}else{for(extension_good1=!1,ext1=certs[depth].extensions,i2=0;i2<ext1.length;i2=i2+1|0)Bridge.referenceEquals(ext1[i2].id,"1.3.6.1.4.1.45455.1.1.3.2")&&(extension_good1=!0);if(!extension_good1)return!1}return verified},on_tls_connected:function(){this.clienthandshake_connect_task!=null&&this.clienthandshake_connect_task.trySetResult(0)},on_tls_tlsDataReady:function(connection){var buf=forge.util.binary.raw.decode(connection.tlsData.getBytes());buf.length>0&&this.websocket_send(buf.buffer)},on_tls_dataReady:function(connection){var dat=forge.util.binary.raw.decode(connection.data.getBytes());this.onmessage2(dat.buffer)},on_tls_closed:function(){this.close()},on_tls_error:function(connection,error){console.log("TLS error: "+error.message);this.close()}});Bridge.ns("RobotRaconteur.WebSocketTransportConnection",$_);Bridge.apply($_.RobotRaconteur.WebSocketTransportConnection,{f1:function(x){return x.key+"="+x.value},f2:function(evt){this.onmessage(evt)},f3:function(evt){this.onopen(evt)},f4:function(evt){this.onclose(evt)},f5:function(evt){this.onerror(evt)},f6:function(x){return Bridge.referenceEquals(x.elementName,"mutualauth")&&Bridge.referenceEquals(x.castData(String).toLowerCase(),"true")}});Bridge.define("RobotRaconteur.WireDefinition",{inherits:[RobotRaconteur.MemberDefinition],type:null,constructor:function(ServiceEntry){RobotRaconteur.MemberDefinition.prototype.$constructor.call(this,ServiceEntry)},toString:function(){var t=new RobotRaconteur.TypeDefinition("constructor$1",this.type);return t.member=this,t.name=this.name,Bridge.String.format("wire {0}",t.toString())},fromString:function(s){var sp=RobotRaconteur.Extensions.splitEmpty$1(s.trim(),2);if(!Bridge.referenceEquals(sp[0].trim(),"wire"))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Format Error");if(sp.length!==2)throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error near: "+s);if(this.type=new RobotRaconteur.TypeDefinition("constructor"),this.type.member=this,this.type.fromString(sp[1]),Bridge.String.isNullOrWhiteSpace(this.type.name))throw new RobotRaconteur.RobotRaconteurParseException("constructor","Parse error");this.name=this.type.name;this.type.name="packettype"}});Bridge.init()})(this);